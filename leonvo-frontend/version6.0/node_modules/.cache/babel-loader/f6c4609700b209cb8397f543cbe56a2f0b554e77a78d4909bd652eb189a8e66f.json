{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport apiConfig from '@/config/api.config';\nimport axios from 'axios';\nexport default {\n  name: 'CartView',\n  data() {\n    return {\n      cartItems: [],\n      isLoggedIn: false,\n      username: '',\n      userId: null,\n      allProducts: [],\n      recommendedProducts: [],\n      showCheckoutDialog: false,\n      isCreatingOrder: false,\n      membershipInfo: null,\n      studentStatus: null,\n      appliedDiscount: {\n        type: 'none',\n        // none, student, membership\n        rate: 1,\n        label: 'æ— ä¼˜æƒ '\n      },\n      checkoutForm: {\n        province: '',\n        receiverAddress: '',\n        receiverName: '',\n        receiverPhone: '',\n        remark: ''\n      },\n      qrcodeImageSrc: require('@/assets/ä»˜æ¬¾.jpg'),\n      provinces: ['åŒ—äº¬å¸‚', 'å¤©æ´¥å¸‚', 'ä¸Šæµ·å¸‚', 'é‡åº†å¸‚', 'æ²³åŒ—çœ', 'å±±è¥¿çœ', 'è¾½å®çœ', 'å‰æ—çœ', 'é»‘é¾™æ±Ÿçœ', 'æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ', 'å®‰å¾½çœ', 'ç¦å»ºçœ', 'æ±Ÿè¥¿çœ', 'å±±ä¸œçœ', 'æ²³å—çœ', 'æ¹–åŒ—çœ', 'æ¹–å—çœ', 'å¹¿ä¸œçœ', 'æµ·å—çœ', 'å››å·çœ', 'è´µå·çœ', 'äº‘å—çœ', 'é™•è¥¿çœ', 'ç”˜è‚ƒçœ', 'é’æµ·çœ', 'å°æ¹¾çœ', 'å†…è’™å¤è‡ªæ²»åŒº', 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº', 'è¥¿è—è‡ªæ²»åŒº', 'å®å¤å›æ—è‡ªæ²»åŒº', 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº', 'é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº', 'æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº']\n    };\n  },\n  computed: {\n    totalItems() {\n      return this.cartItems.reduce((total, item) => total + item.quantity, 0);\n    },\n    totalPrice() {\n      return this.cartItems.reduce((total, item) => total + item.price * item.quantity, 0);\n    },\n    finalPrice() {\n      return Math.floor(this.totalPrice * this.appliedDiscount.rate);\n    },\n    discountAmount() {\n      return this.totalPrice - this.finalPrice;\n    }\n  },\n  mounted() {\n    this.checkLoginStatus();\n    // åŒé‡æ£€æŸ¥ï¼šå¦‚æœé¦–æ¬¡æ£€æŸ¥å¤±è´¥ï¼Œå»¶è¿Ÿå†æ¬¡æ£€æŸ¥\n    setTimeout(() => {\n      if (!this.isLoggedIn) {\n        this.checkLoginStatus();\n      }\n    }, 500);\n    this.loadCart();\n    this.fetchAllProducts();\n    if (this.userId) {\n      this.fetchMembership();\n      this.fetchStudentStatus();\n    }\n    window.addEventListener('storage', this.handleStorageChange);\n    // ç›‘å¬è‡ªå®šä¹‰ç™»å½•äº‹ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰\n    window.addEventListener('login-status-changed', this.checkLoginStatus);\n  },\n  // æ·»åŠ  activated é’©å­ä»¥æ”¯æŒ keep-alive åœºæ™¯ï¼ˆè™½ç„¶ç›®å‰ App.vue æ²¡ç”¨ï¼Œä½†é¢„é˜²ä¸‡ä¸€ï¼‰\n  activated() {\n    this.checkLoginStatus();\n    this.loadCart();\n  },\n  beforeUnmount() {\n    window.removeEventListener('storage', this.handleStorageChange);\n    window.removeEventListener('login-status-changed', this.checkLoginStatus);\n  },\n  watch: {\n    cartItems: {\n      handler() {\n        if (this.allProducts.length > 0) {\n          this.generateProductRecommendations();\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    // è·å–ä¼šå‘˜ç­‰çº§å®šä¹‰\n    getMembershipTiers() {\n      return [{\n        key: 'normal',\n        label: 'æ™®é€šä¼šå‘˜',\n        min: 0,\n        max: 3000,\n        discount: 1,\n        color: '#64b5f6',\n        discountText: 'ä¸æ‰“æŠ˜'\n      }, {\n        key: 'vip',\n        label: 'VIPä¼šå‘˜',\n        min: 3000,\n        max: 6000,\n        discount: 0.95,\n        color: '#7e57c2',\n        discountText: '9.5æŠ˜'\n      }, {\n        key: 'svip',\n        label: 'SVIPä¼šå‘˜',\n        min: 6000,\n        max: 12000,\n        discount: 0.9,\n        color: '#ff9800',\n        discountText: '9æŠ˜'\n      }, {\n        key: 'king',\n        label: 'é‡‘ä¸»çˆ¸çˆ¸',\n        min: 12000,\n        max: Infinity,\n        discount: 0.8,\n        color: '#fbc02d',\n        discountText: '8æŠ˜'\n      }];\n    },\n    // è®¡ç®—ä¼šå‘˜ç­‰çº§\n    calculateMembership(points = 0) {\n      const tiers = this.getMembershipTiers();\n      const current = tiers.find(t => points >= t.min && points < t.max) || tiers[tiers.length - 1];\n      return current;\n    },\n    // è·å–ä¼šå‘˜ä¿¡æ¯\n    async fetchMembership() {\n      const uid = localStorage.getItem('userId');\n      if (!uid) return;\n      try {\n        const res = await axios.get(apiConfig.user.getUserRole(uid));\n        if (res.data && res.data.code === 1) {\n          const role = res.data.data || {};\n          const points = Number(role.points || 0);\n          this.membershipInfo = this.calculateMembership(points);\n\n          // åº”ç”¨ä¼šå‘˜æŠ˜æ‰£\n          if (this.membershipInfo.discount < 1) {\n            this.applyBestDiscount('membership', this.membershipInfo.discount, this.membershipInfo.label + ' ' + this.membershipInfo.discountText);\n          }\n        }\n      } catch (error) {\n        console.error('è·å–ä¼šå‘˜ä¿¡æ¯å¤±è´¥:', error);\n      }\n    },\n    // è·å–å­¦ç”Ÿè®¤è¯çŠ¶æ€\n    async fetchStudentStatus() {\n      const uid = localStorage.getItem('userId');\n      if (!uid) return;\n      try {\n        const res = await axios.get(apiConfig.student.getStatus(uid));\n        if (res.data.code === 1) {\n          this.studentStatus = res.data.data;\n          // å¦‚æœæ˜¯å­¦ç”Ÿï¼Œä¸”è®¤è¯é€šè¿‡ï¼Œå¯ä»¥ç»™äºˆç‰¹å®šæŠ˜æ‰£ï¼ˆä¾‹å¦‚9æŠ˜ï¼‰\n          // è¿™é‡Œå‡è®¾å­¦ç”Ÿäº«å—9æŠ˜ï¼Œå¦‚æœä¼šå‘˜æŠ˜æ‰£æ›´ä½åˆ™è¦†ç›–\n          if (this.studentStatus && this.studentStatus.status === 1) {\n            this.applyBestDiscount('student', 0.9, 'å­¦ç”Ÿè®¤è¯ä¼˜æƒ  9æŠ˜');\n          }\n        }\n      } catch (e) {\n        console.error('è·å–å­¦ç”Ÿè®¤è¯çŠ¶æ€å¤±è´¥', e);\n      }\n    },\n    // åº”ç”¨æœ€ä¼˜æŠ˜æ‰£\n    applyBestDiscount(type, rate, label) {\n      // å¦‚æœæ–°æŠ˜æ‰£åŠ›åº¦æ›´å¤§ï¼ˆrateæ›´å°ï¼‰ï¼Œæˆ–è€…æ²¡æœ‰æŠ˜æ‰£æ—¶ï¼Œåº”ç”¨æ–°æŠ˜æ‰£\n      if (rate < this.appliedDiscount.rate || this.appliedDiscount.rate === 1 && rate < 1) {\n        this.appliedDiscount = {\n          type,\n          rate,\n          label\n        };\n      }\n    },\n    // æ£€æŸ¥ç™»å½•çŠ¶æ€\n    checkLoginStatus() {\n      const loggedIn = localStorage.getItem('isLoggedIn') === 'true';\n      const username = localStorage.getItem('username');\n      const userId = localStorage.getItem('userId');\n      console.log('CartView æ£€æŸ¥ç™»å½•çŠ¶æ€:', {\n        loggedIn,\n        username,\n        userId\n      });\n\n      // å®¹é”™å¤„ç†ï¼šå¦‚æœ isLoggedIn ä¸¢å¤±ä½†æœ‰ userId æˆ– usernameï¼Œä¹Ÿè§†ä¸ºå·²ç™»å½•\n      // æ’é™¤ 'null', 'undefined' å­—ç¬¦ä¸²çš„æƒ…å†µ\n      const isValidUserId = userId && userId !== 'null' && userId !== 'undefined';\n      const isValidUsername = username && username !== 'null' && username !== 'undefined';\n      this.isLoggedIn = loggedIn || isValidUserId || isValidUsername;\n      if (this.isLoggedIn) {\n        this.username = username || 'ç”¨æˆ·';\n        this.userId = userId;\n        // å¦‚æœæ²¡æœ‰userIdä½†æœ‰usernameï¼Œå°è¯•ä»userInfoæ¢å¤userId\n        if (!this.userId) {\n          try {\n            const userInfoStr = localStorage.getItem('userInfo');\n            if (userInfoStr) {\n              const userInfo = JSON.parse(userInfoStr);\n              if (userInfo.uid || userInfo.id) {\n                this.userId = userInfo.uid || userInfo.id;\n              }\n            }\n          } catch (e) {\n            console.error('æ¢å¤userIdå¤±è´¥', e);\n          }\n        }\n\n        // å¦‚æœä¹‹å‰å› ä¸ºæœªç™»å½•æ²¡æœ‰è·å–ä¼šå‘˜ä¿¡æ¯ï¼Œç°åœ¨è·å–\n        if (!this.membershipInfo && this.userId) {\n          this.fetchMembership();\n          this.fetchStudentStatus();\n        }\n      }\n    },\n    // è·³è½¬åˆ°ç™»å½•é¡µé¢\n    goToLogin() {\n      this.$router.push('/login');\n    },\n    // è¿”å›é¦–é¡µ\n    goToHome() {\n      this.$router.push('/');\n    },\n    // é€€å‡ºç™»å½•ï¼ˆåªç§»é™¤ç™»å½•çŠ¶æ€ï¼Œä¸æ¸…é™¤è´­ç‰©è½¦æ•°æ®ï¼‰\n    handleLogout() {\n      if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿè´­ç‰©è½¦æ•°æ®å°†è¢«æ¸…ç©ºã€‚')) {\n        return;\n      }\n\n      // æ¸…ç©ºè´­ç‰©è½¦æ•°æ®\n      localStorage.removeItem('lenovo_cart');\n      // æ¸…é™¤ç™»å½•çŠ¶æ€\n      localStorage.removeItem('isLoggedIn');\n      localStorage.removeItem('username');\n      // è·³è½¬åˆ°é¦–é¡µ\n      this.$router.push('/');\n    },\n    // å¤„ç†æœ¬åœ°å­˜å‚¨å˜åŒ–\n    handleStorageChange(event) {\n      if (event.key === 'isLoggedIn') {\n        this.checkLoginStatus();\n        this.loadCart();\n      }\n    },\n    // è·å–æ‰€æœ‰å•†å“\n    async fetchAllProducts() {\n      try {\n        const response = await fetch(apiConfig.product.getAllProducts);\n        const result = await response.json();\n\n        // æ ¹æ®åç«¯æ•°æ®ç»“æ„è°ƒæ•´\n        if (result.code === 1 && result.data) {\n          this.allProducts = result.data.map(product => ({\n            ...product,\n            added: false,\n            id: product.pid || product.id,\n            name: product.name,\n            price: product.price,\n            brand: product.brand || 'è”æƒ³'\n          }));\n        } else {\n          console.warn('è·å–å•†å“æ•°æ®å¤±è´¥:', result.msg);\n          this.allProducts = [];\n        }\n      } catch (error) {\n        console.error('è·å–å•†å“æ•°æ®å¤±è´¥:', error);\n        this.allProducts = [];\n      }\n    },\n    // ç”Ÿæˆå•†å“æ¨è\n    async generateProductRecommendations() {\n      try {\n        // æš‚æ—¶ä½¿ç”¨å‰ç«¯æ¨¡æ‹Ÿé€»è¾‘\n        if (this.allProducts.length > 0) {\n          // è¿‡æ»¤æ‰å·²ç»åœ¨è´­ç‰©è½¦ä¸­çš„å•†å“\n          const cartItemIds = this.cartItems.map(item => item.id);\n          const availableProducts = this.allProducts.filter(product => !cartItemIds.includes(product.id));\n\n          // éšæœºé€‰æ‹©4ä¸ªå•†å“ä½œä¸ºæ¨è\n          const shuffled = [...availableProducts].sort(() => 0.5 - Math.random());\n          this.recommendedProducts = shuffled.slice(0, 4).map(product => ({\n            ...product,\n            added: false\n          }));\n        }\n      } catch (error) {\n        console.error('ç”Ÿæˆæ¨èå•†å“å¤±è´¥:', error);\n        this.recommendedProducts = [];\n      }\n    },\n    // ä»åç«¯åŠ è½½è´­ç‰©è½¦\n    async loadCart() {\n      if (!this.userId) {\n        this.cartItems = [];\n        return;\n      }\n      try {\n        const response = await axios.get(apiConfig.user.getUserCart(this.userId));\n        if (response.data.code === 1 && response.data.data) {\n          // åç«¯è¿”å›çš„è´­ç‰©è½¦æ•°æ®æ ¼å¼: [{cid, uid, pid, quantity, bid}]\n          // éœ€è¦è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼ï¼Œå¹¶è·å–å•†å“è¯¦æƒ…\n          const cartData = response.data.data;\n\n          // è·å–æ‰€æœ‰å•†å“ä¿¡æ¯ä»¥è¡¥å……å•†å“è¯¦æƒ…\n          if (this.allProducts.length === 0) {\n            await this.fetchAllProducts();\n          }\n\n          // è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼\n          this.cartItems = cartData.map(cartItem => {\n            const product = this.allProducts.find(p => (p.pid || p.id) == cartItem.pid);\n            // ç¡®ä¿ bid å­˜åœ¨ä¸”ä¸ºæœ‰æ•ˆæ•°å­—\n            let bid = 1;\n            if (cartItem.bid) {\n              bid = parseInt(cartItem.bid);\n            } else if (product && product.bid) {\n              bid = parseInt(product.bid);\n            }\n            if (isNaN(bid) || bid <= 0) bid = 1;\n            return {\n              id: cartItem.pid,\n              cid: cartItem.cid,\n              // ä¿å­˜è´­ç‰©è½¦é¡¹IDï¼Œç”¨äºæ›´æ–°å’Œåˆ é™¤\n              pid: cartItem.pid,\n              bid: bid,\n              // ç¡®ä¿ bid è¢«ä¿å­˜ä¸ºæ•°å­—\n              quantity: cartItem.quantity,\n              name: product?.name || 'å•†å“',\n              price: product?.price || 0,\n              brand: product?.brand || 'è”æƒ³',\n              imageUrl: product?.imageUrl || ''\n            };\n          });\n          this.updateCartBadge();\n        } else {\n          this.cartItems = [];\n        }\n      } catch (error) {\n        console.error('åŠ è½½è´­ç‰©è½¦å¤±è´¥:', error);\n        this.cartItems = [];\n      }\n    },\n    // æ›´æ–°è´­ç‰©è½¦è§’æ ‡ï¼ˆè§¦å‘äº‹ä»¶é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼‰\n    updateCartBadge() {\n      const totalItems = this.cartItems.reduce((total, item) => total + (item.quantity || 0), 0);\n      // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè®©å…¶ä»–ç»„ä»¶çŸ¥é“è´­ç‰©è½¦æ•°é‡å˜åŒ–\n      const event = new CustomEvent('cart-updated', {\n        detail: {\n          count: totalItems\n        }\n      });\n      window.dispatchEvent(event);\n    },\n    // å¢åŠ å•†å“æ•°é‡\n    async increaseQuantity(productId) {\n      const item = this.cartItems.find(item => item.id === productId);\n      if (!item || !this.userId) return;\n      try {\n        const newQuantity = item.quantity + 1;\n\n        // å¦‚æœæœ‰cidï¼Œä½¿ç”¨æ›´æ–°æ¥å£ï¼›å¦åˆ™ä½¿ç”¨æ·»åŠ æ¥å£\n        if (item.cid) {\n          const response = await axios.put(apiConfig.user.updateCartQuantity, {\n            uid: this.userId,\n            cid: item.cid,\n            quantity: newQuantity\n          });\n          if (response.data.code === 1) {\n            item.quantity = newQuantity;\n            this.updateCartBadge();\n          } else {\n            alert(response.data.msg || 'æ›´æ–°å¤±è´¥');\n          }\n        } else {\n          // å¦‚æœæ²¡æœ‰cidï¼Œè¯´æ˜æ˜¯æ–°æ·»åŠ çš„å•†å“ï¼Œè°ƒç”¨æ·»åŠ æ¥å£\n          const product = this.allProducts.find(p => (p.pid || p.id) == productId);\n          await this.addToCartBackend(product || {\n            id: productId,\n            bid: item.bid || 1\n          });\n        }\n      } catch (error) {\n        console.error('å¢åŠ æ•°é‡å¤±è´¥:', error);\n        alert('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n      }\n    },\n    // å‡å°‘å•†å“æ•°é‡\n    async decreaseQuantity(productId) {\n      const item = this.cartItems.find(item => item.id === productId);\n      if (!item || item.quantity <= 1 || !this.userId) return;\n      try {\n        const newQuantity = item.quantity - 1;\n        if (item.cid) {\n          const response = await axios.put(apiConfig.user.updateCartQuantity, {\n            uid: this.userId,\n            cid: item.cid,\n            quantity: newQuantity\n          });\n          if (response.data.code === 1) {\n            item.quantity = newQuantity;\n            this.updateCartBadge();\n          } else {\n            alert(response.data.msg || 'æ›´æ–°å¤±è´¥');\n          }\n        }\n      } catch (error) {\n        console.error('å‡å°‘æ•°é‡å¤±è´¥:', error);\n        alert('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n      }\n    },\n    // åˆ é™¤å•†å“\n    async removeItem(productId) {\n      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) return;\n      if (!this.userId) return;\n      const item = this.cartItems.find(item => item.id === productId);\n      if (!item) return;\n      try {\n        let response;\n\n        // å¦‚æœæœ‰cidï¼Œä½¿ç”¨cidåˆ é™¤ï¼›å¦åˆ™ä½¿ç”¨pidåˆ é™¤\n        if (item.cid) {\n          response = await axios.delete(apiConfig.user.deleteCartItemByCid(item.cid, this.userId));\n        } else {\n          response = await axios.delete(apiConfig.user.deleteCartItem(this.userId, productId));\n        }\n        if (response.data.code === 1) {\n          this.cartItems = this.cartItems.filter(item => item.id !== productId);\n          this.updateCartBadge();\n          this.generateProductRecommendations();\n        } else {\n          alert(response.data.msg || 'åˆ é™¤å¤±è´¥');\n        }\n      } catch (error) {\n        console.error('åˆ é™¤å•†å“å¤±è´¥:', error);\n        alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n      }\n    },\n    // æ¸…ç©ºè´­ç‰©è½¦\n    async clearCart() {\n      if (!confirm('ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ')) return;\n      if (!this.userId) return;\n      try {\n        const response = await axios.delete(apiConfig.user.clearCart(this.userId));\n        if (response.data.code === 1) {\n          this.cartItems = [];\n          this.updateCartBadge();\n          this.generateProductRecommendations();\n        } else {\n          alert(response.data.msg || 'æ¸…ç©ºå¤±è´¥');\n        }\n      } catch (error) {\n        console.error('æ¸…ç©ºè´­ç‰©è½¦å¤±è´¥:', error);\n        alert('æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n      }\n    },\n    // æ·»åŠ æ¨èå•†å“åˆ°è´­ç‰©è½¦ï¼ˆè°ƒç”¨åç«¯æ¥å£ï¼‰\n    async addToCart(product) {\n      if (!this.userId) {\n        alert('è¯·å…ˆç™»å½•');\n        this.$router.push('/login');\n        return;\n      }\n      await this.addToCartBackend(product);\n    },\n    // è°ƒç”¨åç«¯æ¥å£æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼ˆåˆå¹¶ç›¸åŒå•†å“ï¼‰\n    async addToCartBackend(product) {\n      if (!this.userId) return;\n      try {\n        const productId = product.pid || product.id;\n        const bid = product.bid || 1;\n\n        // å…ˆæ£€æŸ¥è´­ç‰©è½¦ä¸­æ˜¯å¦å·²æœ‰è¯¥å•†å“\n        try {\n          const cartResponse = await axios.get(apiConfig.user.getUserCart(this.userId));\n          if (cartResponse.data.code === 1 && cartResponse.data.data) {\n            const existingItem = cartResponse.data.data.find(item => item.pid == productId);\n            if (existingItem) {\n              // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°æ•°é‡\n              const updateResponse = await axios.put(apiConfig.user.updateCartQuantity, {\n                uid: this.userId,\n                cid: existingItem.cid,\n                quantity: existingItem.quantity + 1\n              });\n              if (updateResponse.data.code === 1) {\n                // é‡æ–°åŠ è½½è´­ç‰©è½¦ä»¥è·å–æœ€æ–°æ•°æ®\n                await this.loadCart();\n                this.showAddToCartMessage(product.name || 'å•†å“');\n              } else {\n                alert(updateResponse.data.msg || 'æ›´æ–°å¤±è´¥');\n              }\n              return;\n            }\n          }\n        } catch (error) {\n          console.error('æ£€æŸ¥è´­ç‰©è½¦å¤±è´¥:', error);\n        }\n\n        // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°å•†å“\n        const response = await axios.post(apiConfig.user.addToCart, {\n          uid: this.userId,\n          pid: productId,\n          bid: bid,\n          quantity: 1\n        });\n        if (response.data.code === 1) {\n          // é‡æ–°åŠ è½½è´­ç‰©è½¦ä»¥è·å–æœ€æ–°æ•°æ®ï¼ˆåŒ…æ‹¬cidï¼‰\n          await this.loadCart();\n\n          // æ ‡è®°ä¸ºå·²æ·»åŠ \n          const productIndex = this.recommendedProducts.findIndex(p => (p.pid || p.id) == productId);\n          if (productIndex !== -1) {\n            this.recommendedProducts[productIndex].added = true;\n          }\n          this.showAddToCartMessage(product.name || 'å•†å“');\n        } else {\n          alert(response.data.msg || 'æ·»åŠ å¤±è´¥');\n        }\n      } catch (error) {\n        console.error('æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥:', error);\n        alert('æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n      }\n    },\n    // æ˜¾ç¤ºæ·»åŠ æˆåŠŸæ¶ˆæ¯\n    showAddToCartMessage(productName) {\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶å…ƒç´ æ˜¾ç¤ºæ¶ˆæ¯\n      const message = document.createElement('div');\n      message.className = 'add-to-cart-message';\n      message.textContent = `å·²æ·»åŠ  ${productName} åˆ°è´­ç‰©è½¦`;\n      message.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #4CAF50;\n        color: white;\n        padding: 12px 20px;\n        border-radius: 0;\n        z-index: 1000;\n        animation: fadeInOut 2s ease;\n      `;\n      document.body.appendChild(message);\n      setTimeout(() => {\n        if (message.parentNode) {\n          document.body.removeChild(message);\n        }\n      }, 2000);\n    },\n    // ç»“ç®—\n    checkout() {\n      if (this.cartItems.length === 0) {\n        alert('è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•ç»“ç®—');\n        return;\n      }\n      // é‡ç½®è¡¨å•\n      this.checkoutForm = {\n        province: '',\n        receiverAddress: '',\n        receiverName: '',\n        receiverPhone: '',\n        remark: ''\n      };\n      this.showCheckoutDialog = true;\n    },\n    // å…³é—­ç»“ç®—å¯¹è¯æ¡†\n    closeCheckoutDialog() {\n      this.showCheckoutDialog = false;\n    },\n    // åˆ›å»ºè®¢å•\n    async createOrder() {\n      // éªŒè¯è¡¨å•\n      if (!this.checkoutForm.province) {\n        alert('è¯·é€‰æ‹©çœä»½');\n        return;\n      }\n      if (!this.checkoutForm.receiverAddress || !this.checkoutForm.receiverAddress.trim()) {\n        alert('è¯·è¾“å…¥è¯¦ç»†åœ°å€');\n        return;\n      }\n      if (!this.checkoutForm.receiverName || !this.checkoutForm.receiverName.trim()) {\n        alert('è¯·è¾“å…¥æ”¶è´§äººå§“å');\n        return;\n      }\n      if (!this.checkoutForm.receiverPhone || !this.checkoutForm.receiverPhone.trim()) {\n        alert('è¯·è¾“å…¥è”ç³»ç”µè¯');\n        return;\n      }\n      // éªŒè¯æ‰‹æœºå·æ ¼å¼ï¼ˆç®€å•éªŒè¯ï¼‰\n      const phoneRegex = /^1[3-9]\\d{9}$/;\n      if (!phoneRegex.test(this.checkoutForm.receiverPhone.trim())) {\n        alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ');\n        return;\n      }\n      if (!this.userId) {\n        alert('æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•');\n        this.$router.push('/login');\n        return;\n      }\n      this.isCreatingOrder = true;\n      try {\n        // å°†è´­ç‰©è½¦æ•°æ®è½¬æ¢ä¸ºè®¢å•æ ¼å¼\n        const orderItems = this.cartItems.map(item => {\n          // åŒé‡ä¿é™©ï¼šå†æ¬¡æ£€æŸ¥ bid\n          let finalBid = 1;\n          if (item.bid) {\n            finalBid = parseInt(item.bid);\n          }\n          if (isNaN(finalBid) || finalBid <= 0) finalBid = 1;\n          return {\n            pid: item.id,\n            quantity: item.quantity,\n            bid: finalBid,\n            name: item.name,\n            // ä¼ é€’å•†å“åç§°ï¼Œé˜²æ­¢åç«¯ç›´æ¥æ’å…¥æ—¶ä¸ºç©º\n            price: item.price // ä¼ é€’å•†å“ä»·æ ¼\n          };\n        });\n\n        // æ‰“å°è¯¦ç»†çš„è¯·æ±‚æ•°æ®ï¼Œç”¨äºè°ƒè¯•\n        console.log('Cart Items before conversion:', JSON.parse(JSON.stringify(this.cartItems)));\n        console.log('Order Items to send:', JSON.parse(JSON.stringify(orderItems)));\n        const orderData = {\n          uid: parseInt(this.userId),\n          items: orderItems,\n          province: this.checkoutForm.province,\n          receiverAddress: this.checkoutForm.receiverAddress.trim(),\n          receiverName: this.checkoutForm.receiverName.trim(),\n          receiverPhone: this.checkoutForm.receiverPhone.trim(),\n          remark: this.checkoutForm.remark.trim() || '',\n          status: 0,\n          // æ–°å»ºè®¢å•é»˜è®¤å¾…å‘è´§\n          totalAmount: this.finalPrice // å‘é€å®é™…æ”¯ä»˜é‡‘é¢\n        };\n        console.log('åˆ›å»ºè®¢å•æ•°æ®:', orderData);\n        const response = await axios.post(apiConfig.order.createOrder, orderData);\n        console.log('Create order response:', response.data);\n        if (response.data.code === 1) {\n          const orderId = response.data.data;\n          alert(`è®¢å•åˆ›å»ºæˆåŠŸï¼è®¢å•å·ï¼š${orderId}`);\n\n          // æ¸…ç©ºè´­ç‰©è½¦ï¼ˆè°ƒç”¨åç«¯æ¥å£ï¼‰\n          if (this.userId) {\n            try {\n              await axios.delete(apiConfig.user.clearCart(this.userId));\n            } catch (error) {\n              console.error('æ¸…ç©ºè´­ç‰©è½¦å¤±è´¥:', error);\n            }\n          }\n          this.cartItems = [];\n          this.updateCartBadge();\n          this.generateProductRecommendations();\n\n          // å…³é—­å¯¹è¯æ¡†\n          this.closeCheckoutDialog();\n\n          // è·³è½¬åˆ°è®¢å•ä¸­å¿ƒ\n          this.$router.push('/user/orders');\n        } else {\n          alert(response.data.msg || 'åˆ›å»ºè®¢å•å¤±è´¥');\n        }\n      } catch (error) {\n        console.error('åˆ›å»ºè®¢å•å¤±è´¥:', error);\n        if (error.response && error.response.data) {\n          alert(error.response.data.msg || 'åˆ›å»ºè®¢å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n        } else {\n          alert('åˆ›å»ºè®¢å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n        }\n      } finally {\n        this.isCreatingOrder = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["apiConfig","axios","name","data","cartItems","isLoggedIn","username","userId","allProducts","recommendedProducts","showCheckoutDialog","isCreatingOrder","membershipInfo","studentStatus","appliedDiscount","type","rate","label","checkoutForm","province","receiverAddress","receiverName","receiverPhone","remark","qrcodeImageSrc","require","provinces","computed","totalItems","reduce","total","item","quantity","totalPrice","price","finalPrice","Math","floor","discountAmount","mounted","checkLoginStatus","setTimeout","loadCart","fetchAllProducts","fetchMembership","fetchStudentStatus","window","addEventListener","handleStorageChange","activated","beforeUnmount","removeEventListener","watch","handler","length","generateProductRecommendations","deep","methods","getMembershipTiers","key","min","max","discount","color","discountText","Infinity","calculateMembership","points","tiers","current","find","t","uid","localStorage","getItem","res","get","user","getUserRole","code","role","Number","applyBestDiscount","error","console","student","getStatus","status","e","loggedIn","log","isValidUserId","isValidUsername","userInfoStr","userInfo","JSON","parse","id","goToLogin","$router","push","goToHome","handleLogout","confirm","removeItem","event","response","fetch","product","getAllProducts","result","json","map","added","pid","brand","warn","msg","cartItemIds","availableProducts","filter","includes","shuffled","sort","random","slice","getUserCart","cartData","cartItem","p","bid","parseInt","isNaN","cid","imageUrl","updateCartBadge","CustomEvent","detail","count","dispatchEvent","increaseQuantity","productId","newQuantity","put","updateCartQuantity","alert","addToCartBackend","decreaseQuantity","delete","deleteCartItemByCid","deleteCartItem","clearCart","addToCart","cartResponse","existingItem","updateResponse","showAddToCartMessage","post","productIndex","findIndex","productName","message","document","createElement","className","textContent","style","cssText","body","appendChild","parentNode","removeChild","checkout","closeCheckoutDialog","createOrder","trim","phoneRegex","test","orderItems","finalBid","stringify","orderData","items","totalAmount","order","orderId"],"sources":["D:\\1_homework_file\\å¤§ä¸‰ä¸Š\\è½¯ä»¶å·¥ç¨‹\\é¡¹ç›®ç•™æ¡£\\1å‰ç«¯å¼€å‘_æˆ‘æ‰æ˜¯çœŸçš„\\version5.0\\src\\views\\user\\CartView.vue"],"sourcesContent":["<template>\r\n  <div class=\"cart-view\">\r\n    <!-- å¦‚æœæœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æç¤º -->\r\n    <div v-if=\"!isLoggedIn\" class=\"not-logged-in\">\r\n      <div class=\"login-required\">\r\n        <div class=\"lock-icon\">ğŸ”’</div>\r\n        <h2>éœ€è¦ç™»å½•</h2>\r\n        <p>è¯·å…ˆç™»å½•æ‰èƒ½æŸ¥çœ‹è´­ç‰©è½¦</p>\r\n        <div class=\"login-actions\">\r\n          <button @click=\"goToLogin\" class=\"btn-login\">\r\n            å»ç™»å½•\r\n          </button>\r\n          <button @click=\"goToHome\" class=\"btn-back-home\">\r\n            è¿”å›é¦–é¡µ\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- å¦‚æœå·²ç™»å½•ï¼Œæ˜¾ç¤ºè´­ç‰©è½¦å†…å®¹ -->\r\n    <div v-else>\r\n      <!-- å¯¼èˆª -->\r\n      <div class=\"cart-nav\">\r\n        <div class=\"nav-left\">\r\n          <div class=\"user-welcome\">\r\n            <h1>ğŸ›’ æˆ‘çš„è´­ç‰©è½¦</h1>\r\n            <p class=\"welcome-text\">æ¬¢è¿å›æ¥ï¼Œ{{ username }}ï¼</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"nav-right\">\r\n          <div class=\"cart-actions\">\r\n            <router-link to=\"/\" class=\"continue-shopping\">\r\n              <span class=\"continue-icon\">â†</span>\r\n              ç»§ç»­è´­ç‰©\r\n            </router-link>\r\n            <button @click=\"handleLogout\" class=\"logout-btn\">\r\n              <span class=\"logout-icon\">â†ª</span>\r\n              é€€å‡ºç™»å½•\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- è´­ç‰©è½¦å†…å®¹ -->\r\n      <div v-if=\"cartItems.length === 0\" class=\"empty-cart\">\r\n        <div class=\"empty-cart-container\">\r\n          <div class=\"empty-cart-illustration\">\r\n            <div class=\"cart-icon-wrapper\">\r\n              <div class=\"cart-icon\">ğŸ›’</div>\r\n              <div class=\"empty-indicator\">\r\n                <div class=\"empty-line\"></div>\r\n                <div class=\"empty-line\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"empty-cart-content\">\r\n            <h2 class=\"empty-title\">è´­ç‰©è½¦æ˜¯ç©ºçš„</h2>\r\n            <p class=\"empty-subtitle\">å¿«å»æŒ‘é€‰å¿ƒä»ªçš„å•†å“å§ï¼</p>\r\n\r\n            <div class=\"empty-actions\">\r\n              <router-link to=\"/\" class=\"btn-go-shopping\">\r\n                <span class=\"btn-icon\">ğŸ›ï¸</span>\r\n                <span class=\"btn-text\">å»é€›é€›</span>\r\n              </router-link>\r\n            </div>\r\n\r\n            <div class=\"empty-tips\">\r\n              <p class=\"tip-item\">ğŸ¯ å‘ç°çƒ­é—¨å•†å“</p>\r\n              <p class=\"tip-item\">âœ¨ æ¯æ—¥æ–°å“æ¨è</p>\r\n              <p class=\"tip-item\">ğŸ”¥ é™æ—¶ä¼˜æƒ æ´»åŠ¨</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-else>\r\n        <!-- è´­ç‰©è½¦ä¸»ä½“å†…å®¹ï¼šå•†å“åˆ—è¡¨åœ¨å·¦ï¼Œè®¢å•æ±‡æ€»åœ¨å³ -->\r\n        <div class=\"cart-main-content\">\r\n          <!-- å·¦ä¾§ï¼šå•†å“åˆ—è¡¨ -->\r\n          <div class=\"cart-left-section\">\r\n            <div class=\"cart-items\">\r\n              <div class=\"cart-header\">\r\n                <h3>å•†å“åˆ—è¡¨ ({{ totalItems }}ä»¶)</h3>\r\n                <button @click=\"clearCart\" class=\"btn-clear\">\r\n                  æ¸…ç©ºè´­ç‰©è½¦\r\n                </button>\r\n              </div>\r\n\r\n              <div class=\"items-list\">\r\n                <div v-for=\"item in cartItems\" :key=\"item.id\" class=\"cart-item\">\r\n                  <div class=\"item-info\">\r\n                    <div class=\"item-name\">{{ item.name }}</div>\r\n                    <div class=\"item-price\">Â¥{{ item.price.toLocaleString() }}</div>\r\n                  </div>\r\n\r\n                  <div class=\"item-quantity\">\r\n                    <button\r\n                        @click=\"decreaseQuantity(item.id)\"\r\n                        :disabled=\"item.quantity <= 1\"\r\n                        class=\"quantity-btn\"\r\n                    >\r\n                      -\r\n                    </button>\r\n                    <span class=\"quantity\">{{ item.quantity }}</span>\r\n                    <button\r\n                        @click=\"increaseQuantity(item.id)\"\r\n                        class=\"quantity-btn\"\r\n                    >\r\n                      +\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div class=\"item-total\">\r\n                    Â¥{{ (item.price * item.quantity).toLocaleString() }}\r\n                  </div>\r\n\r\n                  <button\r\n                      @click=\"removeItem(item.id)\"\r\n                      class=\"btn-remove\"\r\n                  >\r\n                    âœ•\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- å³ä¾§ï¼šè®¢å•æ±‡æ€» -->\r\n          <div class=\"cart-right-section\">\r\n            <div class=\"cart-summary\">\r\n              <h3>è®¢å•æ±‡æ€»</h3>\r\n\r\n              <div class=\"summary-row\">\r\n                <span>å•†å“æ€»æ•°ï¼š</span>\r\n                <span>{{ totalItems }}ä»¶</span>\r\n              </div>\r\n\r\n              <div class=\"summary-row\">\r\n                <span>å•†å“æ€»é¢ï¼š</span>\r\n                <span>Â¥{{ totalPrice.toLocaleString() }}</span>\r\n              </div>\r\n\r\n              <div class=\"summary-row discount\" v-if=\"discountAmount > 0\">\r\n                <span>ä¼˜æƒ  ({{ appliedDiscount.label }})ï¼š</span>\r\n                <span>-Â¥{{ discountAmount.toLocaleString() }}</span>\r\n              </div>\r\n\r\n              <div class=\"summary-row total\">\r\n                <span>åº”ä»˜æ€»é¢ï¼š</span>\r\n                <span class=\"total-price\">Â¥{{ finalPrice.toLocaleString() }}</span>\r\n              </div>\r\n\r\n              <button @click=\"checkout\" class=\"btn-checkout\">\r\n                å»ç»“ç®—\r\n              </button>\r\n\r\n              <p class=\"cart-tips\">\r\n                *è´­ç‰©è½¦æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œç”¨æˆ·é‡æ–°ç™»å½•åå¯æ¢å¤\r\n              </p>\r\n\r\n              <div class=\"user-info-footer\">\r\n                <p>å½“å‰ç”¨æˆ·ï¼š<strong>{{ username }}</strong></p>\r\n                <p>ç™»å½•çŠ¶æ€ï¼š<span class=\"status-online\">â— åœ¨çº¿</span></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- ä¸‹æ–¹ï¼šç›¸ä¼¼å•†å“æ¨èæ ï¼ˆç»¿è‰²ç³»ï¼‰ -->\r\n        <div class=\"recommendations-section\">\r\n          <div class=\"recommendations-container\">\r\n            <div class=\"recommendations-header\">\r\n              <h3>âœ¨ ç›¸ä¼¼å•†å“æ¨è</h3>\r\n              <p class=\"recommendations-subtitle\">æ ¹æ®æ‚¨çš„è´­ç‰©è½¦ä¸ºæ‚¨æ¨è</p>\r\n            </div>\r\n\r\n            <div class=\"recommendations-grid\">\r\n              <div v-for=\"product in recommendedProducts\" :key=\"product.id\" class=\"recommended-product\">\r\n                <div class=\"product-card\">\r\n                  <div class=\"product-image-placeholder\">\r\n                    <div class=\"product-icon\">ğŸ’»</div>\r\n                    <div class=\"product-badge\">æ¨è</div>\r\n                  </div>\r\n                  <div class=\"product-info\">\r\n                    <h4 class=\"product-name\">{{ product.name }}</h4>\r\n                    <div class=\"product-price\">Â¥{{ product.price.toLocaleString() }}</div>\r\n                    <div class=\"product-specs\">\r\n                      <span class=\"spec-tag\">{{ product.tag1 || 'è”æƒ³' }}</span>\r\n                      <span class=\"spec-tag\">{{ product.tag2 || 'é«˜æ€§èƒ½' }}</span>\r\n                    </div>\r\n                    <button\r\n                        @click=\"addToCart(product)\"\r\n                        class=\"btn-add-to-cart\"\r\n                        :class=\"{ 'added-to-cart': product.added }\"\r\n                    >\r\n                      <span v-if=\"product.added\" class=\"btn-icon\">âœ“</span>\r\n                      <span v-else class=\"btn-icon\">+</span>\r\n                      {{ product.added ? 'å·²æ·»åŠ ' : 'åŠ å…¥è´­ç‰©è½¦' }}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"recommendations-footer\">\r\n              <p class=\"recommendations-tips\">\r\n                *æ¨èåŸºäºæ‚¨çš„è´­ç‰©è½¦å•†å“å’Œæµè§ˆå†å²\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- ç»“ç®—å¯¹è¯æ¡† -->\r\n    <div v-if=\"showCheckoutDialog\" class=\"checkout-dialog-overlay\" @click.self=\"closeCheckoutDialog\">\r\n      <div class=\"checkout-dialog\">\r\n        <div class=\"dialog-header\">\r\n          <h2>å¡«å†™æ”¶è´§ä¿¡æ¯</h2>\r\n          <button @click=\"closeCheckoutDialog\" class=\"close-btn\">âœ•</button>\r\n        </div>\r\n        <div class=\"dialog-content\">\r\n          <div class=\"form-group\">\r\n            <label>çœä»½ï¼š<span class=\"required\">*</span></label>\r\n            <select v-model=\"checkoutForm.province\" class=\"form-input\" required>\r\n              <option value=\"\">è¯·é€‰æ‹©çœä»½</option>\r\n              <option v-for=\"p in provinces\" :key=\"p\" :value=\"p\">{{ p }}</option>\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>è¯¦ç»†åœ°å€ï¼š<span class=\"required\">*</span></label>\r\n            <input\r\n              v-model=\"checkoutForm.receiverAddress\"\r\n              type=\"text\"\r\n              class=\"form-input\"\r\n              placeholder=\"è¯·è¾“å…¥è¯¦ç»†åœ°å€\"\r\n              required\r\n            />\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>æ”¶è´§äººï¼š<span class=\"required\">*</span></label>\r\n            <input\r\n              v-model=\"checkoutForm.receiverName\"\r\n              type=\"text\"\r\n              class=\"form-input\"\r\n              placeholder=\"è¯·è¾“å…¥æ”¶è´§äººå§“å\"\r\n              required\r\n            />\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>è”ç³»ç”µè¯ï¼š<span class=\"required\">*</span></label>\r\n            <input\r\n              v-model=\"checkoutForm.receiverPhone\"\r\n              type=\"tel\"\r\n              class=\"form-input\"\r\n              placeholder=\"è¯·è¾“å…¥è”ç³»ç”µè¯\"\r\n              required\r\n            />\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>å¤‡æ³¨ï¼š</label>\r\n            <textarea\r\n              v-model=\"checkoutForm.remark\"\r\n              class=\"form-textarea\"\r\n              placeholder=\"é€‰å¡«ï¼Œå¦‚ï¼šå·¥ä½œæ—¥é…é€ã€éœ€è¦å‘ç¥¨ç­‰\"\r\n              rows=\"3\"\r\n            ></textarea>\r\n          </div>\r\n          <div class=\"order-summary-info\">\r\n            <div class=\"summary-item\">\r\n              <span>å•†å“æ•°é‡ï¼š</span>\r\n              <span>{{ totalItems }}ä»¶</span>\r\n            </div>\r\n            <div class=\"summary-item\">\r\n              <span>è®¢å•æ€»é¢ï¼š</span>\r\n              <span class=\"total-price\">Â¥{{ finalPrice.toLocaleString() }}</span>\r\n            </div>\r\n          </div>\r\n          <!-- ä»˜æ¬¾äºŒç»´ç  -->\r\n          <div class=\"payment-qrcode-section\">\r\n            <div class=\"qrcode-label\">æ‰«ç ä»˜æ¬¾</div>\r\n            <div class=\"qrcode-container\">\r\n              <img :src=\"qrcodeImageSrc\" alt=\"ä»˜æ¬¾äºŒç»´ç \" class=\"qrcode-image\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"dialog-footer\">\r\n          <button @click=\"closeCheckoutDialog\" class=\"btn-cancel\">å–æ¶ˆ</button>\r\n          <button @click=\"createOrder\" class=\"btn-submit\" :disabled=\"isCreatingOrder\">\r\n            {{ isCreatingOrder ? 'åˆ›å»ºä¸­...' : 'æäº¤è®¢å•' }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport apiConfig from '@/config/api.config';\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  name: 'CartView',\r\n  data() {\r\n    return {\r\n      cartItems: [],\r\n      isLoggedIn: false,\r\n      username: '',\r\n      userId: null,\r\n      allProducts: [],\r\n      recommendedProducts: [],\r\n      showCheckoutDialog: false,\r\n      isCreatingOrder: false,\r\n      membershipInfo: null,\r\n      studentStatus: null,\r\n      appliedDiscount: {\r\n        type: 'none', // none, student, membership\r\n        rate: 1,\r\n        label: 'æ— ä¼˜æƒ '\r\n      },\r\n      checkoutForm: {\r\n        province: '',\r\n        receiverAddress: '',\r\n        receiverName: '',\r\n        receiverPhone: '',\r\n        remark: ''\r\n      },\r\n      qrcodeImageSrc: require('@/assets/ä»˜æ¬¾.jpg'),\r\n      provinces: [\r\n        'åŒ—äº¬å¸‚', 'å¤©æ´¥å¸‚', 'ä¸Šæµ·å¸‚', 'é‡åº†å¸‚',\r\n        'æ²³åŒ—çœ', 'å±±è¥¿çœ', 'è¾½å®çœ', 'å‰æ—çœ', 'é»‘é¾™æ±Ÿçœ',\r\n        'æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ', 'å®‰å¾½çœ', 'ç¦å»ºçœ', 'æ±Ÿè¥¿çœ', 'å±±ä¸œçœ',\r\n        'æ²³å—çœ', 'æ¹–åŒ—çœ', 'æ¹–å—çœ', 'å¹¿ä¸œçœ', 'æµ·å—çœ',\r\n        'å››å·çœ', 'è´µå·çœ', 'äº‘å—çœ', 'é™•è¥¿çœ', 'ç”˜è‚ƒçœ', 'é’æµ·çœ', 'å°æ¹¾çœ',\r\n        'å†…è’™å¤è‡ªæ²»åŒº', 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº', 'è¥¿è—è‡ªæ²»åŒº', 'å®å¤å›æ—è‡ªæ²»åŒº', 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº',\r\n        'é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº', 'æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº'\r\n      ]\r\n    };\r\n  },\r\n  computed: {\r\n    totalItems() {\r\n      return this.cartItems.reduce((total, item) => total + item.quantity, 0);\r\n    },\r\n    totalPrice() {\r\n      return this.cartItems.reduce((total, item) => total + item.price * item.quantity, 0);\r\n    },\r\n    finalPrice() {\r\n      return Math.floor(this.totalPrice * this.appliedDiscount.rate);\r\n    },\r\n    discountAmount() {\r\n      return this.totalPrice - this.finalPrice;\r\n    }\r\n  },\r\n  mounted() {\r\n    this.checkLoginStatus();\r\n    // åŒé‡æ£€æŸ¥ï¼šå¦‚æœé¦–æ¬¡æ£€æŸ¥å¤±è´¥ï¼Œå»¶è¿Ÿå†æ¬¡æ£€æŸ¥\r\n    setTimeout(() => {\r\n      if (!this.isLoggedIn) {\r\n        this.checkLoginStatus();\r\n      }\r\n    }, 500);\r\n\r\n    this.loadCart();\r\n    this.fetchAllProducts();\r\n    if (this.userId) {\r\n      this.fetchMembership();\r\n      this.fetchStudentStatus();\r\n    }\r\n    window.addEventListener('storage', this.handleStorageChange);\r\n    // ç›‘å¬è‡ªå®šä¹‰ç™»å½•äº‹ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰\r\n    window.addEventListener('login-status-changed', this.checkLoginStatus);\r\n  },\r\n  // æ·»åŠ  activated é’©å­ä»¥æ”¯æŒ keep-alive åœºæ™¯ï¼ˆè™½ç„¶ç›®å‰ App.vue æ²¡ç”¨ï¼Œä½†é¢„é˜²ä¸‡ä¸€ï¼‰\r\n  activated() {\r\n    this.checkLoginStatus();\r\n    this.loadCart();\r\n  },\r\n  beforeUnmount() {\r\n    window.removeEventListener('storage', this.handleStorageChange);\r\n    window.removeEventListener('login-status-changed', this.checkLoginStatus);\r\n  },\r\n  watch: {\r\n    cartItems: {\r\n      handler() {\r\n        if (this.allProducts.length > 0) {\r\n          this.generateProductRecommendations();\r\n        }\r\n      },\r\n      deep: true\r\n    }\r\n  },\r\n  methods: {\r\n    // è·å–ä¼šå‘˜ç­‰çº§å®šä¹‰\r\n    getMembershipTiers() {\r\n      return [\r\n        { key: 'normal', label: 'æ™®é€šä¼šå‘˜', min: 0, max: 3000, discount: 1, color: '#64b5f6', discountText: 'ä¸æ‰“æŠ˜' },\r\n        { key: 'vip', label: 'VIPä¼šå‘˜', min: 3000, max: 6000, discount: 0.95, color: '#7e57c2', discountText: '9.5æŠ˜' },\r\n        { key: 'svip', label: 'SVIPä¼šå‘˜', min: 6000, max: 12000, discount: 0.9, color: '#ff9800', discountText: '9æŠ˜' },\r\n        { key: 'king', label: 'é‡‘ä¸»çˆ¸çˆ¸', min: 12000, max: Infinity, discount: 0.8, color: '#fbc02d', discountText: '8æŠ˜' }\r\n      ];\r\n    },\r\n\r\n    // è®¡ç®—ä¼šå‘˜ç­‰çº§\r\n    calculateMembership(points = 0) {\r\n      const tiers = this.getMembershipTiers();\r\n      const current = tiers.find(t => points >= t.min && points < t.max) || tiers[tiers.length - 1];\r\n      return current;\r\n    },\r\n\r\n    // è·å–ä¼šå‘˜ä¿¡æ¯\r\n    async fetchMembership() {\r\n      const uid = localStorage.getItem('userId');\r\n      if (!uid) return;\r\n      try {\r\n        const res = await axios.get(apiConfig.user.getUserRole(uid));\r\n        if (res.data && res.data.code === 1) {\r\n          const role = res.data.data || {};\r\n          const points = Number(role.points || 0);\r\n          this.membershipInfo = this.calculateMembership(points);\r\n          \r\n          // åº”ç”¨ä¼šå‘˜æŠ˜æ‰£\r\n          if (this.membershipInfo.discount < 1) {\r\n             this.applyBestDiscount('membership', this.membershipInfo.discount, this.membershipInfo.label + ' ' + this.membershipInfo.discountText);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('è·å–ä¼šå‘˜ä¿¡æ¯å¤±è´¥:', error);\r\n      }\r\n    },\r\n\r\n    // è·å–å­¦ç”Ÿè®¤è¯çŠ¶æ€\r\n    async fetchStudentStatus() {\r\n      const uid = localStorage.getItem('userId');\r\n      if (!uid) return;\r\n      try {\r\n        const res = await axios.get(apiConfig.student.getStatus(uid));\r\n        if (res.data.code === 1) {\r\n          this.studentStatus = res.data.data;\r\n          // å¦‚æœæ˜¯å­¦ç”Ÿï¼Œä¸”è®¤è¯é€šè¿‡ï¼Œå¯ä»¥ç»™äºˆç‰¹å®šæŠ˜æ‰£ï¼ˆä¾‹å¦‚9æŠ˜ï¼‰\r\n          // è¿™é‡Œå‡è®¾å­¦ç”Ÿäº«å—9æŠ˜ï¼Œå¦‚æœä¼šå‘˜æŠ˜æ‰£æ›´ä½åˆ™è¦†ç›–\r\n          if (this.studentStatus && this.studentStatus.status === 1) {\r\n             this.applyBestDiscount('student', 0.9, 'å­¦ç”Ÿè®¤è¯ä¼˜æƒ  9æŠ˜');\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('è·å–å­¦ç”Ÿè®¤è¯çŠ¶æ€å¤±è´¥', e);\r\n      }\r\n    },\r\n\r\n    // åº”ç”¨æœ€ä¼˜æŠ˜æ‰£\r\n    applyBestDiscount(type, rate, label) {\r\n        // å¦‚æœæ–°æŠ˜æ‰£åŠ›åº¦æ›´å¤§ï¼ˆrateæ›´å°ï¼‰ï¼Œæˆ–è€…æ²¡æœ‰æŠ˜æ‰£æ—¶ï¼Œåº”ç”¨æ–°æŠ˜æ‰£\r\n        if (rate < this.appliedDiscount.rate || (this.appliedDiscount.rate === 1 && rate < 1)) {\r\n            this.appliedDiscount = {\r\n                type,\r\n                rate,\r\n                label\r\n            };\r\n        }\r\n    },\r\n\r\n    // æ£€æŸ¥ç™»å½•çŠ¶æ€\r\n    checkLoginStatus() {\r\n      const loggedIn = localStorage.getItem('isLoggedIn') === 'true';\r\n      const username = localStorage.getItem('username');\r\n      const userId = localStorage.getItem('userId');\r\n\r\n      console.log('CartView æ£€æŸ¥ç™»å½•çŠ¶æ€:', { loggedIn, username, userId });\r\n\r\n      // å®¹é”™å¤„ç†ï¼šå¦‚æœ isLoggedIn ä¸¢å¤±ä½†æœ‰ userId æˆ– usernameï¼Œä¹Ÿè§†ä¸ºå·²ç™»å½•\r\n      // æ’é™¤ 'null', 'undefined' å­—ç¬¦ä¸²çš„æƒ…å†µ\r\n      const isValidUserId = userId && userId !== 'null' && userId !== 'undefined';\r\n      const isValidUsername = username && username !== 'null' && username !== 'undefined';\r\n      this.isLoggedIn = loggedIn || isValidUserId || isValidUsername;\r\n      \r\n      if (this.isLoggedIn) {\r\n        this.username = username || 'ç”¨æˆ·';\r\n        this.userId = userId;\r\n        // å¦‚æœæ²¡æœ‰userIdä½†æœ‰usernameï¼Œå°è¯•ä»userInfoæ¢å¤userId\r\n        if (!this.userId) {\r\n           try {\r\n             const userInfoStr = localStorage.getItem('userInfo');\r\n             if (userInfoStr) {\r\n               const userInfo = JSON.parse(userInfoStr);\r\n               if (userInfo.uid || userInfo.id) {\r\n                 this.userId = userInfo.uid || userInfo.id;\r\n               }\r\n             }\r\n           } catch(e) {\r\n             console.error('æ¢å¤userIdå¤±è´¥', e);\r\n           }\r\n        }\r\n\r\n        // å¦‚æœä¹‹å‰å› ä¸ºæœªç™»å½•æ²¡æœ‰è·å–ä¼šå‘˜ä¿¡æ¯ï¼Œç°åœ¨è·å–\r\n        if (!this.membershipInfo && this.userId) {\r\n          this.fetchMembership();\r\n          this.fetchStudentStatus();\r\n        }\r\n      }\r\n    },\r\n\r\n    // è·³è½¬åˆ°ç™»å½•é¡µé¢\r\n    goToLogin() {\r\n      this.$router.push('/login');\r\n    },\r\n\r\n    // è¿”å›é¦–é¡µ\r\n    goToHome() {\r\n      this.$router.push('/');\r\n    },\r\n\r\n    // é€€å‡ºç™»å½•ï¼ˆåªç§»é™¤ç™»å½•çŠ¶æ€ï¼Œä¸æ¸…é™¤è´­ç‰©è½¦æ•°æ®ï¼‰\r\n    handleLogout() {\r\n      if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿè´­ç‰©è½¦æ•°æ®å°†è¢«æ¸…ç©ºã€‚')) {\r\n        return;\r\n      }\r\n      \r\n      // æ¸…ç©ºè´­ç‰©è½¦æ•°æ®\r\n      localStorage.removeItem('lenovo_cart');\r\n      // æ¸…é™¤ç™»å½•çŠ¶æ€\r\n      localStorage.removeItem('isLoggedIn');\r\n      localStorage.removeItem('username');\r\n      // è·³è½¬åˆ°é¦–é¡µ\r\n      this.$router.push('/');\r\n    },\r\n\r\n    // å¤„ç†æœ¬åœ°å­˜å‚¨å˜åŒ–\r\n    handleStorageChange(event) {\r\n      if (event.key === 'isLoggedIn') {\r\n        this.checkLoginStatus();\r\n        this.loadCart();\r\n      }\r\n    },\r\n\r\n    // è·å–æ‰€æœ‰å•†å“\r\n    async fetchAllProducts() {\r\n      try {\r\n        const response = await fetch(apiConfig.product.getAllProducts);\r\n        const result = await response.json();\r\n\r\n        // æ ¹æ®åç«¯æ•°æ®ç»“æ„è°ƒæ•´\r\n        if (result.code === 1 && result.data) {\r\n          this.allProducts = result.data.map(product => ({\r\n            ...product,\r\n            added: false,\r\n            id: product.pid || product.id,\r\n            name: product.name,\r\n            price: product.price,\r\n            brand: product.brand || 'è”æƒ³'\r\n          }));\r\n        } else {\r\n          console.warn('è·å–å•†å“æ•°æ®å¤±è´¥:', result.msg);\r\n          this.allProducts = [];\r\n        }\r\n      } catch (error) {\r\n        console.error('è·å–å•†å“æ•°æ®å¤±è´¥:', error);\r\n        this.allProducts = [];\r\n      }\r\n    },\r\n\r\n    // ç”Ÿæˆå•†å“æ¨è\r\n    async generateProductRecommendations() {\r\n      try {\r\n        // æš‚æ—¶ä½¿ç”¨å‰ç«¯æ¨¡æ‹Ÿé€»è¾‘\r\n        if (this.allProducts.length > 0) {\r\n          // è¿‡æ»¤æ‰å·²ç»åœ¨è´­ç‰©è½¦ä¸­çš„å•†å“\r\n          const cartItemIds = this.cartItems.map(item => item.id);\r\n          const availableProducts = this.allProducts.filter(\r\n              product => !cartItemIds.includes(product.id)\r\n          );\r\n\r\n          // éšæœºé€‰æ‹©4ä¸ªå•†å“ä½œä¸ºæ¨è\r\n          const shuffled = [...availableProducts].sort(() => 0.5 - Math.random());\r\n          this.recommendedProducts = shuffled.slice(0, 4).map(product => ({\r\n            ...product,\r\n            added: false\r\n          }));\r\n        }\r\n      } catch (error) {\r\n        console.error('ç”Ÿæˆæ¨èå•†å“å¤±è´¥:', error);\r\n        this.recommendedProducts = [];\r\n      }\r\n    },\r\n\r\n    // ä»åç«¯åŠ è½½è´­ç‰©è½¦\r\n    async loadCart() {\r\n      if (!this.userId) {\r\n        this.cartItems = [];\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const response = await axios.get(apiConfig.user.getUserCart(this.userId));\r\n        if (response.data.code === 1 && response.data.data) {\r\n          // åç«¯è¿”å›çš„è´­ç‰©è½¦æ•°æ®æ ¼å¼: [{cid, uid, pid, quantity, bid}]\r\n          // éœ€è¦è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼ï¼Œå¹¶è·å–å•†å“è¯¦æƒ…\r\n          const cartData = response.data.data;\r\n          \r\n          // è·å–æ‰€æœ‰å•†å“ä¿¡æ¯ä»¥è¡¥å……å•†å“è¯¦æƒ…\r\n          if (this.allProducts.length === 0) {\r\n            await this.fetchAllProducts();\r\n          }\r\n\r\n          // è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼\r\n          this.cartItems = cartData.map(cartItem => {\r\n            const product = this.allProducts.find(p => (p.pid || p.id) == cartItem.pid);\r\n            // ç¡®ä¿ bid å­˜åœ¨ä¸”ä¸ºæœ‰æ•ˆæ•°å­—\r\n            let bid = 1;\r\n            if (cartItem.bid) {\r\n                bid = parseInt(cartItem.bid);\r\n            } else if (product && product.bid) {\r\n                bid = parseInt(product.bid);\r\n            }\r\n            \r\n            if (isNaN(bid) || bid <= 0) bid = 1;\r\n\r\n            return {\r\n              id: cartItem.pid,\r\n              cid: cartItem.cid, // ä¿å­˜è´­ç‰©è½¦é¡¹IDï¼Œç”¨äºæ›´æ–°å’Œåˆ é™¤\r\n              pid: cartItem.pid,\r\n              bid: bid, // ç¡®ä¿ bid è¢«ä¿å­˜ä¸ºæ•°å­—\r\n              quantity: cartItem.quantity,\r\n              name: product?.name || 'å•†å“',\r\n              price: product?.price || 0,\r\n              brand: product?.brand || 'è”æƒ³',\r\n              imageUrl: product?.imageUrl || ''\r\n            };\r\n          });\r\n\r\n          this.updateCartBadge();\r\n        } else {\r\n          this.cartItems = [];\r\n        }\r\n      } catch (error) {\r\n        console.error('åŠ è½½è´­ç‰©è½¦å¤±è´¥:', error);\r\n        this.cartItems = [];\r\n      }\r\n    },\r\n\r\n    // æ›´æ–°è´­ç‰©è½¦è§’æ ‡ï¼ˆè§¦å‘äº‹ä»¶é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼‰\r\n    updateCartBadge() {\r\n      const totalItems = this.cartItems.reduce((total, item) => total + (item.quantity || 0), 0);\r\n      // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè®©å…¶ä»–ç»„ä»¶çŸ¥é“è´­ç‰©è½¦æ•°é‡å˜åŒ–\r\n      const event = new CustomEvent('cart-updated', { detail: { count: totalItems } });\r\n      window.dispatchEvent(event);\r\n    },\r\n\r\n    // å¢åŠ å•†å“æ•°é‡\r\n    async increaseQuantity(productId) {\r\n      const item = this.cartItems.find(item => item.id === productId);\r\n      if (!item || !this.userId) return;\r\n\r\n      try {\r\n        const newQuantity = item.quantity + 1;\r\n        \r\n        // å¦‚æœæœ‰cidï¼Œä½¿ç”¨æ›´æ–°æ¥å£ï¼›å¦åˆ™ä½¿ç”¨æ·»åŠ æ¥å£\r\n        if (item.cid) {\r\n          const response = await axios.put(apiConfig.user.updateCartQuantity, {\r\n            uid: this.userId,\r\n            cid: item.cid,\r\n            quantity: newQuantity\r\n          });\r\n          \r\n          if (response.data.code === 1) {\r\n            item.quantity = newQuantity;\r\n            this.updateCartBadge();\r\n          } else {\r\n            alert(response.data.msg || 'æ›´æ–°å¤±è´¥');\r\n          }\r\n        } else {\r\n          // å¦‚æœæ²¡æœ‰cidï¼Œè¯´æ˜æ˜¯æ–°æ·»åŠ çš„å•†å“ï¼Œè°ƒç”¨æ·»åŠ æ¥å£\r\n          const product = this.allProducts.find(p => (p.pid || p.id) == productId);\r\n          await this.addToCartBackend(product || { id: productId, bid: item.bid || 1 });\r\n        }\r\n      } catch (error) {\r\n        console.error('å¢åŠ æ•°é‡å¤±è´¥:', error);\r\n        alert('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    },\r\n\r\n    // å‡å°‘å•†å“æ•°é‡\r\n    async decreaseQuantity(productId) {\r\n      const item = this.cartItems.find(item => item.id === productId);\r\n      if (!item || item.quantity <= 1 || !this.userId) return;\r\n\r\n      try {\r\n        const newQuantity = item.quantity - 1;\r\n        \r\n        if (item.cid) {\r\n          const response = await axios.put(apiConfig.user.updateCartQuantity, {\r\n            uid: this.userId,\r\n            cid: item.cid,\r\n            quantity: newQuantity\r\n          });\r\n          \r\n          if (response.data.code === 1) {\r\n            item.quantity = newQuantity;\r\n            this.updateCartBadge();\r\n          } else {\r\n            alert(response.data.msg || 'æ›´æ–°å¤±è´¥');\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('å‡å°‘æ•°é‡å¤±è´¥:', error);\r\n        alert('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    },\r\n\r\n    // åˆ é™¤å•†å“\r\n    async removeItem(productId) {\r\n      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) return;\r\n      if (!this.userId) return;\r\n\r\n      const item = this.cartItems.find(item => item.id === productId);\r\n      if (!item) return;\r\n\r\n      try {\r\n        let response;\r\n        \r\n        // å¦‚æœæœ‰cidï¼Œä½¿ç”¨cidåˆ é™¤ï¼›å¦åˆ™ä½¿ç”¨pidåˆ é™¤\r\n        if (item.cid) {\r\n          response = await axios.delete(apiConfig.user.deleteCartItemByCid(item.cid, this.userId));\r\n        } else {\r\n          response = await axios.delete(apiConfig.user.deleteCartItem(this.userId, productId));\r\n        }\r\n\r\n        if (response.data.code === 1) {\r\n          this.cartItems = this.cartItems.filter(item => item.id !== productId);\r\n          this.updateCartBadge();\r\n          this.generateProductRecommendations();\r\n        } else {\r\n          alert(response.data.msg || 'åˆ é™¤å¤±è´¥');\r\n        }\r\n      } catch (error) {\r\n        console.error('åˆ é™¤å•†å“å¤±è´¥:', error);\r\n        alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    },\r\n\r\n    // æ¸…ç©ºè´­ç‰©è½¦\r\n    async clearCart() {\r\n      if (!confirm('ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ')) return;\r\n      if (!this.userId) return;\r\n\r\n      try {\r\n        const response = await axios.delete(apiConfig.user.clearCart(this.userId));\r\n        \r\n        if (response.data.code === 1) {\r\n          this.cartItems = [];\r\n          this.updateCartBadge();\r\n          this.generateProductRecommendations();\r\n        } else {\r\n          alert(response.data.msg || 'æ¸…ç©ºå¤±è´¥');\r\n        }\r\n      } catch (error) {\r\n        console.error('æ¸…ç©ºè´­ç‰©è½¦å¤±è´¥:', error);\r\n        alert('æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    },\r\n\r\n    // æ·»åŠ æ¨èå•†å“åˆ°è´­ç‰©è½¦ï¼ˆè°ƒç”¨åç«¯æ¥å£ï¼‰\r\n    async addToCart(product) {\r\n      if (!this.userId) {\r\n        alert('è¯·å…ˆç™»å½•');\r\n        this.$router.push('/login');\r\n        return;\r\n      }\r\n\r\n      await this.addToCartBackend(product);\r\n    },\r\n\r\n    // è°ƒç”¨åç«¯æ¥å£æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼ˆåˆå¹¶ç›¸åŒå•†å“ï¼‰\r\n    async addToCartBackend(product) {\r\n      if (!this.userId) return;\r\n\r\n      try {\r\n        const productId = product.pid || product.id;\r\n        const bid = product.bid || 1;\r\n\r\n        // å…ˆæ£€æŸ¥è´­ç‰©è½¦ä¸­æ˜¯å¦å·²æœ‰è¯¥å•†å“\r\n        try {\r\n          const cartResponse = await axios.get(apiConfig.user.getUserCart(this.userId));\r\n          if (cartResponse.data.code === 1 && cartResponse.data.data) {\r\n            const existingItem = cartResponse.data.data.find(item => item.pid == productId);\r\n            if (existingItem) {\r\n              // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°æ•°é‡\r\n              const updateResponse = await axios.put(apiConfig.user.updateCartQuantity, {\r\n                uid: this.userId,\r\n                cid: existingItem.cid,\r\n                quantity: existingItem.quantity + 1\r\n              });\r\n              if (updateResponse.data.code === 1) {\r\n                // é‡æ–°åŠ è½½è´­ç‰©è½¦ä»¥è·å–æœ€æ–°æ•°æ®\r\n                await this.loadCart();\r\n                this.showAddToCartMessage(product.name || 'å•†å“');\r\n              } else {\r\n                alert(updateResponse.data.msg || 'æ›´æ–°å¤±è´¥');\r\n              }\r\n              return;\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('æ£€æŸ¥è´­ç‰©è½¦å¤±è´¥:', error);\r\n        }\r\n\r\n        // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°å•†å“\r\n        const response = await axios.post(apiConfig.user.addToCart, {\r\n          uid: this.userId,\r\n          pid: productId,\r\n          bid: bid,\r\n          quantity: 1\r\n        });\r\n\r\n        if (response.data.code === 1) {\r\n          // é‡æ–°åŠ è½½è´­ç‰©è½¦ä»¥è·å–æœ€æ–°æ•°æ®ï¼ˆåŒ…æ‹¬cidï¼‰\r\n          await this.loadCart();\r\n          \r\n          // æ ‡è®°ä¸ºå·²æ·»åŠ \r\n          const productIndex = this.recommendedProducts.findIndex(p => (p.pid || p.id) == productId);\r\n          if (productIndex !== -1) {\r\n            this.recommendedProducts[productIndex].added = true;\r\n          }\r\n          \r\n          this.showAddToCartMessage(product.name || 'å•†å“');\r\n        } else {\r\n          alert(response.data.msg || 'æ·»åŠ å¤±è´¥');\r\n        }\r\n      } catch (error) {\r\n        console.error('æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥:', error);\r\n        alert('æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    },\r\n\r\n    // æ˜¾ç¤ºæ·»åŠ æˆåŠŸæ¶ˆæ¯\r\n    showAddToCartMessage(productName) {\r\n      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶å…ƒç´ æ˜¾ç¤ºæ¶ˆæ¯\r\n      const message = document.createElement('div');\r\n      message.className = 'add-to-cart-message';\r\n      message.textContent = `å·²æ·»åŠ  ${productName} åˆ°è´­ç‰©è½¦`;\r\n      message.style.cssText = `\r\n        position: fixed;\r\n        top: 20px;\r\n        right: 20px;\r\n        background: #4CAF50;\r\n        color: white;\r\n        padding: 12px 20px;\r\n        border-radius: 0;\r\n        z-index: 1000;\r\n        animation: fadeInOut 2s ease;\r\n      `;\r\n\r\n      document.body.appendChild(message);\r\n\r\n      setTimeout(() => {\r\n        if (message.parentNode) {\r\n          document.body.removeChild(message);\r\n        }\r\n      }, 2000);\r\n    },\r\n\r\n    // ç»“ç®—\r\n    checkout() {\r\n      if (this.cartItems.length === 0) {\r\n        alert('è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•ç»“ç®—');\r\n        return;\r\n      }\r\n      // é‡ç½®è¡¨å•\r\n      this.checkoutForm = {\r\n        province: '',\r\n        receiverAddress: '',\r\n        receiverName: '',\r\n        receiverPhone: '',\r\n        remark: ''\r\n      };\r\n      this.showCheckoutDialog = true;\r\n    },\r\n    // å…³é—­ç»“ç®—å¯¹è¯æ¡†\r\n    closeCheckoutDialog() {\r\n      this.showCheckoutDialog = false;\r\n    },\r\n    // åˆ›å»ºè®¢å•\r\n    async createOrder() {\r\n      // éªŒè¯è¡¨å•\r\n      if (!this.checkoutForm.province) {\r\n        alert('è¯·é€‰æ‹©çœä»½');\r\n        return;\r\n      }\r\n      if (!this.checkoutForm.receiverAddress || !this.checkoutForm.receiverAddress.trim()) {\r\n        alert('è¯·è¾“å…¥è¯¦ç»†åœ°å€');\r\n        return;\r\n      }\r\n      if (!this.checkoutForm.receiverName || !this.checkoutForm.receiverName.trim()) {\r\n        alert('è¯·è¾“å…¥æ”¶è´§äººå§“å');\r\n        return;\r\n      }\r\n      if (!this.checkoutForm.receiverPhone || !this.checkoutForm.receiverPhone.trim()) {\r\n        alert('è¯·è¾“å…¥è”ç³»ç”µè¯');\r\n        return;\r\n      }\r\n      // éªŒè¯æ‰‹æœºå·æ ¼å¼ï¼ˆç®€å•éªŒè¯ï¼‰\r\n      const phoneRegex = /^1[3-9]\\d{9}$/;\r\n      if (!phoneRegex.test(this.checkoutForm.receiverPhone.trim())) {\r\n        alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ');\r\n        return;\r\n      }\r\n\r\n      if (!this.userId) {\r\n        alert('æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•');\r\n        this.$router.push('/login');\r\n        return;\r\n      }\r\n\r\n      this.isCreatingOrder = true;\r\n\r\n      try {\r\n        // å°†è´­ç‰©è½¦æ•°æ®è½¬æ¢ä¸ºè®¢å•æ ¼å¼\r\n        const orderItems = this.cartItems.map(item => {\r\n          // åŒé‡ä¿é™©ï¼šå†æ¬¡æ£€æŸ¥ bid\r\n          let finalBid = 1;\r\n          if (item.bid) {\r\n             finalBid = parseInt(item.bid);\r\n          }\r\n          if (isNaN(finalBid) || finalBid <= 0) finalBid = 1;\r\n\r\n          return {\r\n            pid: item.id,\r\n            quantity: item.quantity,\r\n            bid: finalBid,\r\n            name: item.name,    // ä¼ é€’å•†å“åç§°ï¼Œé˜²æ­¢åç«¯ç›´æ¥æ’å…¥æ—¶ä¸ºç©º\r\n            price: item.price   // ä¼ é€’å•†å“ä»·æ ¼\r\n          };\r\n        });\r\n\r\n        // æ‰“å°è¯¦ç»†çš„è¯·æ±‚æ•°æ®ï¼Œç”¨äºè°ƒè¯•\r\n        console.log('Cart Items before conversion:', JSON.parse(JSON.stringify(this.cartItems)));\r\n        console.log('Order Items to send:', JSON.parse(JSON.stringify(orderItems)));\r\n\r\n        const orderData = {\r\n          uid: parseInt(this.userId),\r\n          items: orderItems,\r\n          province: this.checkoutForm.province,\r\n          receiverAddress: this.checkoutForm.receiverAddress.trim(),\r\n          receiverName: this.checkoutForm.receiverName.trim(),\r\n          receiverPhone: this.checkoutForm.receiverPhone.trim(),\r\n          remark: this.checkoutForm.remark.trim() || '',\r\n          status: 0, // æ–°å»ºè®¢å•é»˜è®¤å¾…å‘è´§\r\n          totalAmount: this.finalPrice // å‘é€å®é™…æ”¯ä»˜é‡‘é¢\r\n        };\r\n\r\n        console.log('åˆ›å»ºè®¢å•æ•°æ®:', orderData);\r\n\r\n        const response = await axios.post(apiConfig.order.createOrder, orderData);\r\n\r\n        console.log('Create order response:', response.data);\r\n\r\n        if (response.data.code === 1) {\r\n          const orderId = response.data.data;\r\n          alert(`è®¢å•åˆ›å»ºæˆåŠŸï¼è®¢å•å·ï¼š${orderId}`);\r\n          \r\n          // æ¸…ç©ºè´­ç‰©è½¦ï¼ˆè°ƒç”¨åç«¯æ¥å£ï¼‰\r\n          if (this.userId) {\r\n            try {\r\n              await axios.delete(apiConfig.user.clearCart(this.userId));\r\n            } catch (error) {\r\n              console.error('æ¸…ç©ºè´­ç‰©è½¦å¤±è´¥:', error);\r\n            }\r\n          }\r\n          this.cartItems = [];\r\n          this.updateCartBadge();\r\n          this.generateProductRecommendations();\r\n          \r\n          // å…³é—­å¯¹è¯æ¡†\r\n          this.closeCheckoutDialog();\r\n          \r\n          // è·³è½¬åˆ°è®¢å•ä¸­å¿ƒ\r\n          this.$router.push('/user/orders');\r\n        } else {\r\n          alert(response.data.msg || 'åˆ›å»ºè®¢å•å¤±è´¥');\r\n        }\r\n      } catch (error) {\r\n        console.error('åˆ›å»ºè®¢å•å¤±è´¥:', error);\r\n        if (error.response && error.response.data) {\r\n          alert(error.response.data.msg || 'åˆ›å»ºè®¢å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n        } else {\r\n          alert('åˆ›å»ºè®¢å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n        }\r\n      } finally {\r\n        this.isCreatingOrder = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n/* å°†æ‰€æœ‰ border-radius æ”¹ä¸º 0 */\r\n.cart-view {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  min-height: 70vh;\r\n  background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);\r\n  border-radius: 0;\r\n}\r\n\r\n.not-logged-in {\r\n  min-height: 70vh;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.login-required {\r\n  background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);\r\n  border-radius: 0;\r\n  padding: 60px 50px;\r\n  box-shadow: 0 20px 60px rgba(33, 150, 243, 0.15);\r\n  border: 2px solid #bbdefb;\r\n  text-align: center;\r\n  max-width: 400px;\r\n  width: 100%;\r\n}\r\n\r\n.lock-icon {\r\n  font-size: 64px;\r\n  color: #1565c0;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.login-required h2 {\r\n  color: #1565c0;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.login-required p {\r\n  color: #666;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.login-actions {\r\n  display: flex;\r\n  gap: 15px;\r\n  justify-content: center;\r\n}\r\n\r\n.btn-login, .btn-back-home {\r\n  padding: 12px 30px;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  border: none;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.btn-login {\r\n  background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);\r\n  color: white;\r\n}\r\n\r\n.btn-login:hover {\r\n  background: linear-gradient(135deg, #0d47a1 0%, #0a3d8c 100%);\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.btn-back-home {\r\n  background: #f0f0f0;\r\n  color: #333;\r\n  border: 1px solid #ddd;\r\n}\r\n\r\n.btn-back-home:hover {\r\n  background: #e0e0e0;\r\n}\r\n\r\n.cart-nav {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 30px;\r\n  padding: 20px 30px;\r\n  background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);\r\n  border-radius: 0;\r\n  box-shadow: 0 10px 30px rgba(33, 150, 243, 0.1);\r\n  border: 2px solid #bbdefb;\r\n}\r\n\r\n.user-welcome h1 {\r\n  color: #1565c0;\r\n  margin: 0 0 5px 0;\r\n}\r\n\r\n.welcome-text {\r\n  color: #666;\r\n  margin: 0;\r\n}\r\n\r\n.cart-actions {\r\n  display: flex;\r\n  gap: 15px;\r\n}\r\n\r\n.continue-shopping, .logout-btn {\r\n  padding: 10px 20px;\r\n  border-radius: 0;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  text-decoration: none;\r\n  border: none;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.continue-shopping {\r\n  background: #f0f0f0;\r\n  color: #333;\r\n  border: 1px solid #ddd;\r\n}\r\n\r\n.continue-shopping:hover {\r\n  background: #e0e0e0;\r\n}\r\n\r\n.logout-btn {\r\n  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);\r\n  color: white;\r\n}\r\n\r\n.logout-btn:hover {\r\n  background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.empty-cart-container {\r\n  background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);\r\n  border-radius: 0;\r\n  padding: 50px 40px;\r\n  box-shadow: 0 20px 60px rgba(33, 150, 243, 0.15);\r\n  border: 2px solid #bbdefb;\r\n  text-align: center;\r\n}\r\n\r\n.cart-icon-wrapper {\r\n  position: relative;\r\n  display: inline-block;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.cart-icon {\r\n  font-size: 80px;\r\n  opacity: 0.3;\r\n}\r\n\r\n.empty-indicator {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 60px;\r\n  height: 60px;\r\n}\r\n\r\n.empty-line {\r\n  position: absolute;\r\n  background: #ccc;\r\n  width: 60px;\r\n  height: 4px;\r\n  top: 50%;\r\n  left: 50%;\r\n}\r\n\r\n.empty-line:first-child {\r\n  transform: translate(-50%, -50%) rotate(45deg);\r\n}\r\n\r\n.empty-line:last-child {\r\n  transform: translate(-50%, -50%) rotate(-45deg);\r\n}\r\n\r\n.empty-title {\r\n  color: #1565c0;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.empty-subtitle {\r\n  color: #666;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.btn-go-shopping {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);\r\n  color: white;\r\n  padding: 14px 30px;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  text-decoration: none;\r\n  border: none;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.btn-go-shopping:hover {\r\n  background: linear-gradient(135deg, #0d47a1 0%, #0a3d8c 100%);\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.empty-tips {\r\n  margin-top: 30px;\r\n  color: #666;\r\n}\r\n\r\n.tip-item {\r\n  margin: 5px 0;\r\n}\r\n\r\n.cart-main-content {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1fr;\r\n  gap: 30px;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.cart-left-section, .cart-right-section {\r\n  background: white;\r\n  border: 2px solid #bbdefb;\r\n  padding: 20px;\r\n}\r\n\r\n.cart-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  padding-bottom: 15px;\r\n  border-bottom: 2px solid #f0f0f0;\r\n}\r\n\r\n.btn-clear {\r\n  background: #f44336;\r\n  color: white;\r\n  border: none;\r\n  padding: 8px 16px;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n}\r\n\r\n.cart-item {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1fr 1fr auto;\r\n  gap: 15px;\r\n  align-items: center;\r\n  padding: 15px 0;\r\n  border-bottom: 1px solid #f0f0f0;\r\n}\r\n\r\n.item-name {\r\n  font-weight: 600;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.item-price {\r\n  color: #1565c0;\r\n  font-weight: 600;\r\n}\r\n\r\n.item-quantity {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.quantity-btn {\r\n  width: 30px;\r\n  height: 30px;\r\n  border: 1px solid #ddd;\r\n  background: #f9f9f9;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 16px;\r\n}\r\n\r\n.quantity-btn:disabled {\r\n  opacity: 0.5;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.quantity {\r\n  min-width: 30px;\r\n  text-align: center;\r\n  font-weight: 600;\r\n}\r\n\r\n.item-total {\r\n  font-weight: 600;\r\n  color: #1565c0;\r\n  font-size: 18px;\r\n}\r\n\r\n.btn-remove {\r\n  width: 30px;\r\n  height: 30px;\r\n  border: none;\r\n  background: #f44336;\r\n  color: white;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 16px;\r\n}\r\n\r\n.cart-summary h3 {\r\n  color: #1565c0;\r\n  margin-top: 0;\r\n  padding-bottom: 15px;\r\n  border-bottom: 2px solid #f0f0f0;\r\n}\r\n\r\n.summary-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 15px;\r\n  padding-bottom: 15px;\r\n  border-bottom: 1px solid #f0f0f0;\r\n}\r\n\r\n.summary-row.total {\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  color: #1565c0;\r\n  border-bottom: none;\r\n}\r\n\r\n.total-price {\r\n  font-size: 24px;\r\n  color: #1565c0;\r\n}\r\n\r\n.btn-checkout {\r\n  width: 100%;\r\n  background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);\r\n  color: white;\r\n  border: none;\r\n  padding: 16px;\r\n  border-radius: 0;\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  margin: 20px 0;\r\n}\r\n\r\n.btn-checkout:hover {\r\n  background: linear-gradient(135deg, #0d47a1 0%, #0a3d8c 100%);\r\n}\r\n\r\n.cart-tips {\r\n  font-size: 12px;\r\n  color: #999;\r\n  text-align: center;\r\n  margin: 10px 0;\r\n}\r\n\r\n.user-info-footer {\r\n  margin-top: 20px;\r\n  padding-top: 20px;\r\n  border-top: 1px solid #f0f0f0;\r\n  font-size: 14px;\r\n}\r\n\r\n.status-online {\r\n  color: #1565c0;\r\n  font-weight: 600;\r\n}\r\n\r\n.recommendations-container {\r\n  background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);\r\n  border-radius: 0;\r\n  padding: 30px;\r\n  box-shadow: 0 10px 30px rgba(33, 150, 243, 0.1);\r\n  border: 2px solid #bbdefb;\r\n}\r\n\r\n.recommendations-header {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.recommendations-subtitle {\r\n  color: #666;\r\n  margin-top: 5px;\r\n}\r\n\r\n.recommendations-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(4, 1fr);\r\n  gap: 20px;\r\n}\r\n\r\n.product-card {\r\n  border: 1px solid #e0e0e0;\r\n  padding: 15px;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.product-card:hover {\r\n  border-color: #1565c0;\r\n  box-shadow: 0 5px 15px rgba(33, 150, 243, 0.1);\r\n}\r\n\r\n.product-image-placeholder {\r\n  height: 120px;\r\n  background: #f9f9f9;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin-bottom: 15px;\r\n  position: relative;\r\n  border: 1px solid #e0e0e0;\r\n}\r\n\r\n.product-icon {\r\n  font-size: 48px;\r\n}\r\n\r\n.product-badge {\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  background: #1565c0;\r\n  color: white;\r\n  padding: 4px 8px;\r\n  font-size: 12px;\r\n  border-radius: 0;\r\n}\r\n\r\n.product-name {\r\n  font-size: 16px;\r\n  margin: 10px 0;\r\n  height: 40px;\r\n  overflow: hidden;\r\n}\r\n\r\n.product-price {\r\n  color: #1565c0;\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  margin: 10px 0;\r\n}\r\n\r\n.product-specs {\r\n  display: flex;\r\n  gap: 5px;\r\n  margin: 10px 0;\r\n}\r\n\r\n.spec-tag {\r\n  background: #e3f2fd;\r\n  color: #1565c0;\r\n  padding: 4px 8px;\r\n  font-size: 12px;\r\n  border-radius: 0;\r\n}\r\n\r\n.btn-add-to-cart {\r\n  width: 100%;\r\n  background: #1565c0;\r\n  color: white;\r\n  border: none;\r\n  padding: 10px;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 5px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.btn-add-to-cart:hover {\r\n  background: #0d47a1;\r\n}\r\n\r\n.btn-add-to-cart:hover {\r\n  background: #388E3C;\r\n}\r\n\r\n.btn-add-to-cart.added-to-cart:hover {\r\n  background: #555;\r\n}\r\n\r\n.recommendations-tips {\r\n  font-size: 12px;\r\n  color: #999;\r\n  text-align: center;\r\n  margin-top: 20px;\r\n}\r\n\r\n/* å“åº”å¼è®¾è®¡ */\r\n@media (max-width: 768px) {\r\n  .cart-main-content {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .recommendations-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n  }\r\n\r\n  .cart-nav {\r\n    flex-direction: column;\r\n    gap: 15px;\r\n    text-align: center;\r\n  }\r\n\r\n  .cart-item {\r\n    grid-template-columns: 1fr;\r\n    gap: 10px;\r\n  }\r\n\r\n  .login-required {\r\n    padding: 30px 20px;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .recommendations-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .cart-view {\r\n    padding: 10px;\r\n  }\r\n}\r\n</style>\r\n\r\n<style>\r\n/* å…¨å±€åŠ¨ç”»æ ·å¼ */\r\n@keyframes fadeInOut {\r\n  0% {\r\n    opacity: 0;\r\n    transform: translateY(-10px);\r\n  }\r\n  10% {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n  90% {\r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n  100% {\r\n    opacity: 0;\r\n    transform: translateY(-10px);\r\n  }\r\n}\r\n\r\n/* ç»“ç®—å¯¹è¯æ¡†æ ·å¼ */\r\n.checkout-dialog-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.checkout-dialog {\r\n  background: white;\r\n  border-radius: 0;\r\n  width: 90%;\r\n  max-width: 500px;\r\n  max-height: 90vh;\r\n  overflow-y: auto;\r\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\r\n  border: 2px solid #4b6cb7;\r\n}\r\n\r\n.dialog-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20px 25px;\r\n  border-bottom: 2px solid #e0e0e0;\r\n  background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);\r\n  color: white;\r\n}\r\n\r\n.dialog-header h2 {\r\n  margin: 0;\r\n  font-size: 24px;\r\n  font-weight: 700;\r\n}\r\n\r\n.close-btn {\r\n  background: none;\r\n  border: none;\r\n  color: white;\r\n  font-size: 28px;\r\n  cursor: pointer;\r\n  padding: 0;\r\n  width: 30px;\r\n  height: 30px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.close-btn:hover {\r\n  opacity: 0.7;\r\n}\r\n\r\n.dialog-content {\r\n  padding: 25px;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n  font-weight: 600;\r\n  color: #333;\r\n}\r\n\r\n.required {\r\n  color: #f44336;\r\n}\r\n\r\n.form-input,\r\n.form-textarea {\r\n  width: 100%;\r\n  padding: 12px;\r\n  border: 2px solid #bbdefb;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  background: #f8fbff;\r\n  transition: all 0.3s;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.form-input:focus,\r\n.form-textarea:focus {\r\n  outline: none;\r\n  border-color: #4b6cb7;\r\n  background: white;\r\n  box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);\r\n}\r\n\r\n.form-textarea {\r\n  resize: vertical;\r\n  font-family: inherit;\r\n}\r\n\r\n.order-summary-info {\r\n  margin-top: 25px;\r\n  padding: 15px;\r\n  background: linear-gradient(135deg, #f8fbff 0%, #e3f2fd 100%);\r\n  border: 2px solid #bbdefb;\r\n  border-radius: 0;\r\n}\r\n\r\n.summary-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 10px;\r\n  font-size: 16px;\r\n}\r\n\r\n.summary-item:last-child {\r\n  margin-bottom: 0;\r\n  padding-top: 10px;\r\n  border-top: 1px solid #bbdefb;\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n}\r\n\r\n.summary-item .total-price {\r\n  color: #4b6cb7;\r\n  font-size: 20px;\r\n}\r\n\r\n.dialog-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 15px;\r\n  padding: 20px 25px;\r\n  border-top: 2px solid #e0e0e0;\r\n  background: #f8fbff;\r\n}\r\n\r\n.btn-cancel,\r\n.btn-submit {\r\n  padding: 12px 30px;\r\n  border: none;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.btn-cancel {\r\n  background: #f5f5f5;\r\n  color: #333;\r\n}\r\n\r\n.btn-cancel:hover {\r\n  background: #e0e0e0;\r\n}\r\n\r\n.btn-submit {\r\n  background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);\r\n  color: white;\r\n}\r\n\r\n.btn-submit:hover:not(:disabled) {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.btn-submit:disabled {\r\n  opacity: 0.6;\r\n  cursor: not-allowed;\r\n}\r\n\r\n/* ä»˜æ¬¾äºŒç»´ç æ ·å¼ */\r\n.payment-qrcode-section {\r\n  margin-top: 20px;\r\n  padding-top: 20px;\r\n  border-top: 1px solid #e0e0e0;\r\n  text-align: center;\r\n}\r\n\r\n.qrcode-label {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  color: #182848;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.qrcode-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.qrcode-image {\r\n  max-width: 250px;\r\n  width: 100%;\r\n  height: auto;\r\n  border: 1px solid #e0e0e0;\r\n  border-radius: 4px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}