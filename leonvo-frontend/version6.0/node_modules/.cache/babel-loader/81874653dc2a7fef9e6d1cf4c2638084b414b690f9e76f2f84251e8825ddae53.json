{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport apiConfig from '@/config/api.config.js';\nimport axios from 'axios';\nexport default {\n  name: 'UserProfile',\n  data() {\n    return {\n      userInfo: {\n        uid: null,\n        username: '',\n        phone: '',\n        email: '',\n        avatar: '',\n        role: 'user'\n      },\n      form: {\n        username: '',\n        phone: '',\n        email: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      passwordVerify: '',\n      isEditing: false,\n      isChangingPassword: false,\n      needPasswordVerify: false,\n      isSaving: false,\n      membershipInfo: {\n        label: 'æ™®é€šä¼šå‘˜',\n        levelKey: 'normal',\n        points: 0,\n        discountText: 'ä¸æ‰“æŠ˜',\n        color: '#64b5f6',\n        progress: 0,\n        diffToNext: 3000,\n        nextThreshold: 3000,\n        nextLabel: 'VIPä¼šå‘˜'\n      },\n      showBenefitModal: false,\n      errorMessage: '',\n      successMessage: '',\n      securityMessage: '',\n      securityError: '',\n      passwordSecurity: {\n        method: 'phone',\n        phone: '',\n        email: '',\n        code: '',\n        newPassword: '',\n        confirmPassword: '',\n        smsCountdown: 0,\n        emailCountdown: 0,\n        sendingSms: false,\n        sendingEmail: false,\n        smsTimer: null,\n        emailTimer: null\n      },\n      defaultAvatar: 'https://via.placeholder.com/150/4b6cb7/FFFFFF?text=User'\n    };\n  },\n  mounted() {\n    this.loadUserInfo();\n    this.fetchStudentStatus();\n  },\n  beforeUnmount() {\n    this.clearSecurityTimers();\n  },\n  computed: {\n    membershipTiers() {\n      return this.getMembershipTiers();\n    }\n  },\n  methods: {\n    normalizeToString(value) {\n      if (value === null || value === undefined) return '';\n      return String(value);\n    },\n    async loadUserInfo() {\n      const uid = localStorage.getItem('userId');\n      if (!uid) {\n        this.errorMessage = 'æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•';\n        setTimeout(() => {\n          this.$router.push('/login');\n        }, 2000);\n        return;\n      }\n      try {\n        const response = await axios.get(apiConfig.user.getUserById(uid));\n        if (response.data.code === 1) {\n          const data = response.data.data || {};\n          const normalizedUser = {\n            ...this.userInfo,\n            ...data,\n            username: this.normalizeToString(data.username),\n            phone: this.normalizeToString(data.phone),\n            email: this.normalizeToString(data.email)\n          };\n          this.userInfo = normalizedUser;\n          this.form = {\n            username: normalizedUser.username,\n            phone: normalizedUser.phone,\n            email: normalizedUser.email,\n            newPassword: '',\n            confirmPassword: ''\n          };\n          // åˆå§‹åŒ–å®‰å…¨æ¨¡å—çš„è”ç³»æ–¹å¼\n          this.passwordSecurity.phone = normalizedUser.phone;\n          this.passwordSecurity.email = normalizedUser.email;\n        } else {\n          this.errorMessage = response.data.msg || 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥';\n        }\n      } catch (error) {\n        console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);\n        this.errorMessage = 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n      }\n\n      // æ‹‰å–ä¼šå‘˜ä¿¡æ¯\n      this.fetchMembership();\n    },\n    startEdit() {\n      this.isEditing = true;\n      this.errorMessage = '';\n      this.successMessage = '';\n    },\n    cancelEdit() {\n      this.isEditing = false;\n      this.isChangingPassword = false;\n      this.needPasswordVerify = false;\n      this.passwordVerify = '';\n      this.form = {\n        username: this.userInfo.username || '',\n        phone: this.userInfo.phone || '',\n        email: this.userInfo.email || '',\n        newPassword: '',\n        confirmPassword: ''\n      };\n      this.errorMessage = '';\n      this.successMessage = '';\n    },\n    handleChangePassword() {\n      this.isChangingPassword = true;\n      this.needPasswordVerify = true;\n    },\n    async handleChangePhone() {\n      // æ¢ç»‘æ‰‹æœºå·éœ€è¦å¯†ç éªŒè¯\n      if (!this.passwordVerify) {\n        this.errorMessage = 'è¯·å…ˆè¾“å…¥å½“å‰å¯†ç è¿›è¡ŒéªŒè¯';\n        this.needPasswordVerify = true;\n        return;\n      }\n\n      // éªŒè¯å¯†ç \n      const isValid = await this.verifyPassword();\n      if (!isValid) {\n        return;\n      }\n\n      // è¿™é‡Œå¯ä»¥æ·»åŠ æ‰‹æœºå·éªŒè¯ç éªŒè¯é€»è¾‘\n      this.successMessage = 'æ‰‹æœºå·ä¿®æ”¹åŠŸèƒ½éœ€è¦çŸ­ä¿¡éªŒè¯ï¼Œè¯·å…ˆä¿å­˜å…¶ä»–ä¿¡æ¯';\n    },\n    async handleChangeEmail() {\n      // æ¢ç»‘é‚®ç®±éœ€è¦å¯†ç éªŒè¯\n      if (!this.passwordVerify) {\n        this.errorMessage = 'è¯·å…ˆè¾“å…¥å½“å‰å¯†ç è¿›è¡ŒéªŒè¯';\n        this.needPasswordVerify = true;\n        return;\n      }\n\n      // éªŒè¯å¯†ç \n      const isValid = await this.verifyPassword();\n      if (!isValid) {\n        return;\n      }\n      this.successMessage = 'é‚®ç®±ä¿®æ”¹åŠŸèƒ½éœ€è¦é‚®ç®±éªŒè¯ï¼Œè¯·å…ˆä¿å­˜å…¶ä»–ä¿¡æ¯';\n    },\n    async verifyPassword() {\n      if (!this.passwordVerify) {\n        this.errorMessage = 'è¯·è¾“å…¥å½“å‰å¯†ç ';\n        return false;\n      }\n      try {\n        const uid = localStorage.getItem('userId');\n\n        // æ³¨æ„ï¼šåç«¯æ²¡æœ‰å•ç‹¬çš„éªŒè¯å¯†ç æ¥å£\n        // æ–¹æ¡ˆ1ï¼šé€šè¿‡å°è¯•ç™»å½•æ¥éªŒè¯å¯†ç ï¼ˆä½¿ç”¨ç”¨æˆ·åç™»å½•ï¼‰\n        // æ–¹æ¡ˆ2ï¼šç›´æ¥ä¿®æ”¹ï¼Œè®©åç«¯éªŒè¯ï¼ˆä½†è¿™æ ·ä¼šå…ˆä¿®æ”¹å†éªŒè¯ï¼Œä¸å¤ªå¥½ï¼‰\n        // æ–¹æ¡ˆ3ï¼šæš‚æ—¶è·³è¿‡éªŒè¯ï¼Œåœ¨ä¿å­˜æ—¶è®©åç«¯éªŒè¯\n\n        // ä½¿ç”¨æ–¹æ¡ˆ1ï¼šé€šè¿‡ç”¨æˆ·åç™»å½•æ¥å£éªŒè¯å¯†ç \n        // è·å–å½“å‰ç”¨æˆ·å\n        const username = this.normalizeToString(this.userInfo.username) || this.normalizeToString(localStorage.getItem('username'));\n        if (!username) {\n          this.errorMessage = 'æ— æ³•è·å–ç”¨æˆ·åï¼Œè¯·é‡æ–°ç™»å½•';\n          return false;\n        }\n\n        // å°è¯•ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•æ¥éªŒè¯\n        const response = await axios.get(apiConfig.user.usernameLogin, {\n          params: {\n            username: username,\n            password: this.passwordVerify\n          }\n        });\n        if (response.data && response.data.code === 1) {\n          // å¯†ç éªŒè¯æˆåŠŸ\n          this.errorMessage = '';\n          return true;\n        } else {\n          // å¯†ç éªŒè¯å¤±è´¥\n          this.errorMessage = response.data?.msg || 'å¯†ç éªŒè¯å¤±è´¥';\n          return false;\n        }\n      } catch (error) {\n        console.error('å¯†ç éªŒè¯å¤±è´¥:', error);\n        if (error.response && error.response.data) {\n          this.errorMessage = error.response.data.msg || 'å¯†ç éªŒè¯å¤±è´¥';\n        } else {\n          this.errorMessage = 'å¯†ç éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n        }\n        return false;\n      }\n    },\n    async handleAvatarUpload(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n\n      // éªŒè¯æ–‡ä»¶ç±»å‹\n      if (!file.type.startsWith('image/')) {\n        this.errorMessage = 'è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶';\n        return;\n      }\n\n      // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶5MBï¼‰\n      if (file.size > 5 * 1024 * 1024) {\n        this.errorMessage = 'å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB';\n        return;\n      }\n      this.isSaving = true;\n      this.errorMessage = '';\n      try {\n        const formData = new FormData();\n        // æ·»åŠ  uid å‚æ•°ï¼Œç¡®ä¿åç«¯çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·\n        const uid = localStorage.getItem('userId');\n        formData.append('uid', uid);\n        formData.append('file', file);\n\n        // åç«¯æ¥å£ä½¿ç”¨ POST æäº¤å¤´åƒæ–‡ä»¶\n        const response = await axios.post(apiConfig.user.updateAvatar, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        if (response.data.code === 1) {\n          this.userInfo.avatar = response.data.data;\n          this.successMessage = 'å¤´åƒä¸Šä¼ æˆåŠŸ';\n\n          // æ›´æ–° localStorage ä¸­çš„å¤´åƒä¿¡æ¯ï¼ˆå¦‚æœæœ‰å­˜å‚¨çš„è¯ï¼‰\n          // å¹¶è§¦å‘äº‹ä»¶é€šçŸ¥å…¶ä»–ç»„ä»¶\n          window.dispatchEvent(new Event('storage'));\n          setTimeout(() => {\n            this.successMessage = '';\n          }, 3000);\n        } else {\n          this.errorMessage = response.data.msg || 'å¤´åƒä¸Šä¼ å¤±è´¥';\n\n          // å¦‚æœåç«¯ä¸Šä¼ å¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°é¢„è§ˆï¼ˆä»…ä½œä¸ºå…œåº•ï¼Œå®é™…åº”ä»¥æœåŠ¡å™¨ä¸ºå‡†ï¼‰\n          // const reader = new FileReader();\n          // reader.onload = (e) => {\n          //   this.userInfo.avatar = e.target.result;\n          // };\n          // reader.readAsDataURL(file);\n        }\n      } catch (error) {\n        console.error('å¤´åƒä¸Šä¼ å¤±è´¥:', error);\n        this.errorMessage = 'å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n      } finally {\n        this.isSaving = false;\n      }\n    },\n    handleAvatarError(event) {\n      event.target.src = this.defaultAvatar;\n    },\n    getMembershipTiers() {\n      return [{\n        key: 'normal',\n        label: 'æ™®é€šä¼šå‘˜',\n        min: 0,\n        max: 3000,\n        discount: 1,\n        color: '#64b5f6',\n        discountText: 'ä¸æ‰“æŠ˜'\n      }, {\n        key: 'vip',\n        label: 'VIPä¼šå‘˜',\n        min: 3000,\n        max: 6000,\n        discount: 0.95,\n        color: '#7e57c2',\n        discountText: '9.5æŠ˜'\n      }, {\n        key: 'svip',\n        label: 'SVIPä¼šå‘˜',\n        min: 6000,\n        max: 12000,\n        discount: 0.9,\n        color: '#ff9800',\n        discountText: '9æŠ˜'\n      }, {\n        key: 'king',\n        label: 'é‡‘ä¸»çˆ¸çˆ¸',\n        min: 12000,\n        max: Infinity,\n        discount: 0.8,\n        color: '#fbc02d',\n        discountText: '8æŠ˜'\n      }];\n    },\n    calculateMembership(points = 0) {\n      const tiers = this.getMembershipTiers();\n      const current = tiers.find(t => points >= t.min && points < t.max) || tiers[tiers.length - 1];\n      const currentIndex = tiers.indexOf(current);\n      const next = tiers[currentIndex + 1];\n      const lower = current.min;\n      const upper = current.max;\n      const progress = upper === Infinity ? 100 : Math.min(100, Math.max(0, (points - lower) / (upper - lower) * 100));\n      const diffToNext = upper === Infinity ? 0 : Math.max(0, Math.ceil(upper - points));\n      return {\n        ...current,\n        points,\n        progress: Number(progress.toFixed(2)),\n        diffToNext,\n        nextThreshold: upper === Infinity ? null : upper,\n        nextLabel: next ? next.label : null,\n        discountText: current.discountText\n      };\n    },\n    async fetchMembership() {\n      const uid = localStorage.getItem('userId');\n      if (!uid) return;\n      try {\n        const res = await axios.get(apiConfig.user.getUserRole(uid));\n        if (res.data && res.data.code === 1) {\n          const role = res.data.data || {};\n          const points = Number(role.points || 0);\n          this.membershipInfo = this.calculateMembership(points);\n        }\n      } catch (error) {\n        console.error('è·å–ä¼šå‘˜ä¿¡æ¯å¤±è´¥:', error);\n      }\n    },\n    async fetchStudentStatus() {\n      const uid = localStorage.getItem('userId');\n      if (!uid) return;\n      try {\n        const res = await axios.get(apiConfig.student.getStatus(uid));\n        console.log('ä¸ªäººä¸­å¿ƒ-å­¦ç”Ÿè®¤è¯çŠ¶æ€:', res.data);\n        if (res.data.code === 1) {\n          this.studentStatus = res.data.data;\n          // å¼ºåˆ¶åˆ·æ–°è§†å›¾ï¼ˆå¦‚æœéœ€è¦ï¼‰\n          this.$forceUpdate();\n        }\n      } catch (e) {\n        console.error('è·å–å­¦ç”Ÿè®¤è¯çŠ¶æ€å¤±è´¥', e);\n      }\n    },\n    // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨\n    async checkUsernameExists(username) {\n      const value = this.normalizeToString(username);\n      if (!value || value.trim() === '') {\n        return false;\n      }\n\n      // å¦‚æœç”¨æˆ·åæ²¡æœ‰å˜åŒ–ï¼Œä¸éœ€è¦æ£€æŸ¥\n      if (value === this.normalizeToString(this.userInfo.username)) {\n        return false;\n      }\n      try {\n        const response = await axios.get(apiConfig.user.checkUsername, {\n          params: {\n            username: value\n          }\n        });\n\n        // code === 0 è¡¨ç¤ºç”¨æˆ·åå·²å­˜åœ¨\n        if (response.data.code === 0) {\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('æ£€æŸ¥ç”¨æˆ·åå¤±è´¥:', error);\n        // å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å…è®¸ä¿®æ”¹\n        this.errorMessage = 'æ£€æŸ¥ç”¨æˆ·åå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n        return true; // è¿”å›trueé˜»æ­¢ä¿®æ”¹\n      }\n    },\n    async saveChanges() {\n      this.errorMessage = '';\n      this.successMessage = '';\n      const usernameValue = this.normalizeToString(this.form.username);\n      const currentUsername = this.normalizeToString(this.userInfo.username);\n      const hasUsernameChanged = usernameValue !== currentUsername;\n\n      // éªŒè¯è¡¨å•\n      if (!usernameValue || usernameValue.trim() === '') {\n        this.errorMessage = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';\n        return;\n      }\n\n      // éªŒè¯ç”¨æˆ·åé•¿åº¦\n      if (usernameValue.length < 2 || usernameValue.length > 10) {\n        this.errorMessage = 'ç”¨æˆ·åé•¿åº¦ä¸º2-10ä½';\n        return;\n      }\n\n      // å¦‚æœä¿®æ”¹äº†ç”¨æˆ·åï¼Œéœ€è¦éªŒè¯å¯†ç å’Œæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤\n      if (hasUsernameChanged) {\n        if (!this.passwordVerify) {\n          this.errorMessage = 'ä¿®æ”¹ç”¨æˆ·åéœ€è¦éªŒè¯å½“å‰å¯†ç ';\n          this.needPasswordVerify = true;\n          return;\n        }\n\n        // éªŒè¯å¯†ç \n        const isValid = await this.verifyPassword();\n        if (!isValid) {\n          return;\n        }\n\n        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨\n        const usernameExists = await this.checkUsernameExists(usernameValue);\n        if (usernameExists) {\n          this.errorMessage = 'ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–ç”¨æˆ·å';\n          return;\n        }\n      }\n\n      // å¦‚æœä¿®æ”¹äº†æ‰‹æœºå·ï¼Œéœ€è¦å¯†ç éªŒè¯å’Œé¢å¤–éªŒè¯ï¼ˆé¢„ç•™æ¥å£ï¼‰\n      const phoneValue = this.normalizeToString(this.form.phone);\n      const currentPhone = this.normalizeToString(this.userInfo.phone);\n      const hasPhoneChanged = phoneValue !== currentPhone;\n      if (hasPhoneChanged) {\n        if (!this.passwordVerify) {\n          this.errorMessage = 'ä¿®æ”¹æ‰‹æœºå·éœ€è¦éªŒè¯å½“å‰å¯†ç ';\n          this.needPasswordVerify = true;\n          return;\n        }\n\n        // éªŒè¯å¯†ç \n        const isValid = await this.verifyPassword();\n        if (!isValid) {\n          return;\n        }\n\n        // éªŒè¯æ‰‹æœºå·æ ¼å¼\n        const phoneRegex = /^1[3-9]\\d{9}$/;\n        if (!phoneRegex.test(phoneValue)) {\n          this.errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·';\n          return;\n        }\n\n        // æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨\n        try {\n          const response = await axios.get(apiConfig.user.checkPhone, {\n            params: {\n              phone: phoneValue\n            }\n          });\n\n          // code === 0 è¡¨ç¤ºæ‰‹æœºå·å·²å­˜åœ¨\n          if (response.data.code === 0) {\n            // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·çš„æ‰‹æœºå·\n            if (hasPhoneChanged) {\n              this.errorMessage = 'è¯¥æ‰‹æœºå·å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–æ‰‹æœºå·';\n              return;\n            }\n          }\n        } catch (error) {\n          console.error('æ£€æŸ¥æ‰‹æœºå·å¤±è´¥:', error);\n          this.errorMessage = 'æ£€æŸ¥æ‰‹æœºå·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n          return;\n        }\n\n        // é¢„ç•™ï¼šæ‰‹æœºå·ä¿®æ”¹éœ€è¦çŸ­ä¿¡éªŒè¯ï¼ˆç›®å‰æ¥å£æœªæä¾›ï¼‰\n        // è¿™é‡Œå¯ä»¥æ·»åŠ çŸ­ä¿¡éªŒè¯ç éªŒè¯é€»è¾‘\n        this.successMessage = 'æç¤ºï¼šæ‰‹æœºå·ä¿®æ”¹éœ€è¦çŸ­ä¿¡éªŒè¯ï¼Œå½“å‰ä»…ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè¯·ç¡®ä¿æ‰‹æœºå·æ­£ç¡®';\n      }\n\n      // å¦‚æœä¿®æ”¹äº†é‚®ç®±ï¼Œéœ€è¦å¯†ç éªŒè¯å’Œé¢å¤–éªŒè¯ï¼ˆé¢„ç•™æ¥å£ï¼‰\n      const emailValue = this.normalizeToString(this.form.email);\n      const currentEmail = this.normalizeToString(this.userInfo.email);\n      const hasEmailChanged = emailValue !== currentEmail;\n      if (hasEmailChanged) {\n        if (!this.passwordVerify) {\n          this.errorMessage = 'ä¿®æ”¹é‚®ç®±éœ€è¦éªŒè¯å½“å‰å¯†ç ';\n          this.needPasswordVerify = true;\n          return;\n        }\n\n        // éªŒè¯å¯†ç \n        const isValid = await this.verifyPassword();\n        if (!isValid) {\n          return;\n        }\n\n        // éªŒè¯é‚®ç®±æ ¼å¼\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (emailValue && !emailRegex.test(emailValue)) {\n          this.errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';\n          return;\n        }\n\n        // é¢„ç•™ï¼šé‚®ç®±ä¿®æ”¹éœ€è¦é‚®ç®±éªŒè¯ï¼ˆç›®å‰æ¥å£æœªæä¾›ï¼‰\n        // è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ç®±éªŒè¯ç éªŒè¯é€»è¾‘\n        this.successMessage = 'æç¤ºï¼šé‚®ç®±ä¿®æ”¹éœ€è¦é‚®ç®±éªŒè¯ï¼Œå½“å‰ä»…ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè¯·ç¡®ä¿é‚®ç®±æ­£ç¡®';\n      }\n\n      // å¦‚æœä¿®æ”¹å¯†ç ï¼ŒéªŒè¯æ–°å¯†ç \n      if (this.isChangingPassword) {\n        if (!this.form.newPassword || this.form.newPassword.length < 6 || this.form.newPassword.length > 16) {\n          this.errorMessage = 'æ–°å¯†ç é•¿åº¦ä¸º6-16ä½';\n          return;\n        }\n        if (this.form.newPassword !== this.form.confirmPassword) {\n          this.errorMessage = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';\n          return;\n        }\n\n        // éªŒè¯å½“å‰å¯†ç \n        const isValid = await this.verifyPassword();\n        if (!isValid) {\n          return;\n        }\n      }\n      this.isSaving = true;\n      try {\n        const uid = localStorage.getItem('userId');\n\n        // é‡è¦ï¼šåç«¯updateByIdä¼šæ›´æ–°æ‰€æœ‰å­—æ®µï¼ˆusername, password, email, phone, status, avatar, roleï¼‰\n        // å¦‚æœæŸä¸ªå­—æ®µä¸ºnullï¼Œä¼šè¢«è®¾ç½®ä¸ºnullï¼Œå¯¼è‡´æ•°æ®åº“çº¦æŸé”™è¯¯\n        // æ‰€ä»¥å¿…é¡»åŒ…å«æ‰€æœ‰å¿…å¡«å­—æ®µï¼Œä½¿ç”¨åŸæœ‰å€¼æˆ–æ–°å€¼\n\n        // ç¡®ä¿usernameä¸ä¸ºç©º\n        const username = usernameValue.trim() || currentUsername;\n        if (!username) {\n          this.errorMessage = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼Œè¯·å…ˆè®¾ç½®ç”¨æˆ·å';\n          this.isSaving = false;\n          return;\n        }\n        const updateData = {\n          uid: parseInt(uid || this.userInfo.uid || this.userInfo.id),\n          // å¿…é¡»åŒ…å«usernameï¼Œå› ä¸ºæ•°æ®åº“çº¦æŸä¸å…è®¸ä¸ºnull\n          username: username,\n          // åŒ…å«å…¶ä»–å­—æ®µï¼Œä½¿ç”¨æ–°å€¼ï¼ˆå¦‚æœæœ‰å˜åŒ–ï¼‰æˆ–ä¿æŒåŸæœ‰å€¼\n          phone: hasPhoneChanged && phoneValue !== '' ? phoneValue : currentPhone || null,\n          email: hasEmailChanged && emailValue !== '' ? emailValue : currentEmail || null,\n          // ä¿æŒåŸæœ‰çŠ¶æ€å’Œè§’è‰²ä¸å˜ï¼ˆè¿™äº›å­—æ®µä¸åº”è¯¥è¢«ç”¨æˆ·ä¿®æ”¹ï¼‰\n          status: this.userInfo.status !== undefined && this.userInfo.status !== null ? this.userInfo.status : 1,\n          avatar: this.userInfo.avatar || null,\n          role: this.userInfo.role || 'user'\n        };\n\n        // é‡è¦ä¿®å¤ï¼šå¯†ç å­—æ®µå¤„ç†\n        // æ•°æ®åº“çº¦æŸè¦æ±‚ password ä¸èƒ½ä¸ºç©º\n        // å¦‚æœç”¨æˆ·ä¿®æ”¹äº†å¯†ç ï¼Œä½¿ç”¨æ–°å¯†ç \n        if (this.isChangingPassword && this.form.newPassword) {\n          updateData.password = this.form.newPassword;\n        } else {\n          // å¦‚æœæ²¡æœ‰ä¿®æ”¹å¯†ç ï¼Œå¿…é¡»ä¼ å›å½“å‰å¯†ç ï¼Œå¦åˆ™åç«¯ä¼šå°†å¯†ç æ›´æ–°ä¸º NULL å¯¼è‡´æŠ¥é”™\n          // ç”±äºæˆ‘ä»¬å‰ç«¯æ²¡æœ‰å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š\n          // 1. å¦‚æœåç«¯æ”¯æŒä¸ä¼  password å­—æ®µå°±ä¸æ›´æ–°ï¼Œé‚£å°±ä¸ä¼ ï¼ˆä½†ç›®å‰çš„åç«¯é€»è¾‘ä¼¼ä¹æ˜¯å…¨é‡æ›´æ–°ï¼‰\n          // 2. æ—¢ç„¶ç”¨æˆ·è¾“å…¥äº†éªŒè¯å¯†ç  (passwordVerify)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯†ç ä½œä¸ºå½“å‰å¯†ç ä¼ å›\n          // æ³¨æ„ï¼šå‰ææ˜¯ verifyPassword() å·²ç»éªŒè¯è¿‡è¿™ä¸ªå¯†ç æ˜¯æ­£ç¡®çš„\n\n          if (this.passwordVerify) {\n            updateData.password = this.passwordVerify;\n          } else {\n            // æç«¯æƒ…å†µï¼šå¦‚æœæ²¡ä¿®æ”¹å¯†ç ä¸”æ²¡è¾“å…¥éªŒè¯å¯†ç ï¼ˆä¾‹å¦‚ä»…ä¿®æ”¹å¤´åƒæˆ–éæ•æ„Ÿä¿¡æ¯ä¸éœ€è¦éªŒè¯å¯†ç çš„æƒ…å†µï¼‰\n            // ä½†æœ¬é¡µé¢çš„é€»è¾‘æ˜¯ä¿®æ”¹ä»»ä½•ä¿¡æ¯éƒ½éœ€è¦éªŒè¯å¯†ç ï¼Œæ‰€ä»¥ this.passwordVerify åº”è¯¥æ˜¯æœ‰å€¼çš„\n            // å¦‚æœç¡®å®æ²¡æœ‰ï¼Œå°è¯•ä» localStorage è·å–ï¼ˆå¦‚æœç™»å½•æ—¶ä¿å­˜äº†çš„è¯ï¼Œé€šå¸¸ä¸å»ºè®®ï¼‰\n            // æˆ–è€…æç¤ºç”¨æˆ·å¿…é¡»è¾“å…¥å¯†ç \n            this.errorMessage = 'ç³»ç»Ÿéœ€è¦éªŒè¯æ‚¨çš„å¯†ç æ‰èƒ½ä¿å­˜ä¿®æ”¹';\n            this.needPasswordVerify = true;\n            this.isSaving = false;\n            return;\n          }\n        }\n        console.log('å‡†å¤‡æ›´æ–°çš„æ•°æ®:', updateData);\n\n        // ä½¿ç”¨POSTè¯·æ±‚ï¼ˆæ ¹æ®åç«¯ä»£ç ï¼‰\n        const response = await axios.post(apiConfig.user.updateUserInfo, updateData);\n        if (response.data.code === 1) {\n          this.successMessage = 'ä¿¡æ¯ä¿®æ”¹æˆåŠŸ';\n          this.isEditing = false;\n          this.isChangingPassword = false;\n          this.needPasswordVerify = false;\n          this.passwordVerify = '';\n          this.form.newPassword = '';\n          this.form.confirmPassword = '';\n\n          // é‡æ–°åŠ è½½ç”¨æˆ·ä¿¡æ¯\n          await this.loadUserInfo();\n\n          // æ›´æ–°localStorageä¸­çš„ç”¨æˆ·å\n          if (this.form.username !== this.userInfo.username) {\n            localStorage.setItem('username', this.form.username);\n            // è§¦å‘App.vueæ›´æ–°\n            window.dispatchEvent(new Event('storage'));\n          }\n          setTimeout(() => {\n            this.successMessage = '';\n          }, 3000);\n        } else {\n          this.errorMessage = response.data.msg || 'ä¿®æ”¹å¤±è´¥';\n        }\n      } catch (error) {\n        console.error('ä¿å­˜å¤±è´¥:', error);\n        this.errorMessage = 'ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n      } finally {\n        this.isSaving = false;\n      }\n    },\n    switchSecurityMethod(method) {\n      this.passwordSecurity.method = method;\n      this.securityError = '';\n      this.securityMessage = '';\n      if (method === 'phone' && !this.passwordSecurity.phone) {\n        this.passwordSecurity.phone = this.normalizeToString(this.userInfo.phone);\n      }\n      if (method === 'email' && !this.passwordSecurity.email) {\n        this.passwordSecurity.email = this.normalizeToString(this.userInfo.email);\n      }\n    },\n    startSecurityCountdown(type) {\n      const countdownKey = type === 'phone' ? 'smsCountdown' : 'emailCountdown';\n      const timerKey = type === 'phone' ? 'smsTimer' : 'emailTimer';\n      if (this.passwordSecurity[timerKey]) {\n        clearInterval(this.passwordSecurity[timerKey]);\n      }\n      this.passwordSecurity[countdownKey] = 60;\n      this.passwordSecurity[timerKey] = setInterval(() => {\n        this.passwordSecurity[countdownKey] -= 1;\n        if (this.passwordSecurity[countdownKey] <= 0) {\n          clearInterval(this.passwordSecurity[timerKey]);\n          this.passwordSecurity[timerKey] = null;\n          this.passwordSecurity[countdownKey] = 0;\n        }\n      }, 1000);\n    },\n    clearSecurityTimers() {\n      if (this.passwordSecurity.smsTimer) {\n        clearInterval(this.passwordSecurity.smsTimer);\n        this.passwordSecurity.smsTimer = null;\n      }\n      if (this.passwordSecurity.emailTimer) {\n        clearInterval(this.passwordSecurity.emailTimer);\n        this.passwordSecurity.emailTimer = null;\n      }\n    },\n    async sendSecurityCode() {\n      this.securityError = '';\n      this.securityMessage = '';\n      if (this.passwordSecurity.method === 'phone') {\n        const phone = this.normalizeToString(this.passwordSecurity.phone);\n        const phoneRegex = /^1[3-9]\\d{9}$/;\n        if (!phoneRegex.test(phone)) {\n          this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·';\n          return;\n        }\n        this.passwordSecurity.sendingSms = true;\n        try {\n          const res = await axios.post(apiConfig.passwordReset.smsSendCode, {\n            phone\n          }, {\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          });\n          const data = res.data || {};\n          if (data.code === 1) {\n            this.securityMessage = data.msg || 'éªŒè¯ç å‘é€æˆåŠŸ';\n            this.startSecurityCountdown('phone');\n          } else {\n            this.securityError = data.msg || 'éªŒè¯ç å‘é€å¤±è´¥';\n          }\n        } catch (error) {\n          console.error('å‘é€çŸ­ä¿¡éªŒè¯ç å¤±è´¥:', error);\n          this.securityError = error.response?.data?.msg || 'éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n        } finally {\n          this.passwordSecurity.sendingSms = false;\n        }\n      } else {\n        const email = this.normalizeToString(this.passwordSecurity.email);\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(email)) {\n          this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±';\n          return;\n        }\n        this.passwordSecurity.sendingEmail = true;\n        try {\n          const res = await axios.post(apiConfig.email.sendResetCode, {\n            email\n          }, {\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          });\n          const data = res.data || {};\n          if (data.code === 1) {\n            this.securityMessage = data.msg || 'éªŒè¯ç å‘é€æˆåŠŸ';\n            this.startSecurityCountdown('email');\n          } else {\n            this.securityError = data.msg || 'éªŒè¯ç å‘é€å¤±è´¥';\n          }\n        } catch (error) {\n          console.error('å‘é€é‚®ç®±éªŒè¯ç å¤±è´¥:', error);\n          this.securityError = error.response?.data?.msg || 'éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n        } finally {\n          this.passwordSecurity.sendingEmail = false;\n        }\n      }\n    },\n    async submitPasswordReset() {\n      this.securityError = '';\n      this.securityMessage = '';\n      const newPwd = this.passwordSecurity.newPassword;\n      const confirmPwd = this.passwordSecurity.confirmPassword;\n      const code = this.normalizeToString(this.passwordSecurity.code);\n      if (!code || code.length !== 6) {\n        this.securityError = 'è¯·è¾“å…¥6ä½éªŒè¯ç ';\n        return;\n      }\n      if (!newPwd || newPwd.length < 6 || newPwd.length > 16) {\n        this.securityError = 'æ–°å¯†ç é•¿åº¦ä¸º6-16ä½';\n        return;\n      }\n      if (newPwd !== confirmPwd) {\n        this.securityError = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';\n        return;\n      }\n      try {\n        let url = '';\n        const payload = {\n          code,\n          newPassword: newPwd,\n          confirmPassword: confirmPwd\n        };\n        if (this.passwordSecurity.method === 'phone') {\n          const phone = this.normalizeToString(this.passwordSecurity.phone);\n          const phoneRegex = /^1[3-9]\\d{9}$/;\n          if (!phoneRegex.test(phone)) {\n            this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·';\n            return;\n          }\n          url = apiConfig.passwordReset.smsReset;\n          payload.phone = phone;\n        } else {\n          const email = this.normalizeToString(this.passwordSecurity.email);\n          const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n          if (!emailRegex.test(email)) {\n            this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±';\n            return;\n          }\n          url = apiConfig.email.resetPassword;\n          payload.email = email;\n        }\n        const res = await axios.post(url, payload, {\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        });\n        const data = res.data || {};\n        if (data.code === 1) {\n          this.securityMessage = data.msg || 'å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•';\n          this.passwordSecurity.code = '';\n          this.passwordSecurity.newPassword = '';\n          this.passwordSecurity.confirmPassword = '';\n        } else {\n          this.securityError = data.msg || 'å¯†ç ä¿®æ”¹å¤±è´¥';\n        }\n      } catch (error) {\n        console.error('å¯†ç ä¿®æ”¹å¤±è´¥:', error);\n        this.securityError = error.response?.data?.msg || 'å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\n      }\n    }\n  }\n};","map":{"version":3,"names":["apiConfig","axios","name","data","userInfo","uid","username","phone","email","avatar","role","form","newPassword","confirmPassword","passwordVerify","isEditing","isChangingPassword","needPasswordVerify","isSaving","membershipInfo","label","levelKey","points","discountText","color","progress","diffToNext","nextThreshold","nextLabel","showBenefitModal","errorMessage","successMessage","securityMessage","securityError","passwordSecurity","method","code","smsCountdown","emailCountdown","sendingSms","sendingEmail","smsTimer","emailTimer","defaultAvatar","mounted","loadUserInfo","fetchStudentStatus","beforeUnmount","clearSecurityTimers","computed","membershipTiers","getMembershipTiers","methods","normalizeToString","value","undefined","String","localStorage","getItem","setTimeout","$router","push","response","get","user","getUserById","normalizedUser","msg","error","console","fetchMembership","startEdit","cancelEdit","handleChangePassword","handleChangePhone","isValid","verifyPassword","handleChangeEmail","usernameLogin","params","password","handleAvatarUpload","event","file","target","files","type","startsWith","size","formData","FormData","append","post","updateAvatar","headers","window","dispatchEvent","Event","handleAvatarError","src","key","min","max","discount","Infinity","calculateMembership","tiers","current","find","t","length","currentIndex","indexOf","next","lower","upper","Math","ceil","Number","toFixed","res","getUserRole","student","getStatus","log","studentStatus","$forceUpdate","e","checkUsernameExists","trim","checkUsername","saveChanges","usernameValue","currentUsername","hasUsernameChanged","usernameExists","phoneValue","currentPhone","hasPhoneChanged","phoneRegex","test","checkPhone","emailValue","currentEmail","hasEmailChanged","emailRegex","updateData","parseInt","id","status","updateUserInfo","setItem","switchSecurityMethod","startSecurityCountdown","countdownKey","timerKey","clearInterval","setInterval","sendSecurityCode","passwordReset","smsSendCode","sendResetCode","submitPasswordReset","newPwd","confirmPwd","url","payload","smsReset","resetPassword"],"sources":["D:\\1_homework_file\\å¤§ä¸‰ä¸Š\\è½¯ä»¶å·¥ç¨‹\\é¡¹ç›®ç•™æ¡£\\1å‰ç«¯å¼€å‘_æˆ‘æ‰æ˜¯çœŸçš„\\version5.0\\src\\views\\user\\UserProfile.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-profile-view\">\r\n    <div class=\"profile-container\">\r\n      <div class=\"back-home\">\r\n        <router-link to=\"/\" class=\"back-link\">\r\n          <span class=\"back-icon\">â†</span>\r\n          è¿”å›é¦–é¡µ\r\n        </router-link>\r\n      </div>\r\n\r\n      <div class=\"profile-box\">\r\n        <div class=\"profile-header\">\r\n          <h1>ä¸ªäººä¸­å¿ƒ</h1>\r\n          <p class=\"subtitle\">ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯</p>\r\n        </div>\r\n\r\n        <div class=\"profile-content\">\r\n          <!-- å¤´åƒåŒºåŸŸ -->\r\n          <div class=\"avatar-section\">\r\n            <div class=\"avatar-wrapper\">\r\n              <img \r\n                :src=\"userInfo.avatar || defaultAvatar\" \r\n                alt=\"å¤´åƒ\" \r\n                class=\"avatar-img\"\r\n                @error=\"handleAvatarError\"\r\n              />\r\n              <div class=\"avatar-overlay\">\r\n                <label for=\"avatar-upload\" class=\"upload-label\">\r\n                  <span class=\"upload-icon\">ğŸ“·</span>\r\n                  <span class=\"upload-text\">æ›´æ¢å¤´åƒ</span>\r\n                </label>\r\n                <input \r\n                  type=\"file\" \r\n                  id=\"avatar-upload\" \r\n                  accept=\"image/*\" \r\n                  @change=\"handleAvatarUpload\"\r\n                  style=\"display: none;\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div class=\"avatar-info\">\r\n              <h2>{{ userInfo.username || 'ç”¨æˆ·' }}</h2>\r\n              <div class=\"roles-container\">\r\n                <!-- ä»…ç®¡ç†å‘˜æ˜¾ç¤ºç®¡ç†å‘˜æ ‡ç­¾ -->\r\n                <p v-if=\"userInfo.role === 'admin'\" class=\"user-role\">ç®¡ç†å‘˜</p>\r\n                \r\n                <!-- ä»…å½“å­¦ç”Ÿè®¤è¯é€šè¿‡æ—¶æ˜¾ç¤ºå­¦ç”Ÿæ ‡ç­¾ -->\r\n                <span v-if=\"studentStatus && studentStatus.status === 1\" class=\"student-badge\">\r\n                  å­¦ç”Ÿ\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- ä¼šå‘˜ç­‰çº§ -->\r\n          <div class=\"form-section membership-card\">\r\n            <div class=\"membership-header\">\r\n              <div class=\"membership-title\">\r\n                <span class=\"section-icon\">ğŸ…</span>\r\n                <span>ä¼šå‘˜ç­‰çº§</span>\r\n              </div>\r\n              <button class=\"benefit-btn\" @click=\"showBenefitModal = true\">\r\n                æŸ¥çœ‹ç­‰çº§ä¼˜æƒ \r\n              </button>\r\n            </div>\r\n            <div class=\"membership-summary\">\r\n              <span class=\"level-badge\" :style=\"{ background: membershipInfo.color }\">\r\n                {{ membershipInfo.label }}\r\n              </span>\r\n              <span class=\"points-text\">å½“å‰ç§¯åˆ†ï¼š{{ membershipInfo.points }}</span>\r\n              <span class=\"discount-text\">å½“å‰æŠ˜æ‰£ï¼š{{ membershipInfo.discountText }}</span>\r\n            </div>\r\n            <div class=\"membership-progress\">\r\n              <div class=\"progress-track\">\r\n                <div\r\n                  class=\"progress-bar\"\r\n                  :style=\"{ width: membershipInfo.progress + '%', background: membershipInfo.color }\"\r\n                ></div>\r\n              </div>\r\n              <div class=\"progress-info\">\r\n                <span v-if=\"membershipInfo.diffToNext > 0\">\r\n                  è·ç¦» {{ membershipInfo.nextLabel }} è¿˜å·® {{ membershipInfo.diffToNext }} åˆ†\r\n                </span>\r\n                <span v-else>å·²æ˜¯æœ€é«˜ç­‰çº§</span>\r\n              </div>\r\n              <div class=\"next-level\" v-if=\"membershipInfo.nextThreshold\">\r\n                ä¸‹ä¸€ç­‰çº§é—¨æ§›ï¼š{{ membershipInfo.nextThreshold }} åˆ†\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- ä¿¡æ¯è¡¨å• -->\r\n          <div class=\"form-section\">\r\n            <div class=\"form-group\">\r\n              <label for=\"username\">\r\n                <span class=\"label-icon\">ğŸ‘¤</span>\r\n                ç”¨æˆ·åï¼š\r\n              </label>\r\n              <div class=\"input-wrapper-with-hint\">\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"username\"\r\n                  v-model=\"form.username\"\r\n                  placeholder=\"è¯·è¾“å…¥ç”¨æˆ·å(2-10ä½)\"\r\n                  class=\"form-input\"\r\n                  :disabled=\"!isEditing\"\r\n                  maxlength=\"10\"\r\n                />\r\n                <div v-if=\"isEditing && form.username !== userInfo.username\" class=\"field-hint\">\r\n                  <span class=\"hint-icon\">âš ï¸</span>\r\n                  <span class=\"hint-text\">ä¿®æ”¹ç”¨æˆ·åéœ€è¦éªŒè¯å¯†ç å¹¶æ£€æŸ¥æ˜¯å¦é‡å¤</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label for=\"phone\">\r\n                <span class=\"label-icon\">ğŸ“±</span>\r\n                æ‰‹æœºå·ï¼š\r\n              </label>\r\n              <div class=\"input-with-action\">\r\n                <input\r\n                  type=\"tel\"\r\n                  id=\"phone\"\r\n                  v-model=\"form.phone\"\r\n                  placeholder=\"è¯·è¾“å…¥æ‰‹æœºå·\"\r\n                  class=\"form-input\"\r\n                  :disabled=\"!isEditing\"\r\n                />\r\n                <button \r\n                  v-if=\"isEditing && form.phone !== userInfo.phone\" \r\n                  @click=\"handleChangePhone\"\r\n                  class=\"verify-btn\"\r\n                >\r\n                  éªŒè¯\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label for=\"email\">\r\n                <span class=\"label-icon\">ğŸ“§</span>\r\n                é‚®ç®±ï¼š\r\n              </label>\r\n              <div class=\"input-with-action\">\r\n                <input\r\n                  type=\"email\"\r\n                  id=\"email\"\r\n                  v-model=\"form.email\"\r\n                  placeholder=\"è¯·è¾“å…¥é‚®ç®±\"\r\n                  class=\"form-input\"\r\n                  :disabled=\"!isEditing\"\r\n                />\r\n                <button \r\n                  v-if=\"isEditing && form.email !== userInfo.email\" \r\n                  @click=\"handleChangeEmail\"\r\n                  class=\"verify-btn\"\r\n                >\r\n                  éªŒè¯\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"form-group\" v-if=\"isEditing && (needPasswordVerify || isChangingPassword)\">\r\n              <label for=\"password\">\r\n                <span class=\"label-icon\">ğŸ”’</span>\r\n                å½“å‰å¯†ç ï¼š\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                id=\"password\"\r\n                v-model=\"passwordVerify\"\r\n                placeholder=\"è¯·è¾“å…¥å½“å‰å¯†ç è¿›è¡ŒéªŒè¯\"\r\n                class=\"form-input\"\r\n              />\r\n            </div>\r\n\r\n            <div class=\"form-group\" v-if=\"isChangingPassword\">\r\n              <label for=\"newPassword\">\r\n                <span class=\"label-icon\">ğŸ”‘</span>\r\n                æ–°å¯†ç ï¼š\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                id=\"newPassword\"\r\n                v-model=\"form.newPassword\"\r\n                placeholder=\"è¯·è¾“å…¥æ–°å¯†ç (6-16ä½)\"\r\n                class=\"form-input\"\r\n              />\r\n            </div>\r\n\r\n            <div class=\"form-group\" v-if=\"isChangingPassword\">\r\n              <label for=\"confirmPassword\">\r\n                <span class=\"label-icon\">âœ…</span>\r\n                ç¡®è®¤å¯†ç ï¼š\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                id=\"confirmPassword\"\r\n                v-model=\"form.confirmPassword\"\r\n                placeholder=\"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç \"\r\n                class=\"form-input\"\r\n              />\r\n            </div>\r\n\r\n            <!-- æ“ä½œæŒ‰é’® -->\r\n            <div class=\"action-buttons\">\r\n              <button \r\n                v-if=\"!isEditing\" \r\n                @click=\"startEdit\" \r\n                class=\"edit-btn\"\r\n              >\r\n                <span class=\"btn-icon\">âœï¸</span>\r\n                ç¼–è¾‘ä¿¡æ¯\r\n              </button>\r\n              <div v-else class=\"edit-actions\">\r\n                <button \r\n                  @click=\"handleChangePassword\" \r\n                  class=\"change-password-btn\"\r\n                  v-if=\"!isChangingPassword\"\r\n                >\r\n                  <span class=\"btn-icon\">ğŸ”‘</span>\r\n                  ä¿®æ”¹å¯†ç \r\n                </button>\r\n                <button \r\n                  @click=\"saveChanges\" \r\n                  class=\"save-btn\"\r\n                  :disabled=\"isSaving\"\r\n                >\r\n                  <span class=\"btn-icon\">ğŸ’¾</span>\r\n                  {{ isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ä¿®æ”¹' }}\r\n                </button>\r\n                <button \r\n                  @click=\"cancelEdit\" \r\n                  class=\"cancel-btn\"\r\n                  :disabled=\"isSaving\"\r\n                >\r\n                  <span class=\"btn-icon\">âŒ</span>\r\n                  å–æ¶ˆ\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- é”™è¯¯æç¤º -->\r\n            <div v-if=\"errorMessage\" class=\"error-message\">\r\n              {{ errorMessage }}\r\n            </div>\r\n\r\n            <!-- æˆåŠŸæç¤º -->\r\n            <div v-if=\"successMessage\" class=\"success-message\">\r\n              {{ successMessage }}\r\n            </div>\r\n          </div>\r\n\r\n          <!-- å¯†ç å®‰å…¨ï¼šé€šè¿‡æ‰‹æœºå·/é‚®ç®±éªŒè¯ç ä¿®æ”¹å¯†ç  -->\r\n          <div class=\"form-section security-section\">\r\n            <div class=\"security-header\">\r\n              <div class=\"security-title\">\r\n                <span class=\"section-icon\">ğŸ›¡ï¸</span>\r\n                <span>å¯†ç å®‰å…¨</span>\r\n              </div>\r\n              <div class=\"security-method-switch\">\r\n                <button\r\n                  :class=\"{ active: passwordSecurity.method === 'phone' }\"\r\n                  @click=\"switchSecurityMethod('phone')\"\r\n                >\r\n                  æ‰‹æœºéªŒè¯ç \r\n                </button>\r\n                <button\r\n                  :class=\"{ active: passwordSecurity.method === 'email' }\"\r\n                  @click=\"switchSecurityMethod('email')\"\r\n                >\r\n                  é‚®ç®±éªŒè¯ç \r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"security-body\">\r\n              <div v-if=\"passwordSecurity.method === 'phone'\" class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-icon\">ğŸ“±</span>\r\n                  ç»‘å®šæ‰‹æœºå·ï¼š\r\n                </label>\r\n                <div class=\"input-with-action\">\r\n                  <input\r\n                    type=\"tel\"\r\n                    v-model=\"passwordSecurity.phone\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"è¯·è¾“å…¥æ‰‹æœºå·\"\r\n                  />\r\n                  <button\r\n                    class=\"verify-btn\"\r\n                    :disabled=\"passwordSecurity.sendingSms || passwordSecurity.smsCountdown > 0\"\r\n                    @click=\"sendSecurityCode\"\r\n                  >\r\n                    <span v-if=\"passwordSecurity.smsCountdown > 0\">{{ passwordSecurity.smsCountdown }}s</span>\r\n                    <span v-else>å‘é€éªŒè¯ç </span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div v-else class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-icon\">ğŸ“§</span>\r\n                  ç»‘å®šé‚®ç®±ï¼š\r\n                </label>\r\n                <div class=\"input-with-action\">\r\n                  <input\r\n                    type=\"email\"\r\n                    v-model=\"passwordSecurity.email\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"è¯·è¾“å…¥é‚®ç®±\"\r\n                  />\r\n                  <button\r\n                    class=\"verify-btn\"\r\n                    :disabled=\"passwordSecurity.sendingEmail || passwordSecurity.emailCountdown > 0\"\r\n                    @click=\"sendSecurityCode\"\r\n                  >\r\n                    <span v-if=\"passwordSecurity.emailCountdown > 0\">{{ passwordSecurity.emailCountdown }}s</span>\r\n                    <span v-else>å‘é€éªŒè¯ç </span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-icon\">ğŸ”¢</span>\r\n                  éªŒè¯ç ï¼š\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  v-model=\"passwordSecurity.code\"\r\n                  maxlength=\"6\"\r\n                  class=\"form-input\"\r\n                  placeholder=\"è¯·è¾“å…¥6ä½éªŒè¯ç \"\r\n                />\r\n              </div>\r\n\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-icon\">ğŸ”‘</span>\r\n                  æ–°å¯†ç ï¼š\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  v-model=\"passwordSecurity.newPassword\"\r\n                  class=\"form-input\"\r\n                  placeholder=\"è¯·è¾“å…¥æ–°å¯†ç (6-16ä½)\"\r\n                />\r\n              </div>\r\n\r\n              <div class=\"form-group\">\r\n                <label>\r\n                  <span class=\"label-icon\">âœ…</span>\r\n                  ç¡®è®¤å¯†ç ï¼š\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  v-model=\"passwordSecurity.confirmPassword\"\r\n                  class=\"form-input\"\r\n                  placeholder=\"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç \"\r\n                />\r\n              </div>\r\n\r\n              <div class=\"action-buttons\">\r\n                <button class=\"save-btn\" @click=\"submitPasswordReset\">\r\n                  <span class=\"btn-icon\">ğŸ› ï¸</span>\r\n                  ç¡®è®¤ä¿®æ”¹å¯†ç \r\n                </button>\r\n              </div>\r\n\r\n              <div v-if=\"securityError\" class=\"error-message\">\r\n                {{ securityError }}\r\n              </div>\r\n              <div v-if=\"securityMessage\" class=\"success-message\">\r\n                {{ securityMessage }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- ç­‰çº§ä¼˜æƒ å¼¹çª— -->\r\n        <div v-if=\"showBenefitModal\" class=\"benefit-modal-backdrop\">\r\n          <div class=\"benefit-modal\">\r\n            <h3>ä¼šå‘˜ç­‰çº§ä¼˜æƒ </h3>\r\n            <ul class=\"benefit-list\">\r\n              <li v-for=\"tier in membershipTiers\" :key=\"tier.key\">\r\n                <span>{{ tier.label }}</span>\r\n                <span>{{ tier.discountText }}</span>\r\n              </li>\r\n            </ul>\r\n            <button class=\"modal-close-btn\" @click=\"showBenefitModal = false\">æˆ‘çŸ¥é“äº†</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport apiConfig from '@/config/api.config.js';\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  name: 'UserProfile',\r\n  data() {\r\n    return {\r\n      userInfo: {\r\n        uid: null,\r\n        username: '',\r\n        phone: '',\r\n        email: '',\r\n        avatar: '',\r\n        role: 'user'\r\n      },\r\n      form: {\r\n        username: '',\r\n        phone: '',\r\n        email: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      },\r\n      passwordVerify: '',\r\n      isEditing: false,\r\n      isChangingPassword: false,\r\n      needPasswordVerify: false,\r\n      isSaving: false,\r\n      membershipInfo: {\r\n        label: 'æ™®é€šä¼šå‘˜',\r\n        levelKey: 'normal',\r\n        points: 0,\r\n        discountText: 'ä¸æ‰“æŠ˜',\r\n        color: '#64b5f6',\r\n        progress: 0,\r\n        diffToNext: 3000,\r\n        nextThreshold: 3000,\r\n        nextLabel: 'VIPä¼šå‘˜'\r\n      },\r\n      showBenefitModal: false,\r\n      errorMessage: '',\r\n      successMessage: '',\r\n      securityMessage: '',\r\n      securityError: '',\r\n      passwordSecurity: {\r\n        method: 'phone',\r\n        phone: '',\r\n        email: '',\r\n        code: '',\r\n        newPassword: '',\r\n        confirmPassword: '',\r\n        smsCountdown: 0,\r\n        emailCountdown: 0,\r\n        sendingSms: false,\r\n        sendingEmail: false,\r\n        smsTimer: null,\r\n        emailTimer: null\r\n      },\r\n      defaultAvatar: 'https://via.placeholder.com/150/4b6cb7/FFFFFF?text=User'\r\n    };\r\n  },\r\n  mounted() {\r\n    this.loadUserInfo();\r\n    this.fetchStudentStatus();\r\n  },\r\n  beforeUnmount() {\r\n    this.clearSecurityTimers();\r\n  },\r\n  computed: {\r\n    membershipTiers() {\r\n      return this.getMembershipTiers();\r\n    }\r\n  },\r\n  methods: {\r\n    normalizeToString(value) {\r\n      if (value === null || value === undefined) return '';\r\n      return String(value);\r\n    },\r\n\r\n    async loadUserInfo() {\r\n      const uid = localStorage.getItem('userId');\r\n      if (!uid) {\r\n        this.errorMessage = 'æœªæ‰¾åˆ°ç”¨æˆ·IDï¼Œè¯·é‡æ–°ç™»å½•';\r\n        setTimeout(() => {\r\n          this.$router.push('/login');\r\n        }, 2000);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const response = await axios.get(apiConfig.user.getUserById(uid));\r\n        if (response.data.code === 1) {\r\n          const data = response.data.data || {};\r\n          const normalizedUser = {\r\n            ...this.userInfo,\r\n            ...data,\r\n            username: this.normalizeToString(data.username),\r\n            phone: this.normalizeToString(data.phone),\r\n            email: this.normalizeToString(data.email)\r\n          };\r\n          this.userInfo = normalizedUser;\r\n          this.form = {\r\n            username: normalizedUser.username,\r\n            phone: normalizedUser.phone,\r\n            email: normalizedUser.email,\r\n            newPassword: '',\r\n            confirmPassword: ''\r\n          };\r\n          // åˆå§‹åŒ–å®‰å…¨æ¨¡å—çš„è”ç³»æ–¹å¼\r\n          this.passwordSecurity.phone = normalizedUser.phone;\r\n          this.passwordSecurity.email = normalizedUser.email;\r\n        } else {\r\n          this.errorMessage = response.data.msg || 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥';\r\n        }\r\n      } catch (error) {\r\n        console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);\r\n        this.errorMessage = 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n      }\r\n\r\n      // æ‹‰å–ä¼šå‘˜ä¿¡æ¯\r\n      this.fetchMembership();\r\n    },\r\n\r\n    startEdit() {\r\n      this.isEditing = true;\r\n      this.errorMessage = '';\r\n      this.successMessage = '';\r\n    },\r\n\r\n    cancelEdit() {\r\n      this.isEditing = false;\r\n      this.isChangingPassword = false;\r\n      this.needPasswordVerify = false;\r\n      this.passwordVerify = '';\r\n      this.form = {\r\n        username: this.userInfo.username || '',\r\n        phone: this.userInfo.phone || '',\r\n        email: this.userInfo.email || '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      };\r\n      this.errorMessage = '';\r\n      this.successMessage = '';\r\n    },\r\n\r\n    handleChangePassword() {\r\n      this.isChangingPassword = true;\r\n      this.needPasswordVerify = true;\r\n    },\r\n\r\n    async handleChangePhone() {\r\n      // æ¢ç»‘æ‰‹æœºå·éœ€è¦å¯†ç éªŒè¯\r\n      if (!this.passwordVerify) {\r\n        this.errorMessage = 'è¯·å…ˆè¾“å…¥å½“å‰å¯†ç è¿›è¡ŒéªŒè¯';\r\n        this.needPasswordVerify = true;\r\n        return;\r\n      }\r\n\r\n      // éªŒè¯å¯†ç \r\n      const isValid = await this.verifyPassword();\r\n      if (!isValid) {\r\n        return;\r\n      }\r\n\r\n      // è¿™é‡Œå¯ä»¥æ·»åŠ æ‰‹æœºå·éªŒè¯ç éªŒè¯é€»è¾‘\r\n      this.successMessage = 'æ‰‹æœºå·ä¿®æ”¹åŠŸèƒ½éœ€è¦çŸ­ä¿¡éªŒè¯ï¼Œè¯·å…ˆä¿å­˜å…¶ä»–ä¿¡æ¯';\r\n    },\r\n\r\n    async handleChangeEmail() {\r\n      // æ¢ç»‘é‚®ç®±éœ€è¦å¯†ç éªŒè¯\r\n      if (!this.passwordVerify) {\r\n        this.errorMessage = 'è¯·å…ˆè¾“å…¥å½“å‰å¯†ç è¿›è¡ŒéªŒè¯';\r\n        this.needPasswordVerify = true;\r\n        return;\r\n      }\r\n\r\n      // éªŒè¯å¯†ç \r\n      const isValid = await this.verifyPassword();\r\n      if (!isValid) {\r\n        return;\r\n      }\r\n\r\n      this.successMessage = 'é‚®ç®±ä¿®æ”¹åŠŸèƒ½éœ€è¦é‚®ç®±éªŒè¯ï¼Œè¯·å…ˆä¿å­˜å…¶ä»–ä¿¡æ¯';\r\n    },\r\n\r\n    async verifyPassword() {\r\n      if (!this.passwordVerify) {\r\n        this.errorMessage = 'è¯·è¾“å…¥å½“å‰å¯†ç ';\r\n        return false;\r\n      }\r\n\r\n      try {\r\n        const uid = localStorage.getItem('userId');\r\n        \r\n        // æ³¨æ„ï¼šåç«¯æ²¡æœ‰å•ç‹¬çš„éªŒè¯å¯†ç æ¥å£\r\n        // æ–¹æ¡ˆ1ï¼šé€šè¿‡å°è¯•ç™»å½•æ¥éªŒè¯å¯†ç ï¼ˆä½¿ç”¨ç”¨æˆ·åç™»å½•ï¼‰\r\n        // æ–¹æ¡ˆ2ï¼šç›´æ¥ä¿®æ”¹ï¼Œè®©åç«¯éªŒè¯ï¼ˆä½†è¿™æ ·ä¼šå…ˆä¿®æ”¹å†éªŒè¯ï¼Œä¸å¤ªå¥½ï¼‰\r\n        // æ–¹æ¡ˆ3ï¼šæš‚æ—¶è·³è¿‡éªŒè¯ï¼Œåœ¨ä¿å­˜æ—¶è®©åç«¯éªŒè¯\r\n        \r\n        // ä½¿ç”¨æ–¹æ¡ˆ1ï¼šé€šè¿‡ç”¨æˆ·åç™»å½•æ¥å£éªŒè¯å¯†ç \r\n        // è·å–å½“å‰ç”¨æˆ·å\r\n        const username = this.normalizeToString(this.userInfo.username) || this.normalizeToString(localStorage.getItem('username'));\r\n        if (!username) {\r\n          this.errorMessage = 'æ— æ³•è·å–ç”¨æˆ·åï¼Œè¯·é‡æ–°ç™»å½•';\r\n          return false;\r\n        }\r\n\r\n        // å°è¯•ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•æ¥éªŒè¯\r\n        const response = await axios.get(apiConfig.user.usernameLogin, {\r\n          params: {\r\n            username: username,\r\n            password: this.passwordVerify\r\n          }\r\n        });\r\n\r\n        if (response.data && response.data.code === 1) {\r\n          // å¯†ç éªŒè¯æˆåŠŸ\r\n          this.errorMessage = '';\r\n          return true;\r\n        } else {\r\n          // å¯†ç éªŒè¯å¤±è´¥\r\n          this.errorMessage = response.data?.msg || 'å¯†ç éªŒè¯å¤±è´¥';\r\n          return false;\r\n        }\r\n      } catch (error) {\r\n        console.error('å¯†ç éªŒè¯å¤±è´¥:', error);\r\n        if (error.response && error.response.data) {\r\n          this.errorMessage = error.response.data.msg || 'å¯†ç éªŒè¯å¤±è´¥';\r\n        } else {\r\n          this.errorMessage = 'å¯†ç éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n        }\r\n        return false;\r\n      }\r\n    },\r\n\r\n    async handleAvatarUpload(event) {\r\n      const file = event.target.files[0];\r\n      if (!file) return;\r\n\r\n      // éªŒè¯æ–‡ä»¶ç±»å‹\r\n      if (!file.type.startsWith('image/')) {\r\n        this.errorMessage = 'è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶';\r\n        return;\r\n      }\r\n\r\n      // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶5MBï¼‰\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        this.errorMessage = 'å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB';\r\n        return;\r\n      }\r\n\r\n      this.isSaving = true;\r\n      this.errorMessage = '';\r\n\r\n      try {\r\n        const formData = new FormData();\r\n        // æ·»åŠ  uid å‚æ•°ï¼Œç¡®ä¿åç«¯çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·\r\n        const uid = localStorage.getItem('userId');\r\n        formData.append('uid', uid);\r\n        formData.append('file', file);\r\n\r\n        // åç«¯æ¥å£ä½¿ç”¨ POST æäº¤å¤´åƒæ–‡ä»¶\r\n        const response = await axios.post(apiConfig.user.updateAvatar, formData, {\r\n          headers: {\r\n            'Content-Type': 'multipart/form-data'\r\n          }\r\n        });\r\n\r\n        if (response.data.code === 1) {\r\n          this.userInfo.avatar = response.data.data;\r\n          this.successMessage = 'å¤´åƒä¸Šä¼ æˆåŠŸ';\r\n          \r\n          // æ›´æ–° localStorage ä¸­çš„å¤´åƒä¿¡æ¯ï¼ˆå¦‚æœæœ‰å­˜å‚¨çš„è¯ï¼‰\r\n          // å¹¶è§¦å‘äº‹ä»¶é€šçŸ¥å…¶ä»–ç»„ä»¶\r\n          window.dispatchEvent(new Event('storage'));\r\n          \r\n          setTimeout(() => {\r\n            this.successMessage = '';\r\n          }, 3000);\r\n        } else {\r\n          this.errorMessage = response.data.msg || 'å¤´åƒä¸Šä¼ å¤±è´¥';\r\n          \r\n          // å¦‚æœåç«¯ä¸Šä¼ å¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°é¢„è§ˆï¼ˆä»…ä½œä¸ºå…œåº•ï¼Œå®é™…åº”ä»¥æœåŠ¡å™¨ä¸ºå‡†ï¼‰\r\n          // const reader = new FileReader();\r\n          // reader.onload = (e) => {\r\n          //   this.userInfo.avatar = e.target.result;\r\n          // };\r\n          // reader.readAsDataURL(file);\r\n        }\r\n      } catch (error) {\r\n        console.error('å¤´åƒä¸Šä¼ å¤±è´¥:', error);\r\n        this.errorMessage = 'å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n      } finally {\r\n        this.isSaving = false;\r\n      }\r\n    },\r\n\r\n    handleAvatarError(event) {\r\n      event.target.src = this.defaultAvatar;\r\n    },\r\n\r\n    getMembershipTiers() {\r\n      return [\r\n        { key: 'normal', label: 'æ™®é€šä¼šå‘˜', min: 0, max: 3000, discount: 1, color: '#64b5f6', discountText: 'ä¸æ‰“æŠ˜' },\r\n        { key: 'vip', label: 'VIPä¼šå‘˜', min: 3000, max: 6000, discount: 0.95, color: '#7e57c2', discountText: '9.5æŠ˜' },\r\n        { key: 'svip', label: 'SVIPä¼šå‘˜', min: 6000, max: 12000, discount: 0.9, color: '#ff9800', discountText: '9æŠ˜' },\r\n        { key: 'king', label: 'é‡‘ä¸»çˆ¸çˆ¸', min: 12000, max: Infinity, discount: 0.8, color: '#fbc02d', discountText: '8æŠ˜' }\r\n      ];\r\n    },\r\n\r\n    calculateMembership(points = 0) {\r\n      const tiers = this.getMembershipTiers();\r\n      const current = tiers.find(t => points >= t.min && points < t.max) || tiers[tiers.length - 1];\r\n      const currentIndex = tiers.indexOf(current);\r\n      const next = tiers[currentIndex + 1];\r\n\r\n      const lower = current.min;\r\n      const upper = current.max;\r\n      const progress = upper === Infinity ? 100 : Math.min(100, Math.max(0, ((points - lower) / (upper - lower)) * 100));\r\n      const diffToNext = upper === Infinity ? 0 : Math.max(0, Math.ceil(upper - points));\r\n\r\n      return {\r\n        ...current,\r\n        points,\r\n        progress: Number(progress.toFixed(2)),\r\n        diffToNext,\r\n        nextThreshold: upper === Infinity ? null : upper,\r\n        nextLabel: next ? next.label : null,\r\n        discountText: current.discountText\r\n      };\r\n    },\r\n\r\n    async fetchMembership() {\r\n      const uid = localStorage.getItem('userId');\r\n      if (!uid) return;\r\n      try {\r\n        const res = await axios.get(apiConfig.user.getUserRole(uid));\r\n        if (res.data && res.data.code === 1) {\r\n          const role = res.data.data || {};\r\n          const points = Number(role.points || 0);\r\n          this.membershipInfo = this.calculateMembership(points);\r\n        }\r\n      } catch (error) {\r\n        console.error('è·å–ä¼šå‘˜ä¿¡æ¯å¤±è´¥:', error);\r\n      }\r\n    },\r\n\r\n    async fetchStudentStatus() {\r\n      const uid = localStorage.getItem('userId');\r\n      if (!uid) return;\r\n      try {\r\n        const res = await axios.get(apiConfig.student.getStatus(uid));\r\n        console.log('ä¸ªäººä¸­å¿ƒ-å­¦ç”Ÿè®¤è¯çŠ¶æ€:', res.data);\r\n        if (res.data.code === 1) {\r\n          this.studentStatus = res.data.data;\r\n          // å¼ºåˆ¶åˆ·æ–°è§†å›¾ï¼ˆå¦‚æœéœ€è¦ï¼‰\r\n          this.$forceUpdate();\r\n        }\r\n      } catch (e) {\r\n        console.error('è·å–å­¦ç”Ÿè®¤è¯çŠ¶æ€å¤±è´¥', e);\r\n      }\r\n    },\r\n\r\n    // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨\r\n    async checkUsernameExists(username) {\r\n      const value = this.normalizeToString(username);\r\n      if (!value || value.trim() === '') {\r\n        return false;\r\n      }\r\n\r\n      // å¦‚æœç”¨æˆ·åæ²¡æœ‰å˜åŒ–ï¼Œä¸éœ€è¦æ£€æŸ¥\r\n      if (value === this.normalizeToString(this.userInfo.username)) {\r\n        return false;\r\n      }\r\n\r\n      try {\r\n        const response = await axios.get(apiConfig.user.checkUsername, {\r\n          params: { username: value }\r\n        });\r\n\r\n        // code === 0 è¡¨ç¤ºç”¨æˆ·åå·²å­˜åœ¨\r\n        if (response.data.code === 0) {\r\n          return true;\r\n        }\r\n        return false;\r\n      } catch (error) {\r\n        console.error('æ£€æŸ¥ç”¨æˆ·åå¤±è´¥:', error);\r\n        // å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¸å…è®¸ä¿®æ”¹\r\n        this.errorMessage = 'æ£€æŸ¥ç”¨æˆ·åå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n        return true; // è¿”å›trueé˜»æ­¢ä¿®æ”¹\r\n      }\r\n    },\r\n\r\n    async saveChanges() {\r\n      this.errorMessage = '';\r\n      this.successMessage = '';\r\n\r\n      const usernameValue = this.normalizeToString(this.form.username);\r\n      const currentUsername = this.normalizeToString(this.userInfo.username);\r\n      const hasUsernameChanged = usernameValue !== currentUsername;\r\n\r\n      // éªŒè¯è¡¨å•\r\n      if (!usernameValue || usernameValue.trim() === '') {\r\n        this.errorMessage = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';\r\n        return;\r\n      }\r\n\r\n      // éªŒè¯ç”¨æˆ·åé•¿åº¦\r\n      if (usernameValue.length < 2 || usernameValue.length > 10) {\r\n        this.errorMessage = 'ç”¨æˆ·åé•¿åº¦ä¸º2-10ä½';\r\n        return;\r\n      }\r\n\r\n      // å¦‚æœä¿®æ”¹äº†ç”¨æˆ·åï¼Œéœ€è¦éªŒè¯å¯†ç å’Œæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤\r\n      if (hasUsernameChanged) {\r\n        if (!this.passwordVerify) {\r\n          this.errorMessage = 'ä¿®æ”¹ç”¨æˆ·åéœ€è¦éªŒè¯å½“å‰å¯†ç ';\r\n          this.needPasswordVerify = true;\r\n          return;\r\n        }\r\n\r\n        // éªŒè¯å¯†ç \r\n        const isValid = await this.verifyPassword();\r\n        if (!isValid) {\r\n          return;\r\n        }\r\n\r\n        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨\r\n        const usernameExists = await this.checkUsernameExists(usernameValue);\r\n        if (usernameExists) {\r\n          this.errorMessage = 'ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–ç”¨æˆ·å';\r\n          return;\r\n        }\r\n      }\r\n\r\n      // å¦‚æœä¿®æ”¹äº†æ‰‹æœºå·ï¼Œéœ€è¦å¯†ç éªŒè¯å’Œé¢å¤–éªŒè¯ï¼ˆé¢„ç•™æ¥å£ï¼‰\r\n      const phoneValue = this.normalizeToString(this.form.phone);\r\n      const currentPhone = this.normalizeToString(this.userInfo.phone);\r\n      const hasPhoneChanged = phoneValue !== currentPhone;\r\n\r\n      if (hasPhoneChanged) {\r\n        if (!this.passwordVerify) {\r\n          this.errorMessage = 'ä¿®æ”¹æ‰‹æœºå·éœ€è¦éªŒè¯å½“å‰å¯†ç ';\r\n          this.needPasswordVerify = true;\r\n          return;\r\n        }\r\n\r\n        // éªŒè¯å¯†ç \r\n        const isValid = await this.verifyPassword();\r\n        if (!isValid) {\r\n          return;\r\n        }\r\n\r\n        // éªŒè¯æ‰‹æœºå·æ ¼å¼\r\n        const phoneRegex = /^1[3-9]\\d{9}$/;\r\n        if (!phoneRegex.test(phoneValue)) {\r\n          this.errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·';\r\n          return;\r\n        }\r\n\r\n        // æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨\r\n        try {\r\n          const response = await axios.get(apiConfig.user.checkPhone, {\r\n            params: { phone: phoneValue }\r\n          });\r\n\r\n          // code === 0 è¡¨ç¤ºæ‰‹æœºå·å·²å­˜åœ¨\r\n          if (response.data.code === 0) {\r\n            // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·çš„æ‰‹æœºå·\r\n            if (hasPhoneChanged) {\r\n              this.errorMessage = 'è¯¥æ‰‹æœºå·å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–æ‰‹æœºå·';\r\n              return;\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('æ£€æŸ¥æ‰‹æœºå·å¤±è´¥:', error);\r\n          this.errorMessage = 'æ£€æŸ¥æ‰‹æœºå·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n          return;\r\n        }\r\n\r\n        // é¢„ç•™ï¼šæ‰‹æœºå·ä¿®æ”¹éœ€è¦çŸ­ä¿¡éªŒè¯ï¼ˆç›®å‰æ¥å£æœªæä¾›ï¼‰\r\n        // è¿™é‡Œå¯ä»¥æ·»åŠ çŸ­ä¿¡éªŒè¯ç éªŒè¯é€»è¾‘\r\n        this.successMessage = 'æç¤ºï¼šæ‰‹æœºå·ä¿®æ”¹éœ€è¦çŸ­ä¿¡éªŒè¯ï¼Œå½“å‰ä»…ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè¯·ç¡®ä¿æ‰‹æœºå·æ­£ç¡®';\r\n      }\r\n\r\n      // å¦‚æœä¿®æ”¹äº†é‚®ç®±ï¼Œéœ€è¦å¯†ç éªŒè¯å’Œé¢å¤–éªŒè¯ï¼ˆé¢„ç•™æ¥å£ï¼‰\r\n      const emailValue = this.normalizeToString(this.form.email);\r\n      const currentEmail = this.normalizeToString(this.userInfo.email);\r\n      const hasEmailChanged = emailValue !== currentEmail;\r\n\r\n      if (hasEmailChanged) {\r\n        if (!this.passwordVerify) {\r\n          this.errorMessage = 'ä¿®æ”¹é‚®ç®±éœ€è¦éªŒè¯å½“å‰å¯†ç ';\r\n          this.needPasswordVerify = true;\r\n          return;\r\n        }\r\n\r\n        // éªŒè¯å¯†ç \r\n        const isValid = await this.verifyPassword();\r\n        if (!isValid) {\r\n          return;\r\n        }\r\n\r\n        // éªŒè¯é‚®ç®±æ ¼å¼\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (emailValue && !emailRegex.test(emailValue)) {\r\n          this.errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';\r\n          return;\r\n        }\r\n\r\n        // é¢„ç•™ï¼šé‚®ç®±ä¿®æ”¹éœ€è¦é‚®ç®±éªŒè¯ï¼ˆç›®å‰æ¥å£æœªæä¾›ï¼‰\r\n        // è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ç®±éªŒè¯ç éªŒè¯é€»è¾‘\r\n        this.successMessage = 'æç¤ºï¼šé‚®ç®±ä¿®æ”¹éœ€è¦é‚®ç®±éªŒè¯ï¼Œå½“å‰ä»…ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè¯·ç¡®ä¿é‚®ç®±æ­£ç¡®';\r\n      }\r\n\r\n      // å¦‚æœä¿®æ”¹å¯†ç ï¼ŒéªŒè¯æ–°å¯†ç \r\n      if (this.isChangingPassword) {\r\n        if (!this.form.newPassword || this.form.newPassword.length < 6 || this.form.newPassword.length > 16) {\r\n          this.errorMessage = 'æ–°å¯†ç é•¿åº¦ä¸º6-16ä½';\r\n          return;\r\n        }\r\n\r\n        if (this.form.newPassword !== this.form.confirmPassword) {\r\n          this.errorMessage = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';\r\n          return;\r\n        }\r\n\r\n        // éªŒè¯å½“å‰å¯†ç \r\n        const isValid = await this.verifyPassword();\r\n        if (!isValid) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.isSaving = true;\r\n\r\n      try {\r\n        const uid = localStorage.getItem('userId');\r\n        \r\n        // é‡è¦ï¼šåç«¯updateByIdä¼šæ›´æ–°æ‰€æœ‰å­—æ®µï¼ˆusername, password, email, phone, status, avatar, roleï¼‰\r\n        // å¦‚æœæŸä¸ªå­—æ®µä¸ºnullï¼Œä¼šè¢«è®¾ç½®ä¸ºnullï¼Œå¯¼è‡´æ•°æ®åº“çº¦æŸé”™è¯¯\r\n        // æ‰€ä»¥å¿…é¡»åŒ…å«æ‰€æœ‰å¿…å¡«å­—æ®µï¼Œä½¿ç”¨åŸæœ‰å€¼æˆ–æ–°å€¼\r\n        \r\n        // ç¡®ä¿usernameä¸ä¸ºç©º\r\n        const username = usernameValue.trim() || currentUsername;\r\n        if (!username) {\r\n          this.errorMessage = 'ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼Œè¯·å…ˆè®¾ç½®ç”¨æˆ·å';\r\n          this.isSaving = false;\r\n          return;\r\n        }\r\n\r\n        const updateData = {\r\n          uid: parseInt(uid || this.userInfo.uid || this.userInfo.id),\r\n          // å¿…é¡»åŒ…å«usernameï¼Œå› ä¸ºæ•°æ®åº“çº¦æŸä¸å…è®¸ä¸ºnull\r\n          username: username,\r\n          // åŒ…å«å…¶ä»–å­—æ®µï¼Œä½¿ç”¨æ–°å€¼ï¼ˆå¦‚æœæœ‰å˜åŒ–ï¼‰æˆ–ä¿æŒåŸæœ‰å€¼\r\n          phone: (hasPhoneChanged && phoneValue !== '')\r\n            ? phoneValue\r\n            : (currentPhone || null),\r\n          email: (hasEmailChanged && emailValue !== '')\r\n            ? emailValue\r\n            : (currentEmail || null),\r\n          // ä¿æŒåŸæœ‰çŠ¶æ€å’Œè§’è‰²ä¸å˜ï¼ˆè¿™äº›å­—æ®µä¸åº”è¯¥è¢«ç”¨æˆ·ä¿®æ”¹ï¼‰\r\n          status: (this.userInfo.status !== undefined && this.userInfo.status !== null) ? this.userInfo.status : 1,\r\n          avatar: this.userInfo.avatar || null,\r\n          role: this.userInfo.role || 'user'\r\n        };\r\n\r\n        // é‡è¦ä¿®å¤ï¼šå¯†ç å­—æ®µå¤„ç†\r\n        // æ•°æ®åº“çº¦æŸè¦æ±‚ password ä¸èƒ½ä¸ºç©º\r\n        // å¦‚æœç”¨æˆ·ä¿®æ”¹äº†å¯†ç ï¼Œä½¿ç”¨æ–°å¯†ç \r\n        if (this.isChangingPassword && this.form.newPassword) {\r\n          updateData.password = this.form.newPassword;\r\n        } else {\r\n          // å¦‚æœæ²¡æœ‰ä¿®æ”¹å¯†ç ï¼Œå¿…é¡»ä¼ å›å½“å‰å¯†ç ï¼Œå¦åˆ™åç«¯ä¼šå°†å¯†ç æ›´æ–°ä¸º NULL å¯¼è‡´æŠ¥é”™\r\n          // ç”±äºæˆ‘ä»¬å‰ç«¯æ²¡æœ‰å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š\r\n          // 1. å¦‚æœåç«¯æ”¯æŒä¸ä¼  password å­—æ®µå°±ä¸æ›´æ–°ï¼Œé‚£å°±ä¸ä¼ ï¼ˆä½†ç›®å‰çš„åç«¯é€»è¾‘ä¼¼ä¹æ˜¯å…¨é‡æ›´æ–°ï¼‰\r\n          // 2. æ—¢ç„¶ç”¨æˆ·è¾“å…¥äº†éªŒè¯å¯†ç  (passwordVerify)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯†ç ä½œä¸ºå½“å‰å¯†ç ä¼ å›\r\n          // æ³¨æ„ï¼šå‰ææ˜¯ verifyPassword() å·²ç»éªŒè¯è¿‡è¿™ä¸ªå¯†ç æ˜¯æ­£ç¡®çš„\r\n          \r\n          if (this.passwordVerify) {\r\n             updateData.password = this.passwordVerify;\r\n          } else {\r\n             // æç«¯æƒ…å†µï¼šå¦‚æœæ²¡ä¿®æ”¹å¯†ç ä¸”æ²¡è¾“å…¥éªŒè¯å¯†ç ï¼ˆä¾‹å¦‚ä»…ä¿®æ”¹å¤´åƒæˆ–éæ•æ„Ÿä¿¡æ¯ä¸éœ€è¦éªŒè¯å¯†ç çš„æƒ…å†µï¼‰\r\n             // ä½†æœ¬é¡µé¢çš„é€»è¾‘æ˜¯ä¿®æ”¹ä»»ä½•ä¿¡æ¯éƒ½éœ€è¦éªŒè¯å¯†ç ï¼Œæ‰€ä»¥ this.passwordVerify åº”è¯¥æ˜¯æœ‰å€¼çš„\r\n             // å¦‚æœç¡®å®æ²¡æœ‰ï¼Œå°è¯•ä» localStorage è·å–ï¼ˆå¦‚æœç™»å½•æ—¶ä¿å­˜äº†çš„è¯ï¼Œé€šå¸¸ä¸å»ºè®®ï¼‰\r\n             // æˆ–è€…æç¤ºç”¨æˆ·å¿…é¡»è¾“å…¥å¯†ç \r\n             this.errorMessage = 'ç³»ç»Ÿéœ€è¦éªŒè¯æ‚¨çš„å¯†ç æ‰èƒ½ä¿å­˜ä¿®æ”¹';\r\n             this.needPasswordVerify = true;\r\n             this.isSaving = false;\r\n             return;\r\n          }\r\n        }\r\n\r\n        console.log('å‡†å¤‡æ›´æ–°çš„æ•°æ®:', updateData);\r\n\r\n        // ä½¿ç”¨POSTè¯·æ±‚ï¼ˆæ ¹æ®åç«¯ä»£ç ï¼‰\r\n        const response = await axios.post(apiConfig.user.updateUserInfo, updateData);\r\n\r\n        if (response.data.code === 1) {\r\n          this.successMessage = 'ä¿¡æ¯ä¿®æ”¹æˆåŠŸ';\r\n          this.isEditing = false;\r\n          this.isChangingPassword = false;\r\n          this.needPasswordVerify = false;\r\n          this.passwordVerify = '';\r\n          this.form.newPassword = '';\r\n          this.form.confirmPassword = '';\r\n\r\n          // é‡æ–°åŠ è½½ç”¨æˆ·ä¿¡æ¯\r\n          await this.loadUserInfo();\r\n\r\n          // æ›´æ–°localStorageä¸­çš„ç”¨æˆ·å\r\n          if (this.form.username !== this.userInfo.username) {\r\n            localStorage.setItem('username', this.form.username);\r\n            // è§¦å‘App.vueæ›´æ–°\r\n            window.dispatchEvent(new Event('storage'));\r\n          }\r\n\r\n          setTimeout(() => {\r\n            this.successMessage = '';\r\n          }, 3000);\r\n        } else {\r\n          this.errorMessage = response.data.msg || 'ä¿®æ”¹å¤±è´¥';\r\n        }\r\n      } catch (error) {\r\n        console.error('ä¿å­˜å¤±è´¥:', error);\r\n        this.errorMessage = 'ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n      } finally {\r\n        this.isSaving = false;\r\n      }\r\n    },\r\n\r\n    switchSecurityMethod(method) {\r\n      this.passwordSecurity.method = method;\r\n      this.securityError = '';\r\n      this.securityMessage = '';\r\n\r\n      if (method === 'phone' && !this.passwordSecurity.phone) {\r\n        this.passwordSecurity.phone = this.normalizeToString(this.userInfo.phone);\r\n      }\r\n      if (method === 'email' && !this.passwordSecurity.email) {\r\n        this.passwordSecurity.email = this.normalizeToString(this.userInfo.email);\r\n      }\r\n    },\r\n\r\n    startSecurityCountdown(type) {\r\n      const countdownKey = type === 'phone' ? 'smsCountdown' : 'emailCountdown';\r\n      const timerKey = type === 'phone' ? 'smsTimer' : 'emailTimer';\r\n\r\n      if (this.passwordSecurity[timerKey]) {\r\n        clearInterval(this.passwordSecurity[timerKey]);\r\n      }\r\n\r\n      this.passwordSecurity[countdownKey] = 60;\r\n      this.passwordSecurity[timerKey] = setInterval(() => {\r\n        this.passwordSecurity[countdownKey] -= 1;\r\n        if (this.passwordSecurity[countdownKey] <= 0) {\r\n          clearInterval(this.passwordSecurity[timerKey]);\r\n          this.passwordSecurity[timerKey] = null;\r\n          this.passwordSecurity[countdownKey] = 0;\r\n        }\r\n      }, 1000);\r\n    },\r\n\r\n    clearSecurityTimers() {\r\n      if (this.passwordSecurity.smsTimer) {\r\n        clearInterval(this.passwordSecurity.smsTimer);\r\n        this.passwordSecurity.smsTimer = null;\r\n      }\r\n      if (this.passwordSecurity.emailTimer) {\r\n        clearInterval(this.passwordSecurity.emailTimer);\r\n        this.passwordSecurity.emailTimer = null;\r\n      }\r\n    },\r\n\r\n    async sendSecurityCode() {\r\n      this.securityError = '';\r\n      this.securityMessage = '';\r\n\r\n      if (this.passwordSecurity.method === 'phone') {\r\n        const phone = this.normalizeToString(this.passwordSecurity.phone);\r\n        const phoneRegex = /^1[3-9]\\d{9}$/;\r\n        if (!phoneRegex.test(phone)) {\r\n          this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·';\r\n          return;\r\n        }\r\n\r\n        this.passwordSecurity.sendingSms = true;\r\n        try {\r\n          const res = await axios.post(\r\n            apiConfig.passwordReset.smsSendCode,\r\n            { phone },\r\n            { headers: { 'Content-Type': 'application/json' } }\r\n          );\r\n          const data = res.data || {};\r\n          if (data.code === 1) {\r\n            this.securityMessage = data.msg || 'éªŒè¯ç å‘é€æˆåŠŸ';\r\n            this.startSecurityCountdown('phone');\r\n          } else {\r\n            this.securityError = data.msg || 'éªŒè¯ç å‘é€å¤±è´¥';\r\n          }\r\n        } catch (error) {\r\n          console.error('å‘é€çŸ­ä¿¡éªŒè¯ç å¤±è´¥:', error);\r\n          this.securityError = error.response?.data?.msg || 'éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n        } finally {\r\n          this.passwordSecurity.sendingSms = false;\r\n        }\r\n      } else {\r\n        const email = this.normalizeToString(this.passwordSecurity.email);\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (!emailRegex.test(email)) {\r\n          this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±';\r\n          return;\r\n        }\r\n\r\n        this.passwordSecurity.sendingEmail = true;\r\n        try {\r\n          const res = await axios.post(\r\n            apiConfig.email.sendResetCode,\r\n            { email },\r\n            { headers: { 'Content-Type': 'application/json' } }\r\n          );\r\n          const data = res.data || {};\r\n          if (data.code === 1) {\r\n            this.securityMessage = data.msg || 'éªŒè¯ç å‘é€æˆåŠŸ';\r\n            this.startSecurityCountdown('email');\r\n          } else {\r\n            this.securityError = data.msg || 'éªŒè¯ç å‘é€å¤±è´¥';\r\n          }\r\n        } catch (error) {\r\n          console.error('å‘é€é‚®ç®±éªŒè¯ç å¤±è´¥:', error);\r\n          this.securityError = error.response?.data?.msg || 'éªŒè¯ç å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n        } finally {\r\n          this.passwordSecurity.sendingEmail = false;\r\n        }\r\n      }\r\n    },\r\n\r\n    async submitPasswordReset() {\r\n      this.securityError = '';\r\n      this.securityMessage = '';\r\n\r\n      const newPwd = this.passwordSecurity.newPassword;\r\n      const confirmPwd = this.passwordSecurity.confirmPassword;\r\n      const code = this.normalizeToString(this.passwordSecurity.code);\r\n\r\n      if (!code || code.length !== 6) {\r\n        this.securityError = 'è¯·è¾“å…¥6ä½éªŒè¯ç ';\r\n        return;\r\n      }\r\n\r\n      if (!newPwd || newPwd.length < 6 || newPwd.length > 16) {\r\n        this.securityError = 'æ–°å¯†ç é•¿åº¦ä¸º6-16ä½';\r\n        return;\r\n      }\r\n\r\n      if (newPwd !== confirmPwd) {\r\n        this.securityError = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';\r\n        return;\r\n      }\r\n\r\n      try {\r\n        let url = '';\r\n        const payload = {\r\n          code,\r\n          newPassword: newPwd,\r\n          confirmPassword: confirmPwd\r\n        };\r\n\r\n        if (this.passwordSecurity.method === 'phone') {\r\n          const phone = this.normalizeToString(this.passwordSecurity.phone);\r\n          const phoneRegex = /^1[3-9]\\d{9}$/;\r\n          if (!phoneRegex.test(phone)) {\r\n            this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·';\r\n            return;\r\n          }\r\n          url = apiConfig.passwordReset.smsReset;\r\n          payload.phone = phone;\r\n        } else {\r\n          const email = this.normalizeToString(this.passwordSecurity.email);\r\n          const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n          if (!emailRegex.test(email)) {\r\n            this.securityError = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±';\r\n            return;\r\n          }\r\n          url = apiConfig.email.resetPassword;\r\n          payload.email = email;\r\n        }\r\n\r\n        const res = await axios.post(url, payload, {\r\n          headers: { 'Content-Type': 'application/json' }\r\n        });\r\n\r\n        const data = res.data || {};\r\n        if (data.code === 1) {\r\n          this.securityMessage = data.msg || 'å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•';\r\n          this.passwordSecurity.code = '';\r\n          this.passwordSecurity.newPassword = '';\r\n          this.passwordSecurity.confirmPassword = '';\r\n        } else {\r\n          this.securityError = data.msg || 'å¯†ç ä¿®æ”¹å¤±è´¥';\r\n        }\r\n      } catch (error) {\r\n        console.error('å¯†ç ä¿®æ”¹å¤±è´¥:', error);\r\n        this.securityError = error.response?.data?.msg || 'å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.user-profile-view {\r\n  min-height: 100vh;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 30%, #90caf9 70%, #64b5f6 100%);\r\n  padding: 20px;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.profile-container {\r\n  width: 100%;\r\n  max-width: 800px;\r\n  position: relative;\r\n  z-index: 2;\r\n}\r\n\r\n.back-home {\r\n  position: absolute;\r\n  top: 20px;\r\n  left: 20px;\r\n  z-index: 3;\r\n}\r\n\r\n.back-link {\r\n  background: white;\r\n  color: #4b6cb7;\r\n  text-decoration: none;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  padding: 8px 16px;\r\n  border-radius: 0;\r\n  border: 2px solid #4b6cb7;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  transition: all 0.3s ease;\r\n  box-shadow: 0 3px 10px rgba(75, 108, 183, 0.15);\r\n}\r\n\r\n.back-link:hover {\r\n  background: #e3f2fd;\r\n  color: #182848;\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 5px 15px rgba(75, 108, 183, 0.25);\r\n}\r\n\r\n.back-icon {\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n}\r\n\r\n.profile-box {\r\n  background: white;\r\n  border-radius: 0;\r\n  padding: 50px;\r\n  box-shadow: 0 10px 40px rgba(75, 108, 183, 0.2);\r\n  border: 2px solid #4b6cb7;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.profile-header {\r\n  text-align: center;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.profile-header h1 {\r\n  color: #182848;\r\n  margin: 0 0 15px 0;\r\n  font-size: 36px;\r\n  font-weight: 900;\r\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);\r\n  letter-spacing: 0.5px;\r\n  position: relative;\r\n}\r\n\r\n.profile-header h1::after {\r\n  content: '';\r\n  position: absolute;\r\n  bottom: -8px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  width: 60px;\r\n  height: 3px;\r\n  background: linear-gradient(90deg, #4b6cb7, #182848);\r\n  border-radius: 0;\r\n}\r\n\r\n.subtitle {\r\n  color: #4b6cb7;\r\n  font-size: 16px;\r\n  margin: 0;\r\n}\r\n\r\n.profile-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 30px;\r\n}\r\n\r\n.membership-card {\r\n  background: linear-gradient(135deg, #f8fbff 0%, #eef4ff 100%);\r\n  border: 1px solid #d0ddff;\r\n  padding: 20px;\r\n}\r\n\r\n.membership-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.membership-title {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  font-weight: 700;\r\n  color: #182848;\r\n}\r\n\r\n.benefit-btn {\r\n  background: #182848;\r\n  color: #fff;\r\n  border: none;\r\n  padding: 8px 14px;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.benefit-btn:hover {\r\n  background: #0f1419;\r\n  transform: translateY(-1px);\r\n}\r\n\r\n.membership-summary {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.level-badge {\r\n  color: #fff;\r\n  padding: 6px 12px;\r\n  border-radius: 4px;\r\n  font-weight: 700;\r\n}\r\n\r\n.points-text, .discount-text {\r\n  color: #182848;\r\n  font-weight: 600;\r\n}\r\n\r\n.membership-progress .progress-track {\r\n  width: 100%;\r\n  height: 10px;\r\n  background: #e3e9ff;\r\n  border-radius: 5px;\r\n  overflow: hidden;\r\n}\r\n\r\n.membership-progress .progress-bar {\r\n  height: 100%;\r\n  border-radius: 5px;\r\n  transition: width 0.3s ease;\r\n}\r\n\r\n.progress-info, .next-level {\r\n  margin-top: 8px;\r\n  color: #182848;\r\n  font-weight: 600;\r\n}\r\n\r\n.benefit-modal-backdrop {\r\n  position: fixed;\r\n  inset: 0;\r\n  background: rgba(0,0,0,0.4);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 2000;\r\n}\r\n\r\n.benefit-modal {\r\n  background: #fff;\r\n  padding: 20px;\r\n  width: 360px;\r\n  border-radius: 6px;\r\n  box-shadow: 0 10px 30px rgba(0,0,0,0.2);\r\n}\r\n\r\n.benefit-modal h3 {\r\n  margin: 0 0 10px 0;\r\n  color: #182848;\r\n}\r\n\r\n.benefit-list {\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 0 0 12px 0;\r\n}\r\n\r\n.benefit-list li {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  padding: 6px 0;\r\n  border-bottom: 1px dashed #e0e0e0;\r\n  color: #182848;\r\n}\r\n\r\n.security-section {\r\n  background: linear-gradient(135deg, #f8fbff 0%, #eef4ff 100%);\r\n  border: 1px solid #d0ddff;\r\n  padding: 20px;\r\n}\r\n\r\n.security-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.security-title {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  font-weight: 700;\r\n  color: #182848;\r\n}\r\n\r\n.security-method-switch {\r\n  display: flex;\r\n  gap: 8px;\r\n}\r\n\r\n.security-method-switch button {\r\n  padding: 8px 16px;\r\n  border: 1px solid #bbdefb;\r\n  background: #fff;\r\n  color: #182848;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n  box-shadow: 0 2px 6px rgba(75, 108, 183, 0.12);\r\n}\r\n\r\n.security-method-switch button.active {\r\n  background: #4b6cb7;\r\n  color: #fff;\r\n  border-color: #4b6cb7;\r\n  box-shadow: 0 6px 16px rgba(75, 108, 183, 0.3);\r\n}\r\n\r\n.security-body .action-buttons {\r\n  justify-content: flex-start;\r\n}\r\n\r\n.security-body .form-group {\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.security-body .input-with-action {\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.security-body .verify-btn {\r\n  min-width: 110px;\r\n  background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);\r\n  color: #fff;\r\n  border: none;\r\n  padding: 12px 14px;\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.security-body .verify-btn:disabled {\r\n  background: #c5d7f2;\r\n  cursor: not-allowed;\r\n  color: #6b7a99;\r\n}\r\n\r\n.security-body .save-btn {\r\n  background: linear-gradient(135deg, #182848 0%, #4b6cb7 100%);\r\n  color: #fff;\r\n  border: none;\r\n  padding: 12px 18px;\r\n  box-shadow: 0 8px 20px rgba(24, 40, 72, 0.25);\r\n}\r\n\r\n.modal-close-btn {\r\n  width: 100%;\r\n  padding: 10px;\r\n  background: #182848;\r\n  color: white;\r\n  border: none;\r\n  cursor: pointer;\r\n}\r\n\r\n.avatar-section {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 30px;\r\n  padding: 30px;\r\n  background: linear-gradient(135deg, #f8fbff 0%, #e3f2fd 100%);\r\n  border: 2px solid #bbdefb;\r\n  border-radius: 0;\r\n}\r\n\r\n.avatar-wrapper {\r\n  position: relative;\r\n  width: 120px;\r\n  height: 120px;\r\n  border-radius: 0;\r\n  overflow: hidden;\r\n  border: 3px solid #4b6cb7;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.avatar-wrapper:hover {\r\n  transform: scale(1.05);\r\n  box-shadow: 0 8px 20px rgba(75, 108, 183, 0.3);\r\n}\r\n\r\n.avatar-img {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.avatar-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n.avatar-wrapper:hover .avatar-overlay {\r\n  opacity: 1;\r\n}\r\n\r\n.upload-label {\r\n  color: white;\r\n  cursor: pointer;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 5px;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n}\r\n\r\n.upload-icon {\r\n  font-size: 24px;\r\n}\r\n\r\n.avatar-info h2 {\r\n  color: #182848;\r\n  margin: 0 0 10px 0;\r\n  font-size: 28px;\r\n  font-weight: 700;\r\n}\r\n\r\n.user-role {\r\n  color: #4b6cb7;\r\n  margin: 0;\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n}\r\n\r\n.roles-container {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.student-badge {\r\n  background: #f44336;\r\n  color: white;\r\n  padding: 2px 8px;\r\n  border-radius: 4px;\r\n  font-size: 12px;\r\n  font-weight: bold;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n  box-shadow: 0 2px 4px rgba(244, 67, 54, 0.3);\r\n}\r\n\r\n.form-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n}\r\n\r\n.form-group label {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  color: #182848;\r\n  font-weight: 600;\r\n  font-size: 14px;\r\n}\r\n\r\n.label-icon {\r\n  font-size: 16px;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  padding: 14px;\r\n  border: 2px solid #bbdefb;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  background: #f8fbff;\r\n  color: #333;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.form-input:hover:not(:disabled) {\r\n  border-color: #90caf9;\r\n  background: #fff;\r\n}\r\n\r\n.form-input:focus:not(:disabled) {\r\n  outline: none;\r\n  border-color: #4b6cb7;\r\n  background: white;\r\n  box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);\r\n}\r\n\r\n.form-input:disabled {\r\n  background: #f5f5f5;\r\n  color: #999;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.input-wrapper-with-hint {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 5px;\r\n}\r\n\r\n.field-hint {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 5px;\r\n  font-size: 12px;\r\n  color: #ff9800;\r\n  padding: 5px 10px;\r\n  background: #fff3e0;\r\n  border: 1px solid #ffb74d;\r\n  border-radius: 0;\r\n}\r\n\r\n.hint-icon {\r\n  font-size: 14px;\r\n}\r\n\r\n.hint-text {\r\n  font-weight: 500;\r\n}\r\n\r\n.input-with-action {\r\n  display: flex;\r\n  gap: 10px;\r\n  align-items: center;\r\n}\r\n\r\n.verify-btn {\r\n  background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);\r\n  color: white;\r\n  border: none;\r\n  padding: 12px 20px;\r\n  border-radius: 0;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  white-space: nowrap;\r\n}\r\n\r\n.verify-btn:hover {\r\n  background: linear-gradient(135deg, #182848 0%, #0f1419 100%);\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.action-buttons {\r\n  display: flex;\r\n  gap: 15px;\r\n  margin-top: 20px;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.edit-btn,\r\n.save-btn,\r\n.cancel-btn,\r\n.change-password-btn {\r\n  padding: 14px 28px;\r\n  border: none;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.edit-btn {\r\n  background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);\r\n  color: white;\r\n}\r\n\r\n.edit-btn:hover {\r\n  background: linear-gradient(135deg, #182848 0%, #0f1419 100%);\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(75, 108, 183, 0.3);\r\n}\r\n\r\n.save-btn {\r\n  background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);\r\n  color: white;\r\n}\r\n\r\n.save-btn:hover:not(:disabled) {\r\n  background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);\r\n}\r\n\r\n.save-btn:disabled {\r\n  background: #ccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.cancel-btn {\r\n  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);\r\n  color: white;\r\n}\r\n\r\n.cancel-btn:hover:not(:disabled) {\r\n  background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);\r\n}\r\n\r\n.change-password-btn {\r\n  background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);\r\n  color: white;\r\n}\r\n\r\n.change-password-btn:hover {\r\n  background: linear-gradient(135deg, #f57c00 0%, #e65100 100%);\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);\r\n}\r\n\r\n.edit-actions {\r\n  display: flex;\r\n  gap: 15px;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.btn-icon {\r\n  font-size: 18px;\r\n}\r\n\r\n.error-message {\r\n  color: #f44336;\r\n  font-size: 14px;\r\n  margin-top: 10px;\r\n  padding: 10px;\r\n  background: #ffebee;\r\n  border: 1px solid #f44336;\r\n  border-radius: 0;\r\n}\r\n\r\n.success-message {\r\n  color: #4caf50;\r\n  font-size: 14px;\r\n  margin-top: 10px;\r\n  padding: 10px;\r\n  background: #e8f5e9;\r\n  border: 1px solid #4caf50;\r\n  border-radius: 0;\r\n}\r\n\r\n/* å“åº”å¼è®¾è®¡ */\r\n@media (max-width: 768px) {\r\n  .profile-box {\r\n    padding: 30px;\r\n  }\r\n\r\n  .avatar-section {\r\n    flex-direction: column;\r\n    text-align: center;\r\n  }\r\n\r\n  .action-buttons {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .edit-btn,\r\n  .save-btn,\r\n  .cancel-btn,\r\n  .change-password-btn {\r\n    width: 100%;\r\n    justify-content: center;\r\n  }\r\n}\r\n</style>\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}