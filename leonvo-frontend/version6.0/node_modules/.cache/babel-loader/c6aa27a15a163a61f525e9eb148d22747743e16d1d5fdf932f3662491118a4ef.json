{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport axios from 'axios';\nimport apiConfig from '@/config/api.config';\nexport default {\n  name: 'BusinessOrders',\n  data() {\n    return {\n      loading: false,\n      searchKeyword: '',\n      statusFilter: 'all',\n      dateRange: 'all',\n      currentPage: 1,\n      pageSize: 10,\n      orders: [],\n      orderStats: {\n        pending: 0,\n        shipped: 0,\n        completed: 0,\n        total: 0\n      },\n      selectedOrder: null,\n      showShipModal: false,\n      shipmentOrder: null,\n      shipment: {\n        courier: '',\n        tracking_number: ''\n      }\n    };\n  },\n  computed: {\n    filteredOrders() {\n      let filtered = [...this.orders];\n      if (this.searchKeyword) {\n        const keyword = this.searchKeyword.toLowerCase();\n        filtered = filtered.filter(order => order.oid && order.oid.toString().includes(keyword) || order.receiver_name && order.receiver_name.toLowerCase().includes(keyword) || order.receiver_phone && order.receiver_phone.includes(keyword) || order.items && order.items.some(item => item.name && item.name.toLowerCase().includes(keyword)));\n      }\n      if (this.statusFilter !== 'all') {\n        filtered = filtered.filter(order => order.status.toString() === this.statusFilter);\n      }\n      if (this.dateRange !== 'all') {\n        const now = new Date();\n        let startDate;\n        switch (this.dateRange) {\n          case 'today':\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n            break;\n          case 'week':\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);\n            break;\n          case 'month':\n            startDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());\n            break;\n        }\n        filtered = filtered.filter(order => {\n          const orderDate = new Date(order.order_time);\n          return orderDate >= startDate;\n        });\n      }\n      filtered.sort((a, b) => new Date(b.order_time) - new Date(a.order_time));\n      return filtered;\n    },\n    paginatedOrders() {\n      const start = (this.currentPage - 1) * this.pageSize;\n      const end = start + this.pageSize;\n      return this.filteredOrders.slice(start, end);\n    },\n    totalPages() {\n      return Math.ceil(this.filteredOrders.length / this.pageSize);\n    }\n  },\n  mounted() {\n    this.loadOrders();\n  },\n  methods: {\n    formatDate(dateString) {\n      if (!dateString) return '';\n      try {\n        const date = new Date(dateString);\n        return date.toLocaleDateString('zh-CN');\n      } catch (e) {\n        return dateString;\n      }\n    },\n    formatDateTime(dateString) {\n      if (!dateString) return '';\n      try {\n        const date = new Date(dateString);\n        return date.toLocaleString('zh-CN', {\n          year: 'numeric',\n          month: '2-digit',\n          day: '2-digit',\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n      } catch (e) {\n        return dateString;\n      }\n    },\n    getStatusClass(status) {\n      const statusMap = {\n        0: 'pending',\n        1: 'shipped',\n        2: 'completed',\n        3: 'cancelled',\n        4: 'cancelled'\n      };\n      return statusMap[status] || 'pending';\n    },\n    getStatusText(status) {\n      const statusMap = {\n        0: 'å¾…å‘è´§',\n        1: 'å·²å‘è´§',\n        2: 'å·²æ”¶è´§',\n        3: 'å·²å–æ¶ˆ',\n        4: 'å·²å–æ¶ˆ'\n      };\n      return statusMap[status] || 'æœªçŸ¥çŠ¶æ€';\n    },\n    // è·å–å•†å®¶IDçš„ç»Ÿä¸€æ–¹æ³•\n    getBusinessId() {\n      const businessInfo = JSON.parse(localStorage.getItem('businessInfo'));\n      if (!businessInfo) return null;\n      return businessInfo.bid || businessInfo.id;\n    },\n    async loadOrders() {\n      this.loading = true;\n      const bid = this.getBusinessId();\n      if (!bid) {\n        console.error('æœªæ‰¾åˆ°å•†å®¶ä¿¡æ¯');\n        this.orders = [];\n        return;\n      }\n      try {\n        // 1. å…ˆè·å–å•†å“åˆ—è¡¨ï¼Œå»ºç«‹æ˜ å°„è¡¨\n        const productsResponse = await axios.get(apiConfig.business.getProducts(bid));\n        const productMap = {};\n        if (productsResponse.data.code === 1) {\n          const products = productsResponse.data.data || [];\n          products.forEach(p => {\n            if (p.pid) productMap[p.pid] = p;\n          });\n        }\n\n        // 2. è·å–è®¢å•æ•°æ®\n        const response = await axios.get(apiConfig.business.getOrders(bid));\n        console.log('APIè¿”å›çš„è®¢å•æ•°æ®:', response.data.data);\n        if (response.data.code === 1) {\n          const orders = response.data.data || [];\n\n          // æ”¶é›†éœ€è¦è¡¥å…¨ä¿¡æ¯çš„è®¢å•Promise\n          const detailPromises = [];\n          console.log('Product Map Keys:', Object.keys(productMap));\n\n          // åˆæ­¥è§„èŒƒåŒ–ï¼Œå¹¶æ ‡è®°éœ€è¦è¡¥å…¨çš„è®¢å•\n          const normalizedOrders = this.normalizeOrdersData(orders).map(order => {\n            // è¿‡æ»¤ï¼šåªä¿ç•™å±äºå½“å‰å•†å®¶çš„è®¢å•é¡¹\n            // ç­–ç•¥ï¼šä½¿ç”¨ productMap (å½“å‰å•†å®¶çš„å•†å“åˆ—è¡¨) æ¥éªŒè¯\n            if (order.items && order.items.length > 0) {\n              const originalCount = order.items.length;\n              order.items = order.items.filter(item => {\n                // è°ƒè¯•ï¼šæ‰“å°åŒ¹é…è¿‡ç¨‹\n                const itemId = item.id || item.pid;\n                const match = productMap[itemId] || productMap[String(itemId)] || productMap[Number(itemId)];\n                // console.log(`Item ID: ${itemId}, Match: ${!!match}`);\n\n                // æš‚æ—¶æ”¾å®½ï¼šå¦‚æœåŒ¹é…æˆåŠŸï¼Œæˆ–è€…æ˜¯æ–°ç”Ÿæˆçš„è®¢å•ï¼ˆæˆ‘ä»¬å‡è®¾æ–°è®¢å•æ•°æ®æ˜¯å¯¹çš„ï¼‰ï¼Œæˆ–è€… productMap ä¸ºç©º\n                // ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å…ˆåªåœ¨æ§åˆ¶å°è­¦å‘Šï¼Œä¸å®é™…åˆ é™¤ï¼Œçœ‹çœ‹æ—¥å¿—\n                return match || Object.keys(productMap).length === 0;\n              });\n              if (order.items.length < originalCount) {\n                console.log(`è®¢å• ${order.oid || order.id} è¿‡æ»¤äº† ${originalCount - order.items.length} ä¸ªéæœ¬å•†å®¶å•†å“`);\n              }\n            }\n\n            // å¦‚æœè¿‡æ»¤åæ²¡æœ‰å•†å“äº†ï¼Œè¯´æ˜è¿™ä¸ªè®¢å•å¯èƒ½å…¨æ˜¯åˆ«äººçš„\n            // æš‚æ—¶æ³¨é‡Šæ‰éšè—é€»è¾‘ï¼Œé˜²æ­¢è¯¯æ€\n            // if (order.items.length === 0) return null;\n\n            // å°è¯•åˆ©ç”¨æœ¬åœ°å•†å“åˆ—è¡¨è¡¥å…¨ä¿¡æ¯\n            if (order.items && order.items.length > 0) {\n              order.items.forEach(item => {\n                // å¦‚æœæ˜¯é»˜è®¤å•†å“ï¼Œå°è¯•é€šè¿‡ PID è¡¥å…¨\n                if ((!item.name || item.name === 'é»˜è®¤å•†å“' || item.name === 'å•†å“') && productMap[item.id]) {\n                  item.name = productMap[item.id].name;\n                }\n              });\n            }\n\n            // å¦‚æœä¾ç„¶æ²¡æœ‰æœ‰æ•ˆå•†å“åï¼ŒåŠ å…¥è¡¥å…¨é˜Ÿåˆ—\n            const hasValidName = order.items && order.items.some(i => i.name && i.name !== 'é»˜è®¤å•†å“' && i.name !== 'å•†å“');\n            if (!hasValidName && (order.oid || order.id)) {\n              const oid = order.oid || order.id;\n              detailPromises.push(axios.get(apiConfig.order.getOrderDetail(oid)).then(res => {\n                if (res.data.code === 1 && res.data.data) {\n                  const detail = res.data.data;\n                  let name = '';\n                  if (detail.items && detail.items.length) name = detail.items[0].name;else if (detail.product_name) name = detail.product_name;\n                  if (name) {\n                    // æ›´æ–°å½“å‰è®¢å•å¯¹è±¡çš„ items\n                    if (!order.items || !order.items.length) {\n                      order.items = [{\n                        name: name,\n                        quantity: 1\n                      }];\n                    } else {\n                      order.items[0].name = name;\n                    }\n                  }\n                }\n              }).catch(e => console.warn(`è¡¥å…¨è®¢å• ${oid} è¯¦æƒ…å¤±è´¥`, e)));\n            }\n            return order;\n          });\n\n          // ç­‰å¾…è¡¥å…¨å®Œæˆï¼ˆä¸é˜»å¡UIæ˜¾ç¤ºï¼Œè®©å®ƒæ…¢æ…¢å˜å‡ºæ¥ï¼Œæˆ–è€…ä½¿ç”¨awaité˜»å¡ä¸€ä¸‹ä¹Ÿè¡Œï¼‰\n          // è¿™é‡Œé€‰æ‹©ä¸é˜»å¡ï¼Œåˆ©ç”¨Vueçš„å“åº”å¼è‡ªåŠ¨æ›´æ–°è§†å›¾\n          if (detailPromises.length > 0) {\n            console.log(`æ­£åœ¨è¡¥å…¨ ${detailPromises.length} ä¸ªè®¢å•çš„å•†å“ä¿¡æ¯...`);\n            Promise.allSettled(detailPromises).then(() => {\n              console.log('è®¢å•è¯¦æƒ…è¡¥å…¨å®Œæˆ');\n              // å¼ºåˆ¶åˆ·æ–°ä¸€ä¸‹ï¼ˆè™½ç„¶Vueå¯¹è±¡å±æ€§ä¿®æ”¹åº”è¯¥æ˜¯å“åº”å¼çš„ï¼Œä½†ä¸ºäº†ä¿é™©ï¼‰\n              this.orders = [...this.orders];\n            });\n          }\n\n          // 3. åœ¨è¯¦æƒ…è¡¥å…¨åï¼Œå†æ¬¡æ£€æŸ¥å¹¶ä¿®æ­£å•ä»·ä¸º0çš„æƒ…å†µ\n          this.orders.forEach(order => {\n            if (order.items && order.items.length > 0) {\n              order.items.forEach(item => {\n                // å¦‚æœå•ä»·ä¸º0ï¼Œå°è¯•ä¿®æ­£\n                if (!item.price || parseFloat(item.price) === 0) {\n                  // ç­–ç•¥1ï¼šå¦‚æœæ˜¯å•å•†å“è®¢å•ï¼Œä¸”è®¢å•æ€»é‡‘é¢å­˜åœ¨ï¼Œç”¨æ€»é‡‘é¢é™¤ä»¥æ•°é‡\n                  if (order.items.length === 1 && order.amount > 0) {\n                    item.price = (order.amount / item.quantity).toFixed(2);\n                  }\n                  // ç­–ç•¥2ï¼šä»å•†å“åˆ—è¡¨æŸ¥æ‰¾å½“å‰ä»·æ ¼ä½œä¸ºå…œåº•\n                  else if (productMap[item.id]) {\n                    item.price = productMap[item.id].price;\n                  }\n                }\n                // é‡æ–°è®¡ç®—å°è®¡\n                item.subtotal = (item.price * item.quantity).toFixed(2);\n              });\n            }\n          });\n\n          // è¿‡æ»¤æ‰æ²¡æœ‰å±äºå½“å‰å•†å®¶å•†å“çš„è®¢å•\n          // æš‚æ—¶å–æ¶ˆè¿‡æ»¤ï¼Œé˜²æ­¢è¯¯æ€\n          // const validOrders = normalizedOrders.filter(order => order.items && order.items.length > 0);\n          const validOrders = normalizedOrders.filter(order => order);\n          console.log('è§„èŒƒåŒ–å¹¶è¿‡æ»¤åçš„è®¢å•æ•°æ®:', validOrders);\n          this.orders = validOrders;\n          this.calculateStats();\n        } else {\n          console.warn('è·å–è®¢å•å¤±è´¥:', response.data.message);\n          this.orders = [];\n        }\n      } catch (error) {\n        console.error('åŠ è½½è®¢å•æ•°æ®å¤±è´¥:', error);\n        // ... (ä¿æŒåŸæœ‰å¤‡ç”¨æ–¹æ¡ˆé€»è¾‘)\n        this.orders = [];\n      } finally {\n        this.loading = false;\n      }\n    },\n    // è§„èŒƒåŒ–è®¢å•æ•°æ®ï¼Œå¤„ç†ä¸åŒå­—æ®µå\n    normalizeOrdersData(orders) {\n      console.log('æ‰€æœ‰è®¢å•åŸå§‹æ•°æ®:', orders);\n      return orders.map(order => {\n        console.log('å•ä¸ªè®¢å•åŸå§‹æ•°æ®:', order);\n        // é’ˆå¯¹è®¢å•#4æ·»åŠ ç‰¹åˆ«è°ƒè¯•\n        if (order.id === 4 || order.oid === 4 || order.oid === '#4') {\n          console.log('=== è®¢å•#4è¯¦ç»†æ•°æ®ç»“æ„ ===');\n          console.log('è®¢å•å®Œæ•´å¯¹è±¡:', JSON.stringify(order, null, 2));\n          console.log('è®¢å•æ‰€æœ‰é”®:', Object.keys(order));\n          // æ£€æŸ¥å„ç§å¯èƒ½çš„å•†å“æ•°æ®ä½ç½®\n          console.log('order.items:', order.items);\n          console.log('order.products:', order.products);\n          console.log('order.product:', order.product);\n          console.log('order.goods:', order.goods);\n          console.log('order.productId:', order.productId);\n          console.log('order.goodsId:', order.goodsId);\n        }\n        // è§„èŒƒåŒ–æ”¶è´§äººä¿¡æ¯\n        const receiverName = order.receiver_name || order.receiverName || order.receiver || '';\n        const receiverPhone = order.receiver_phone || order.receiverPhone || order.phone || '';\n        const receiverAddress = order.receiver_address || order.receiverAddress || order.address || '';\n\n        // è§„èŒƒåŒ–è®¢å•å·\n        const orderId = order.oid || order.id || '';\n\n        // è§„èŒƒåŒ–è®¢å•é‡‘é¢\n        const amount = order.amount || order.total || 0;\n\n        // è§„èŒƒåŒ–ä¸‹å•æ—¶é—´ - æ›´å¥å£®çš„å¤„ç†\n        let orderTime = order.order_time || order.createdAt || order.createTime || order.orderTime || order.time || order.timestamp || '';\n\n        // å¦‚æœæ—¶é—´æ˜¯æ•°å­—ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²\n        if (typeof orderTime === 'number') {\n          orderTime = new Date(orderTime).toISOString();\n        }\n\n        // ç¡®ä¿æ—¶é—´å­—ç¬¦ä¸²æœ‰å€¼\n        if (!orderTime) {\n          // å¦‚æœæ²¡æœ‰æ—¶é—´ï¼Œä½¿ç”¨å½“å‰æ—¶é—´ï¼ˆä½œä¸ºé»˜è®¤å€¼ï¼‰\n          orderTime = new Date().toISOString();\n        }\n\n        // è§„èŒƒåŒ–è®¢å•çŠ¶æ€\n        const status = order.status !== undefined ? order.status : 0;\n\n        // è§„èŒƒåŒ–å•†å“é¡¹ - æ”¯æŒå¤šç§æ•°æ®æ¥æº\n        let items = [];\n        // æ£€æŸ¥å„ç§å¯èƒ½çš„å•†å“æ•°æ®ä½ç½®\n        if (Array.isArray(order.items)) {\n          items = order.items;\n        } else if (Array.isArray(order.products)) {\n          items = order.products;\n        } else if (Array.isArray(order.orderItems)) {\n          // æ”¯æŒorderItemså­—æ®µï¼ˆè®¢å•é¡¹ï¼‰\n          items = order.orderItems;\n        } else if (Array.isArray(order.order_items)) {\n          // æ”¯æŒorder_itemså­—æ®µ\n          items = order.order_items;\n        } else if (order.product && typeof order.product === 'object') {\n          // å¤„ç†å•ä¸ªå•†å“å¯¹è±¡çš„æƒ…å†µ\n          items = [order.product];\n        } else if (order.goods && Array.isArray(order.goods)) {\n          items = order.goods;\n        } else if (order.goods && typeof order.goods === 'object') {\n          // å¤„ç†å•ä¸ªgoodså¯¹è±¡çš„æƒ…å†µ\n          items = [order.goods];\n        } else if (order.orderItem && Array.isArray(order.orderItem)) {\n          // æ”¯æŒorderItemæ•°ç»„\n          items = order.orderItem;\n        } else if (order.orderItem && typeof order.orderItem === 'object') {\n          // æ”¯æŒå•ä¸ªorderItemå¯¹è±¡\n          items = [order.orderItem];\n        } else {\n          // å¤„ç†è®¢å•å¯¹è±¡ç›´æ¥åŒ…å«å•†å“å­—æ®µçš„æƒ…å†µï¼ˆå¸¸è§äºå•å•†å“è®¢å•ï¼‰\n          const hasProductFields = order.product_id || order.product_name || order.product_price || order.goods_id || order.goods_name || order.goods_price || order.productId || order.productName || order.productPrice;\n          if (hasProductFields) {\n            // ä»è®¢å•å¯¹è±¡ç›´æ¥æå–å•†å“ä¿¡æ¯\n            items = [{\n              ...order\n            }];\n          }\n        }\n\n        // å¤„ç†å•†å“é¡¹\n        const normalizedItems = items.map(item => {\n          if (!item || typeof item !== 'object') {\n            // å¦‚æœå•†å“é¡¹ä¸æ˜¯å¯¹è±¡ï¼Œè¿”å›é»˜è®¤å€¼\n            return {\n              id: '',\n              name: 'æœªçŸ¥å•†å“',\n              model: '',\n              price: 0,\n              quantity: 1,\n              subtotal: 0\n            };\n          }\n          return {\n            id: item.id || item.product_id || item.goods_id || item.productId || item.goodsId || '',\n            bid: item.bid,\n            // ç¡®ä¿ä¿ç•™ bid å­—æ®µç”¨äºè¿‡æ»¤\n            name: item.name || item.product_name || item.goods_name || item.productName || item.goodsName || item.product || item.product_title || 'æœªçŸ¥å•†å“',\n            model: item.model || item.specs || item.attributes || item.spec || item.product_model || item.goods_spec || '',\n            price: parseFloat(item.price || item.unit_price || item.amount || item.product_price || item.goods_price || item.productPrice || item.goodsPrice || (amount > 0 && items.length === 1 ? amount / (item.quantity || 1) : 0)),\n            quantity: parseInt(item.quantity || item.count || item.num || item.product_num || item.goods_num || 1),\n            subtotal: parseFloat(item.subtotal || item.price * item.quantity || item.unit_price * item.quantity || 0)\n          };\n        });\n\n        // å¦‚æœæ²¡æœ‰å•†å“é¡¹ï¼Œåˆ›å»ºä¸€ä¸ªé»˜è®¤å•†å“é¡¹\n        if (normalizedItems.length === 0) {\n          normalizedItems.push({\n            id: '',\n            name: 'é»˜è®¤å•†å“',\n            model: '',\n            price: 0,\n            quantity: 1,\n            subtotal: 0\n          });\n        }\n        return {\n          ...order,\n          oid: orderId,\n          receiver_name: receiverName,\n          receiver_phone: receiverPhone,\n          receiver_address: receiverAddress,\n          amount: amount,\n          order_time: orderTime,\n          status: status,\n          items: normalizedItems\n        };\n      });\n    },\n    calculateStats() {\n      const stats = {\n        pending: 0,\n        shipped: 0,\n        completed: 0,\n        total: 0\n      };\n      this.orders.forEach(order => {\n        if (order.status === 0) stats.pending++;\n        if (order.status === 1) stats.shipped++;\n        if (order.status === 2) stats.completed++;\n        stats.total++;\n      });\n      this.orderStats = stats;\n    },\n    shipOrder(order) {\n      this.shipmentOrder = order;\n      this.shipment = {\n        courier: '',\n        tracking_number: '',\n        note: ''\n      };\n      this.showShipModal = true;\n    },\n    async confirmShipment() {\n      if (!this.validateShipment()) {\n        return;\n      }\n      try {\n        const oid = parseInt(this.shipmentOrder.oid, 10);\n        const url = apiConfig.order.shipOrderCommon(oid);\n        const payload = {\n          // å…¼å®¹åç«¯ RequestBody OrderLogistics\n          logisticsCompany: this.shipment.courier,\n          trackingNumber: this.shipment.tracking_number,\n          // å…¼å®¹ç›´æ¥å­—æ®µ\n          courier: this.shipment.courier\n        };\n        const response = await axios.put(url, payload, {\n          params: {\n            courier: this.shipment.courier,\n            trackingNumber: this.shipment.tracking_number,\n            tracking_number: this.shipment.tracking_number\n          }\n        });\n        if (response.data.code === 1) {\n          this.shipmentOrder.status = 1;\n          this.shipmentOrder.courier = this.shipment.courier;\n          this.shipmentOrder.tracking_number = this.shipment.tracking_number;\n          this.showShipModal = false;\n          this.calculateStats();\n          alert('å‘è´§æˆåŠŸï¼');\n        } else {\n          const finalErrorMsg = response.data.message || response.data.msg || 'å‘è´§å¤±è´¥';\n          alert(finalErrorMsg);\n        }\n      } catch (error) {\n        console.error('å‘è´§è¯·æ±‚å¼‚å¸¸:', error);\n        alert('å‘è´§è¯·æ±‚å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ§åˆ¶å°æ—¥å¿—');\n      }\n    },\n    validateShipment() {\n      if (!this.shipment.courier.trim()) {\n        alert('è¯·é€‰æ‹©ç‰©æµå…¬å¸');\n        return false;\n      }\n      if (!this.shipment.tracking_number.trim()) {\n        alert('è¯·è¾“å…¥è¿å•å·');\n        return false;\n      }\n      return true;\n    },\n    viewTracking(order) {\n      const oid = order.oid || order.id;\n      if (!oid) {\n        alert('æœªæ‰¾åˆ°è®¢å•å·');\n        return;\n      }\n      axios.get(apiConfig.order.getOrderLogistics(oid)).then(res => {\n        if (res.data && res.data.code === 1 && res.data.data) {\n          const logi = res.data.data;\n          const company = logi.logistics_company || logi.logisticsCompany || logi.courier || 'æœªè®¾ç½®';\n          const tracking = logi.tracking_number || logi.trackingNumber || 'æœªè®¾ç½®';\n          const created = logi.created_time || logi.createdTime || '';\n          const updated = logi.updated_time || logi.updatedTime || '';\n          alert(`è®¢å• #${oid}\\nç‰©æµå…¬å¸ï¼š${company}\\nè¿å•å·ï¼š${tracking}\\nåˆ›å»ºï¼š${this.formatDateTime(created)}\\næ›´æ–°ï¼š${this.formatDateTime(updated)}`);\n        } else {\n          alert(`è®¢å• #${oid} æš‚æ— ç‰©æµä¿¡æ¯`);\n        }\n      }).catch(() => {\n        alert(`è®¢å• #${oid} æš‚æ— ç‰©æµä¿¡æ¯`);\n      });\n    },\n    async viewFeedback(order) {\n      if (!order.uid || !order.items) {\n        alert('æš‚æ— è¯„ä»·ä¿¡æ¯');\n        return;\n      }\n      const uid = order.uid;\n      const messages = [];\n      for (const item of order.items) {\n        const pid = item.id || item.pid;\n        if (!pid) continue;\n        try {\n          const res = await axios.get(apiConfig.feedback.getUserFeedback(uid, pid));\n          if (res.data && res.data.code === 1 && res.data.data) {\n            const fb = res.data.data;\n            messages.push(`${item.name || 'å•†å“'}ï¼š${fb.star || 0}æ˜Ÿï¼Œ${fb.comment || 'æ— è¯„è®º'}`);\n          }\n        } catch (e) {\n          // ignore\n        }\n      }\n      if (messages.length === 0) {\n        alert('ç”¨æˆ·å°šæœªè¯„ä»·æˆ–æœªæŸ¥è¯¢åˆ°è¯„ä»·');\n      } else {\n        alert(messages.join('\\n'));\n      }\n    },\n    cancelOrder(order) {\n      if (confirm(`ç¡®å®šè¦å–æ¶ˆè®¢å• #${order.oid} å—ï¼Ÿ`)) {\n        this.cancelOrderAsync(order);\n      }\n    },\n    async cancelOrderAsync(order) {\n      const bid = this.getBusinessId();\n      if (!bid) {\n        alert('å•†å®¶ä¿¡æ¯ä¸å®Œæ•´');\n        return;\n      }\n      try {\n        // æ³¨æ„ï¼šæ–‡æ¡£ä¸­åªæœ‰ç”¨æˆ·å–æ¶ˆè®¢å•çš„APIï¼Œæ²¡æœ‰å•†å®¶å–æ¶ˆè®¢å•çš„API\n        // è¿™é‡Œå¯èƒ½éœ€è¦è°ƒç”¨ç”¨æˆ·å–æ¶ˆè®¢å•çš„APIï¼Œæˆ–è€…åœ¨å‰ç«¯ç›´æ¥æ›´æ–°çŠ¶æ€\n        const response = await axios.put(`/api/orders/${order.oid}/cancel?uid=${order.uid}`);\n        if (response.data.code === 1) {\n          order.status = 4; // å•†å®¶å–æ¶ˆè®¾ç½®ä¸º4\n          this.calculateStats();\n          alert('è®¢å•å·²å–æ¶ˆ');\n        } else {\n          alert(`å–æ¶ˆå¤±è´¥ï¼š${response.data.message}`);\n        }\n      } catch (error) {\n        console.error('å–æ¶ˆè®¢å•å¤±è´¥:', error);\n        alert('å–æ¶ˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\n      }\n    },\n    // æå–ä»·æ ¼ä¿®å¤é€»è¾‘\n    fixOrderPrices(order) {\n      if (!order.items || order.items.length === 0) return;\n\n      // å°è¯•è·å–æœ¬åœ°å•†å“æ˜ å°„è¡¨ï¼ˆå¦‚æœå·²ç»åŠ è½½ï¼‰\n      // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå› ä¸ºåœ¨ methods ä¸­å¾ˆéš¾ç›´æ¥è®¿é—® loadOrders å†…éƒ¨çš„ productMap\n      // ä½†æˆ‘ä»¬å¯ä»¥å°è¯•ä» localStorage æˆ– store è·å–ï¼Œæˆ–è€…ç®€å•åœ°åªç”¨ total amount å€’æ¨\n\n      order.items.forEach(item => {\n        // è§„èŒƒåŒ–å­—æ®µ\n        if (!item.price) item.price = item.unit_price || item.productPrice || 0;\n\n        // å¦‚æœå•ä»·ä¸º0ï¼Œå°è¯•ä¿®æ­£\n        if (parseFloat(item.price) === 0) {\n          // ç­–ç•¥1ï¼šå¦‚æœæ˜¯å•å•†å“è®¢å•ï¼Œä¸”è®¢å•æ€»é‡‘é¢å­˜åœ¨ï¼Œç”¨æ€»é‡‘é¢é™¤ä»¥æ•°é‡\n          if (order.items.length === 1 && order.amount > 0) {\n            item.price = (order.amount / (item.quantity || 1)).toFixed(2);\n          }\n          // ç­–ç•¥2ï¼šå¦‚æœ item æœ‰ subtotal ä¸”ä¸ä¸º 0\n          else if (item.subtotal && parseFloat(item.subtotal) > 0) {\n            item.price = (item.subtotal / (item.quantity || 1)).toFixed(2);\n          }\n        }\n\n        // ç¡®ä¿ quantity å­˜åœ¨\n        item.quantity = item.quantity || 1;\n\n        // é‡æ–°è®¡ç®—å°è®¡\n        item.subtotal = (item.price * item.quantity).toFixed(2);\n      });\n\n      // å¦‚æœæ€»é‡‘é¢ä¸º0ï¼Œå°è¯•ç´¯åŠ å­é¡¹\n      if (parseFloat(order.amount) === 0) {\n        order.amount = order.items.reduce((sum, item) => sum + parseFloat(item.subtotal), 0).toFixed(2);\n      }\n    },\n    async viewOrderDetail(order) {\n      // 1. å…ˆç”¨åˆ—è¡¨ä¸­çš„æ•°æ®æ¸²æŸ“\n      this.selectedOrder = {\n        ...order\n      };\n      // ç«‹å³å°è¯•ä¿®å¤ä¸€æ¬¡ä»·æ ¼ï¼ˆä½¿ç”¨åˆ—è¡¨æ•°æ®ï¼‰\n      this.fixOrderPrices(this.selectedOrder);\n      const oid = order.oid || order.id;\n      if (!oid) return;\n      try {\n        console.log(`æ­£åœ¨è·å–è®¢å• #${oid} çš„è¯¦ç»†ä¿¡æ¯(å«ç‰©æµ)...`);\n        // 2. å°è¯•ä»åç«¯è·å–æœ€æ–°è¯¦æƒ…\n        const response = await axios.get(apiConfig.order.getOrderDetail(oid));\n        if (response.data.code === 1 && response.data.data) {\n          const detail = response.data.data;\n          console.log('è®¢å•è¯¦æƒ…APIè¿”å›:', detail);\n\n          // 3. æ™ºèƒ½åˆå¹¶ç‰©æµä¿¡æ¯\n          // åç«¯å¯èƒ½ç›´æ¥è¿”å›åœ¨å¯¹è±¡ä¸Šï¼Œæˆ–è€…åœ¨ logistics å­—æ®µä¸­ï¼Œæˆ–è€…åœ¨ orderLogistics å­—æ®µä¸­\n          const logisticsSource = detail.logistics || detail.orderLogistics || detail;\n          if (logisticsSource) {\n            // æå–ç‰©æµå…¬å¸\n            const company = logisticsSource.logistics_company || logisticsSource.logisticsCompany || logisticsSource.courier || logisticsSource.company;\n            if (company) {\n              this.selectedOrder.courier = company;\n              this.selectedOrder.logistics_company = company;\n            }\n\n            // æå–è¿å•å·\n            const tracking = logisticsSource.tracking_number || logisticsSource.trackingNumber || logisticsSource.number || logisticsSource.tracking;\n            if (tracking) {\n              this.selectedOrder.tracking_number = tracking;\n              this.selectedOrder.trackingNumber = tracking;\n            }\n\n            // æå–å‘è´§æ—¶é—´\n            const shipTime = logisticsSource.ship_time || logisticsSource.shipTime || logisticsSource.create_time || logisticsSource.createTime;\n            if (shipTime) {\n              this.selectedOrder.ship_time = shipTime;\n            }\n          }\n\n          // 4. å¦‚æœè¯¦æƒ…é‡Œæœ‰ itemsï¼Œåˆå¹¶ items (å¯èƒ½åŒ…å«æ›´è¯¦ç»†çš„å•†å“ä¿¡æ¯)\n          if (detail.items && detail.items.length > 0) {\n            // ç®€å•çš„åˆå¹¶ç­–ç•¥ï¼šå¦‚æœæ•°é‡ä¸€è‡´ï¼Œå°è¯•ä¿ç•™è¯¦æƒ…é‡Œçš„é¢å¤–å­—æ®µ\n            // è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ name å’Œ price\n            // ä¸ºé˜²æ­¢è¯¦æƒ…é‡Œçš„ price ä¹Ÿæ˜¯ 0ï¼Œæˆ‘ä»¬å…ˆåˆå¹¶ï¼Œå†è¿è¡Œ fixOrderPrices\n\n            // è§„èŒƒåŒ–è¯¦æƒ…é‡Œçš„ items\n            const detailItems = this.normalizeOrdersData([{\n              ...detail,\n              items: detail.items\n            }])[0].items;\n            this.selectedOrder.items = detailItems;\n          }\n\n          // 5. å†æ¬¡ä¿®å¤ä»·æ ¼\n          this.fixOrderPrices(this.selectedOrder);\n\n          // å¼ºåˆ¶æ›´æ–°è§†å›¾\n          this.selectedOrder = {\n            ...this.selectedOrder\n          };\n        }\n      } catch (e) {\n        console.warn('è·å–è®¢å•è¯¦æƒ…å¤±è´¥ï¼Œå°†ä»…æ˜¾ç¤ºåˆ—è¡¨æ•°æ®:', e);\n      }\n    },\n    exportOrders() {\n      // è¿™é‡Œå¯ä»¥å®ç°å¯¼å‡ºåŠŸèƒ½\n      const data = this.filteredOrders.map(order => ({\n        è®¢å•å·: order.oid,\n        æ”¶è´§äºº: order.receiver_name,\n        ç”µè¯: order.receiver_phone,\n        åœ°å€: order.receiver_address,\n        é‡‘é¢: order.amount,\n        çŠ¶æ€: this.getStatusText(order.status),\n        ä¸‹å•æ—¶é—´: this.formatDateTime(order.order_time)\n      }));\n\n      // ç®€å•çš„å¯¼å‡ºå®ç°ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚xlsxï¼‰\n      const csvContent = \"data:text/csv;charset=utf-8,\" + \"è®¢å•å·,æ”¶è´§äºº,ç”µè¯,åœ°å€,é‡‘é¢,çŠ¶æ€,ä¸‹å•æ—¶é—´\\n\" + data.map(row => Object.values(row).join(\",\")).join(\"\\n\");\n      const encodedUri = encodeURI(csvContent);\n      const link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", `è®¢å•æ•°æ®_${new Date().toLocaleDateString()}.csv`);\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    },\n    prevPage() {\n      if (this.currentPage > 1) {\n        this.currentPage--;\n      }\n    },\n    nextPage() {\n      if (this.currentPage < this.totalPages) {\n        this.currentPage++;\n      }\n    }\n  },\n  watch: {\n    statusFilter() {\n      this.currentPage = 1;\n    },\n    dateRange() {\n      this.currentPage = 1;\n    },\n    searchKeyword() {\n      this.currentPage = 1;\n    }\n  }\n};","map":{"version":3,"names":["axios","apiConfig","name","data","loading","searchKeyword","statusFilter","dateRange","currentPage","pageSize","orders","orderStats","pending","shipped","completed","total","selectedOrder","showShipModal","shipmentOrder","shipment","courier","tracking_number","computed","filteredOrders","filtered","keyword","toLowerCase","filter","order","oid","toString","includes","receiver_name","receiver_phone","items","some","item","status","now","Date","startDate","getFullYear","getMonth","getDate","orderDate","order_time","sort","a","b","paginatedOrders","start","end","slice","totalPages","Math","ceil","length","mounted","loadOrders","methods","formatDate","dateString","date","toLocaleDateString","e","formatDateTime","toLocaleString","year","month","day","hour","minute","getStatusClass","statusMap","getStatusText","getBusinessId","businessInfo","JSON","parse","localStorage","getItem","bid","id","console","error","productsResponse","get","business","getProducts","productMap","code","products","forEach","p","pid","response","getOrders","log","detailPromises","Object","keys","normalizedOrders","normalizeOrdersData","map","originalCount","itemId","match","String","Number","hasValidName","i","push","getOrderDetail","then","res","detail","product_name","quantity","catch","warn","Promise","allSettled","price","parseFloat","amount","toFixed","subtotal","validOrders","calculateStats","message","stringify","product","goods","productId","goodsId","receiverName","receiver","receiverPhone","phone","receiverAddress","receiver_address","address","orderId","orderTime","createdAt","createTime","time","timestamp","toISOString","undefined","Array","isArray","orderItems","order_items","orderItem","hasProductFields","product_id","product_price","goods_id","goods_name","goods_price","productName","productPrice","normalizedItems","model","goodsName","product_title","specs","attributes","spec","product_model","goods_spec","unit_price","goodsPrice","parseInt","count","num","product_num","goods_num","stats","shipOrder","note","confirmShipment","validateShipment","url","shipOrderCommon","payload","logisticsCompany","trackingNumber","put","params","alert","finalErrorMsg","msg","trim","viewTracking","getOrderLogistics","logi","company","logistics_company","tracking","created","created_time","createdTime","updated","updated_time","updatedTime","viewFeedback","uid","messages","feedback","getUserFeedback","fb","star","comment","join","cancelOrder","confirm","cancelOrderAsync","fixOrderPrices","reduce","sum","viewOrderDetail","logisticsSource","logistics","orderLogistics","number","shipTime","ship_time","create_time","detailItems","exportOrders","è®¢å•å·","æ”¶è´§äºº","ç”µè¯","åœ°å€","é‡‘é¢","çŠ¶æ€","ä¸‹å•æ—¶é—´","csvContent","row","values","encodedUri","encodeURI","link","document","createElement","setAttribute","body","appendChild","click","removeChild","prevPage","nextPage","watch"],"sources":["D:\\1_homework_file\\å¤§ä¸‰ä¸Š\\è½¯ä»¶å·¥ç¨‹\\é¡¹ç›®ç•™æ¡£\\1å‰ç«¯å¼€å‘_æˆ‘æ‰æ˜¯çœŸçš„\\version5.0\\src\\views\\business\\BusinessOrder.vue"],"sourcesContent":["<template>\r\n  <div class=\"business-orders\">\r\n    <!-- é¡µé¢å¤´éƒ¨ -->\r\n    <div class=\"page-header\">\r\n      <h2>è®¢å•ç®¡ç†</h2>\r\n      <div class=\"order-stats\">\r\n        <div class=\"stat-item\">\r\n          <span class=\"stat-label\">å¾…å‘è´§</span>\r\n          <span class=\"stat-value\">{{ orderStats.pending }}</span>\r\n        </div>\r\n        <div class=\"stat-item\">\r\n          <span class=\"stat-label\">å·²å‘è´§</span>\r\n          <span class=\"stat-value\">{{ orderStats.shipped }}</span>\r\n        </div>\r\n        <div class=\"stat-item\">\r\n          <span class=\"stat-label\">å·²å®Œæˆ</span>\r\n          <span class=\"stat-value\">{{ orderStats.completed }}</span>\r\n        </div>\r\n        <div class=\"stat-item\">\r\n          <span class=\"stat-label\">æ€»è®¢å•</span>\r\n          <span class=\"stat-value\">{{ orderStats.total }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- ç­›é€‰å’Œæœç´¢ -->\r\n    <div class=\"filters\">\r\n      <div class=\"search-box\">\r\n        <input\r\n            type=\"text\"\r\n            v-model=\"searchKeyword\"\r\n            placeholder=\"æœç´¢è®¢å•å·ã€æ”¶è´§äººã€ç”µè¯...\"\r\n            class=\"search-input\"\r\n        />\r\n        <span class=\"search-icon\">ğŸ”</span>\r\n      </div>\r\n\r\n      <div class=\"filter-group\">\r\n        <select v-model=\"statusFilter\" class=\"filter-select\">\r\n          <option value=\"all\">å…¨éƒ¨çŠ¶æ€</option>\r\n          <option value=\"0\">å¾…å‘è´§</option>\r\n          <option value=\"1\">å·²å‘è´§</option>\r\n          <option value=\"2\">å·²æ”¶è´§</option>\r\n          <option value=\"3\">å·²å–æ¶ˆ</option>\r\n        </select>\r\n\r\n        <select v-model=\"dateRange\" class=\"filter-select\">\r\n          <option value=\"all\">å…¨éƒ¨æ—¶é—´</option>\r\n          <option value=\"today\">ä»Šå¤©</option>\r\n          <option value=\"week\">æœ¬å‘¨</option>\r\n          <option value=\"month\">æœ¬æœˆ</option>\r\n        </select>\r\n\r\n        <button class=\"btn-export\" @click=\"exportOrders\">\r\n          <span class=\"export-icon\">ğŸ“¥</span>\r\n          å¯¼å‡ºè®¢å•\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- è®¢å•è¡¨æ ¼ -->\r\n    <div class=\"orders-table\">\r\n      <table>\r\n        <thead>\r\n        <tr>\r\n          <th>è®¢å•å·</th>\r\n          <th>å•†å“ä¿¡æ¯</th>\r\n          <th>æ”¶è´§äºº</th>\r\n          <th>é‡‘é¢</th>\r\n          <th>çŠ¶æ€</th>\r\n          <th>ä¸‹å•æ—¶é—´</th>\r\n          <th>æ“ä½œ</th>\r\n        </tr>\r\n        </thead>\r\n        <tbody>\r\n        <tr v-for=\"order in paginatedOrders\" :key=\"order.oid\">\r\n          <td>\r\n            <div class=\"order-id\">#{{ order.oid }}</div>\r\n          </td>\r\n          <td>\r\n            <div class=\"order-products\">\r\n              <div v-if=\"order.items && order.items.length > 0\" v-for=\"item in order.items\" :key=\"item.id || Math.random()\" class=\"order-item\">\r\n                <div class=\"item-main-info\">\r\n                  <span class=\"item-name\">{{ item.name || 'é»˜è®¤å•†å“' }}</span>\r\n                  <span class=\"item-model\" v-if=\"item.model\">({{ item.model }})</span>\r\n                </div>\r\n                <span class=\"item-quantity\">Ã—{{ item.quantity || 1 }}</span>\r\n              </div>\r\n              <div v-else class=\"no-items\">\r\n                <span class=\"item-name\">å•†å“ä¿¡æ¯æœªæä¾›</span>\r\n                <span class=\"item-quantity\">Ã—1</span>\r\n              </div>\r\n            </div>\r\n          </td>\r\n          <td>\r\n            <div class=\"receiver-info\">\r\n              <div class=\"receiver-name\">{{ order.receiver_name }}</div>\r\n              <div class=\"receiver-phone\">{{ order.receiver_phone }}</div>\r\n              <div v-if=\"order.remark\" class=\"receiver-remark\">å¤‡æ³¨ï¼š{{ order.remark }}</div>\r\n            </div>\r\n          </td>\r\n          <td>\r\n            <div class=\"order-amount\">Â¥{{ order.amount }}</div>\r\n          </td>\r\n          <td>\r\n              <span :class=\"['status-badge', getStatusClass(order.status)]\">\r\n                {{ getStatusText(order.status) }}\r\n              </span>\r\n          </td>\r\n          <td>\r\n            <div class=\"order-time\">\r\n              {{ formatDateTime(order.order_time) }}\r\n            </div>\r\n          </td>\r\n          <td>\r\n            <div class=\"order-actions\">\r\n              <button\r\n                  v-if=\"order.status === 0\"\r\n                  class=\"btn-ship\"\r\n                  @click=\"shipOrder(order)\"\r\n              >\r\n                å‘è´§\r\n              </button>\r\n              <button\r\n                  v-if=\"order.status === 1\"\r\n                  class=\"btn-track\"\r\n                  @click=\"viewTracking(order)\"\r\n              >\r\n                ç‰©æµ\r\n              </button>\r\n              <button\r\n                  v-if=\"order.status === 2\"\r\n                  class=\"btn-track\"\r\n                  @click=\"viewFeedback(order)\"\r\n              >\r\n                æŸ¥çœ‹è¯„ä»·\r\n              </button>\r\n              <button\r\n                  v-if=\"order.status < 3\"\r\n                  class=\"btn-cancel\"\r\n                  @click=\"cancelOrder(order)\"\r\n              >\r\n                å–æ¶ˆ\r\n              </button>\r\n              <button\r\n                  class=\"btn-detail\"\r\n                  @click=\"viewOrderDetail(order)\"\r\n              >\r\n                è¯¦æƒ…\r\n              </button>\r\n            </div>\r\n          </td>\r\n        </tr>\r\n        <tr v-if=\"paginatedOrders.length === 0\">\r\n          <td colspan=\"7\" class=\"no-orders\">\r\n            æš‚æ— è®¢å•æ•°æ®\r\n          </td>\r\n        </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <!-- åˆ†é¡µ -->\r\n    <div class=\"pagination\">\r\n      <button\r\n          class=\"pagination-btn\"\r\n          :disabled=\"currentPage === 1\"\r\n          @click=\"prevPage\"\r\n      >\r\n        ä¸Šä¸€é¡µ\r\n      </button>\r\n      <span class=\"pagination-info\">\r\n        ç¬¬ {{ currentPage }} é¡µ / å…± {{ totalPages }} é¡µ\r\n      </span>\r\n      <button\r\n          class=\"pagination-btn\"\r\n          :disabled=\"currentPage === totalPages\"\r\n          @click=\"nextPage\"\r\n      >\r\n        ä¸‹ä¸€é¡µ\r\n      </button>\r\n    </div>\r\n\r\n    <!-- è®¢å•è¯¦æƒ…æ¨¡æ€æ¡† -->\r\n    <div v-if=\"selectedOrder\" class=\"modal-overlay\" @click.self=\"selectedOrder = null\">\r\n      <div class=\"modal modal-lg\">\r\n        <div class=\"modal-header\">\r\n          <h3>è®¢å•è¯¦æƒ… #{{ selectedOrder.oid }}</h3>\r\n          <button class=\"modal-close\" @click=\"selectedOrder = null\">Ã—</button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <div class=\"order-detail\">\r\n            <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->\r\n            <div class=\"detail-section\">\r\n              <h4>è®¢å•ä¿¡æ¯</h4>\r\n              <div class=\"detail-grid\">\r\n                <div class=\"detail-item\">\r\n                  <label>è®¢å•å·ï¼š</label>\r\n                  <span>#{{ selectedOrder.oid }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>è®¢å•çŠ¶æ€ï¼š</label>\r\n                  <span :class=\"['status-badge', getStatusClass(selectedOrder.status)]\">\r\n                    {{ getStatusText(selectedOrder.status) }}\r\n                  </span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>ä¸‹å•æ—¶é—´ï¼š</label>\r\n                  <span>{{ formatDateTime(selectedOrder.order_time || new Date().toISOString()) }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>è®¢å•é‡‘é¢ï¼š</label>\r\n                  <span class=\"amount\">Â¥{{ selectedOrder.amount }}</span>\r\n                </div>\r\n                <div class=\"detail-item\" v-if=\"selectedOrder.remark\">\r\n                  <label>ç”¨æˆ·å¤‡æ³¨ï¼š</label>\r\n                  <span>{{ selectedOrder.remark }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- æ”¶è´§ä¿¡æ¯ -->\r\n            <div class=\"detail-section\">\r\n              <h4>æ”¶è´§ä¿¡æ¯</h4>\r\n              <div class=\"detail-grid\">\r\n                <div class=\"detail-item\">\r\n                  <label>æ”¶è´§äººï¼š</label>\r\n                  <span>{{ selectedOrder.receiver_name }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>è”ç³»ç”µè¯ï¼š</label>\r\n                  <span>{{ selectedOrder.receiver_phone }}</span>\r\n                </div>\r\n                <div class=\"detail-item full-width\">\r\n                  <label>æ”¶è´§åœ°å€ï¼š</label>\r\n                  <span>{{ selectedOrder.receiver_address }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>çœä»½ï¼š</label>\r\n                  <span>{{ selectedOrder.province || 'æœªè®¾ç½®' }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- å•†å“ä¿¡æ¯ -->\r\n            <div class=\"detail-section\">\r\n              <h4>å•†å“æ¸…å•</h4>\r\n              <div class=\"products-list\">\r\n                <div v-for=\"item in selectedOrder.items\" :key=\"item.id\" class=\"product-item\">\r\n                  <div class=\"product-image\">\r\n                    <span class=\"image-placeholder\">ğŸ’»</span>\r\n                  </div>\r\n                  <div class=\"product-info\">\r\n                    <div class=\"product-name\">{{ item.name }}</div>\r\n                    <div class=\"product-price\">å•ä»·ï¼šÂ¥{{ item.price }}</div>\r\n                  </div>\r\n                  <div class=\"product-quantity\">\r\n                    Ã—{{ item.quantity }}\r\n                  </div>\r\n                  <div class=\"product-total\">\r\n                    Â¥{{ item.subtotal || (item.price * item.quantity) }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- ç‰©æµä¿¡æ¯ (å·²å‘è´§/å·²æ”¶è´§æ˜¾ç¤º) -->\r\n            <div class=\"detail-section\" v-if=\"selectedOrder.status >= 1\">\r\n              <h4>ç‰©æµä¿¡æ¯</h4>\r\n              <div class=\"detail-grid\">\r\n                <div class=\"detail-item\">\r\n                  <label>ç‰©æµå…¬å¸ï¼š</label>\r\n                  <span>{{ selectedOrder.courier || selectedOrder.logistics_company || 'æœªè®¾ç½®' }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>è¿å•å·ï¼š</label>\r\n                  <span>{{ selectedOrder.tracking_number || selectedOrder.trackingNumber || 'æœªè®¾ç½®' }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>åˆ›å»ºæ—¶é—´ï¼š</label>\r\n                  <span>{{ formatDateTime(selectedOrder.created_time || selectedOrder.createdTime || selectedOrder.ship_time) }}</span>\r\n                </div>\r\n                <div class=\"detail-item\">\r\n                  <label>æ›´æ–°æ—¶é—´ï¼š</label>\r\n                  <span>{{ formatDateTime(selectedOrder.updated_time || selectedOrder.updatedTime) }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- è®¢å•å¤‡æ³¨ -->\r\n            <div class=\"detail-section\" v-if=\"selectedOrder.remark\">\r\n              <h4>è®¢å•å¤‡æ³¨</h4>\r\n              <div class=\"remark-content\">\r\n                {{ selectedOrder.remark }}\r\n              </div>\r\n            </div>\r\n\r\n            <!-- æ“ä½œæŒ‰é’® -->\r\n            <div class=\"detail-actions\" v-if=\"selectedOrder.status === 0\">\r\n              <button class=\"btn-ship-large\" @click=\"shipOrder(selectedOrder)\">\r\n                <span class=\"icon\">ğŸšš</span>\r\n                ç¡®è®¤å‘è´§\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- å‘è´§æ¨¡æ€æ¡† -->\r\n    <div v-if=\"showShipModal\" class=\"modal-overlay\" @click.self=\"showShipModal = false\">\r\n      <div class=\"modal\">\r\n        <div class=\"modal-header\">\r\n          <h3>ç¡®è®¤å‘è´§</h3>\r\n          <button class=\"modal-close\" @click=\"showShipModal = false\">Ã—</button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <form @submit.prevent=\"confirmShipment\">\r\n            <div class=\"form-group\">\r\n              <label>ç‰©æµå…¬å¸ *</label>\r\n              <select v-model=\"shipment.courier\" required>\r\n                <option value=\"\">è¯·é€‰æ‹©ç‰©æµå…¬å¸</option>\r\n                <option value=\"é¡ºä¸°é€Ÿè¿\">é¡ºä¸°é€Ÿè¿</option>\r\n                <option value=\"åœ†é€šé€Ÿé€’\">åœ†é€šé€Ÿé€’</option>\r\n                <option value=\"ä¸­é€šå¿«é€’\">ä¸­é€šå¿«é€’</option>\r\n                <option value=\"ç”³é€šå¿«é€’\">ç”³é€šå¿«é€’</option>\r\n                <option value=\"éŸµè¾¾å¿«é€’\">éŸµè¾¾å¿«é€’</option>\r\n                <option value=\"äº¬ä¸œç‰©æµ\">äº¬ä¸œç‰©æµ</option>\r\n                <option value=\"é‚®æ”¿EMS\">é‚®æ”¿EMS</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label>è¿å•å· *</label>\r\n              <input\r\n                  type=\"text\"\r\n                  v-model=\"shipment.tracking_number\"\r\n                  placeholder=\"è¯·è¾“å…¥è¿å•å·\"\r\n                  required\r\n              >\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label>å‘è´§å¤‡æ³¨</label>\r\n              <textarea\r\n                  v-model=\"shipment.note\"\r\n                  placeholder=\"å¯è¾“å…¥å‘è´§å¤‡æ³¨ä¿¡æ¯\"\r\n                  rows=\"3\"\r\n              ></textarea>\r\n            </div>\r\n\r\n            <div class=\"form-actions\">\r\n              <button type=\"button\" class=\"btn-cancel\" @click=\"showShipModal = false\">\r\n                å–æ¶ˆ\r\n              </button>\r\n              <button type=\"submit\" class=\"btn-submit\">\r\n                ç¡®è®¤å‘è´§\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nimport apiConfig from '@/config/api.config';\r\n\r\nexport default {\r\n  name: 'BusinessOrders',\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      searchKeyword: '',\r\n      statusFilter: 'all',\r\n      dateRange: 'all',\r\n      currentPage: 1,\r\n      pageSize: 10,\r\n\r\n      orders: [],\r\n      orderStats: {\r\n        pending: 0,\r\n        shipped: 0,\r\n        completed: 0,\r\n        total: 0\r\n      },\r\n\r\n      selectedOrder: null,\r\n      showShipModal: false,\r\n      shipmentOrder: null,\r\n\r\n      shipment: {\r\n        courier: '',\r\n        tracking_number: ''\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    filteredOrders() {\r\n      let filtered = [...this.orders];\r\n\r\n      if (this.searchKeyword) {\r\n        const keyword = this.searchKeyword.toLowerCase();\r\n        filtered = filtered.filter(order =>\r\n            (order.oid && order.oid.toString().includes(keyword)) ||\r\n            (order.receiver_name && order.receiver_name.toLowerCase().includes(keyword)) ||\r\n            (order.receiver_phone && order.receiver_phone.includes(keyword)) ||\r\n            (order.items && order.items.some(item =>\r\n                item.name && item.name.toLowerCase().includes(keyword)))\r\n        );\r\n      }\r\n\r\n      if (this.statusFilter !== 'all') {\r\n        filtered = filtered.filter(order => order.status.toString() === this.statusFilter);\r\n      }\r\n\r\n      if (this.dateRange !== 'all') {\r\n        const now = new Date();\r\n        let startDate;\r\n\r\n        switch (this.dateRange) {\r\n          case 'today':\r\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n            break;\r\n          case 'week':\r\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);\r\n            break;\r\n          case 'month':\r\n            startDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());\r\n            break;\r\n        }\r\n\r\n        filtered = filtered.filter(order => {\r\n          const orderDate = new Date(order.order_time);\r\n          return orderDate >= startDate;\r\n        });\r\n      }\r\n\r\n      filtered.sort((a, b) => new Date(b.order_time) - new Date(a.order_time));\r\n\r\n      return filtered;\r\n    },\r\n\r\n    paginatedOrders() {\r\n      const start = (this.currentPage - 1) * this.pageSize;\r\n      const end = start + this.pageSize;\r\n      return this.filteredOrders.slice(start, end);\r\n    },\r\n\r\n    totalPages() {\r\n      return Math.ceil(this.filteredOrders.length / this.pageSize);\r\n    }\r\n  },\r\n  mounted() {\r\n    this.loadOrders();\r\n  },\r\n  methods: {\r\n    formatDate(dateString) {\r\n      if (!dateString) return '';\r\n      try {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString('zh-CN');\r\n      } catch (e) {\r\n        return dateString;\r\n      }\r\n    },\r\n\r\n    formatDateTime(dateString) {\r\n      if (!dateString) return '';\r\n      try {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleString('zh-CN', {\r\n          year: 'numeric',\r\n          month: '2-digit',\r\n          day: '2-digit',\r\n          hour: '2-digit',\r\n          minute: '2-digit'\r\n        });\r\n      } catch (e) {\r\n        return dateString;\r\n      }\r\n    },\r\n\r\n    getStatusClass(status) {\r\n      const statusMap = {\r\n        0: 'pending',\r\n        1: 'shipped',\r\n        2: 'completed',\r\n        3: 'cancelled',\r\n        4: 'cancelled'\r\n      };\r\n      return statusMap[status] || 'pending';\r\n    },\r\n\r\n    getStatusText(status) {\r\n      const statusMap = {\r\n        0: 'å¾…å‘è´§',\r\n        1: 'å·²å‘è´§',\r\n        2: 'å·²æ”¶è´§',\r\n        3: 'å·²å–æ¶ˆ',\r\n        4: 'å·²å–æ¶ˆ'\r\n      };\r\n      return statusMap[status] || 'æœªçŸ¥çŠ¶æ€';\r\n    },\r\n\r\n    // è·å–å•†å®¶IDçš„ç»Ÿä¸€æ–¹æ³•\r\n    getBusinessId() {\r\n      const businessInfo = JSON.parse(localStorage.getItem('businessInfo'));\r\n      if (!businessInfo) return null;\r\n      return businessInfo.bid || businessInfo.id;\r\n    },\r\n\r\n    async loadOrders() {\r\n      this.loading = true;\r\n      const bid = this.getBusinessId();\r\n\r\n      if (!bid) {\r\n        console.error('æœªæ‰¾åˆ°å•†å®¶ä¿¡æ¯');\r\n        this.orders = [];\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // 1. å…ˆè·å–å•†å“åˆ—è¡¨ï¼Œå»ºç«‹æ˜ å°„è¡¨\r\n        const productsResponse = await axios.get(apiConfig.business.getProducts(bid));\r\n        const productMap = {};\r\n        if (productsResponse.data.code === 1) {\r\n            const products = productsResponse.data.data || [];\r\n            products.forEach(p => {\r\n                if (p.pid) productMap[p.pid] = p;\r\n            });\r\n        }\r\n\r\n        // 2. è·å–è®¢å•æ•°æ®\r\n        const response = await axios.get(apiConfig.business.getOrders(bid));\r\n        console.log('APIè¿”å›çš„è®¢å•æ•°æ®:', response.data.data);\r\n        \r\n        if (response.data.code === 1) {\r\n          const orders = response.data.data || [];\r\n          \r\n          // æ”¶é›†éœ€è¦è¡¥å…¨ä¿¡æ¯çš„è®¢å•Promise\r\n          const detailPromises = [];\r\n          \r\n          console.log('Product Map Keys:', Object.keys(productMap));\r\n\r\n          // åˆæ­¥è§„èŒƒåŒ–ï¼Œå¹¶æ ‡è®°éœ€è¦è¡¥å…¨çš„è®¢å•\r\n          const normalizedOrders = this.normalizeOrdersData(orders).map(order => {\r\n             // è¿‡æ»¤ï¼šåªä¿ç•™å±äºå½“å‰å•†å®¶çš„è®¢å•é¡¹\r\n             // ç­–ç•¥ï¼šä½¿ç”¨ productMap (å½“å‰å•†å®¶çš„å•†å“åˆ—è¡¨) æ¥éªŒè¯\r\n             if (order.items && order.items.length > 0) {\r\n                 const originalCount = order.items.length;\r\n                 order.items = order.items.filter(item => {\r\n                     // è°ƒè¯•ï¼šæ‰“å°åŒ¹é…è¿‡ç¨‹\r\n                     const itemId = item.id || item.pid;\r\n                     const match = productMap[itemId] || productMap[String(itemId)] || productMap[Number(itemId)];\r\n                     // console.log(`Item ID: ${itemId}, Match: ${!!match}`);\r\n                     \r\n                     // æš‚æ—¶æ”¾å®½ï¼šå¦‚æœåŒ¹é…æˆåŠŸï¼Œæˆ–è€…æ˜¯æ–°ç”Ÿæˆçš„è®¢å•ï¼ˆæˆ‘ä»¬å‡è®¾æ–°è®¢å•æ•°æ®æ˜¯å¯¹çš„ï¼‰ï¼Œæˆ–è€… productMap ä¸ºç©º\r\n                     // ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å…ˆåªåœ¨æ§åˆ¶å°è­¦å‘Šï¼Œä¸å®é™…åˆ é™¤ï¼Œçœ‹çœ‹æ—¥å¿—\r\n                     return match || Object.keys(productMap).length === 0;\r\n                 });\r\n                 \r\n                 if (order.items.length < originalCount) {\r\n                     console.log(`è®¢å• ${order.oid || order.id} è¿‡æ»¤äº† ${originalCount - order.items.length} ä¸ªéæœ¬å•†å®¶å•†å“`);\r\n                 }\r\n             }\r\n\r\n             // å¦‚æœè¿‡æ»¤åæ²¡æœ‰å•†å“äº†ï¼Œè¯´æ˜è¿™ä¸ªè®¢å•å¯èƒ½å…¨æ˜¯åˆ«äººçš„\r\n             // æš‚æ—¶æ³¨é‡Šæ‰éšè—é€»è¾‘ï¼Œé˜²æ­¢è¯¯æ€\r\n             // if (order.items.length === 0) return null;\r\n\r\n             // å°è¯•åˆ©ç”¨æœ¬åœ°å•†å“åˆ—è¡¨è¡¥å…¨ä¿¡æ¯\r\n             if (order.items && order.items.length > 0) {\r\n                 order.items.forEach(item => {\r\n                     // å¦‚æœæ˜¯é»˜è®¤å•†å“ï¼Œå°è¯•é€šè¿‡ PID è¡¥å…¨\r\n                     if ((!item.name || item.name === 'é»˜è®¤å•†å“' || item.name === 'å•†å“') && productMap[item.id]) {\r\n                         item.name = productMap[item.id].name;\r\n                     }\r\n                 });\r\n             }\r\n             \r\n             // å¦‚æœä¾ç„¶æ²¡æœ‰æœ‰æ•ˆå•†å“åï¼ŒåŠ å…¥è¡¥å…¨é˜Ÿåˆ—\r\n             const hasValidName = order.items && order.items.some(i => i.name && i.name !== 'é»˜è®¤å•†å“' && i.name !== 'å•†å“');\r\n             if (!hasValidName && (order.oid || order.id)) {\r\n                 const oid = order.oid || order.id;\r\n                 detailPromises.push(\r\n                     axios.get(apiConfig.order.getOrderDetail(oid))\r\n                         .then(res => {\r\n                             if (res.data.code === 1 && res.data.data) {\r\n                                 const detail = res.data.data;\r\n                                 let name = '';\r\n                                 if (detail.items && detail.items.length) name = detail.items[0].name;\r\n                                 else if (detail.product_name) name = detail.product_name;\r\n                                 \r\n                                 if (name) {\r\n                                     // æ›´æ–°å½“å‰è®¢å•å¯¹è±¡çš„ items\r\n                                     if (!order.items || !order.items.length) {\r\n                                         order.items = [{ name: name, quantity: 1 }];\r\n                                     } else {\r\n                                         order.items[0].name = name;\r\n                                     }\r\n                                 }\r\n                             }\r\n                         })\r\n                         .catch(e => console.warn(`è¡¥å…¨è®¢å• ${oid} è¯¦æƒ…å¤±è´¥`, e))\r\n                 );\r\n             }\r\n             return order;\r\n          });\r\n\r\n          // ç­‰å¾…è¡¥å…¨å®Œæˆï¼ˆä¸é˜»å¡UIæ˜¾ç¤ºï¼Œè®©å®ƒæ…¢æ…¢å˜å‡ºæ¥ï¼Œæˆ–è€…ä½¿ç”¨awaité˜»å¡ä¸€ä¸‹ä¹Ÿè¡Œï¼‰\r\n          // è¿™é‡Œé€‰æ‹©ä¸é˜»å¡ï¼Œåˆ©ç”¨Vueçš„å“åº”å¼è‡ªåŠ¨æ›´æ–°è§†å›¾\r\n          if (detailPromises.length > 0) {\r\n              console.log(`æ­£åœ¨è¡¥å…¨ ${detailPromises.length} ä¸ªè®¢å•çš„å•†å“ä¿¡æ¯...`);\r\n              Promise.allSettled(detailPromises).then(() => {\r\n                  console.log('è®¢å•è¯¦æƒ…è¡¥å…¨å®Œæˆ');\r\n                  // å¼ºåˆ¶åˆ·æ–°ä¸€ä¸‹ï¼ˆè™½ç„¶Vueå¯¹è±¡å±æ€§ä¿®æ”¹åº”è¯¥æ˜¯å“åº”å¼çš„ï¼Œä½†ä¸ºäº†ä¿é™©ï¼‰\r\n                  this.orders = [...this.orders]; \r\n              });\r\n          }\r\n\r\n          // 3. åœ¨è¯¦æƒ…è¡¥å…¨åï¼Œå†æ¬¡æ£€æŸ¥å¹¶ä¿®æ­£å•ä»·ä¸º0çš„æƒ…å†µ\r\n          this.orders.forEach(order => {\r\n              if (order.items && order.items.length > 0) {\r\n                  order.items.forEach(item => {\r\n                      // å¦‚æœå•ä»·ä¸º0ï¼Œå°è¯•ä¿®æ­£\r\n                      if (!item.price || parseFloat(item.price) === 0) {\r\n                          // ç­–ç•¥1ï¼šå¦‚æœæ˜¯å•å•†å“è®¢å•ï¼Œä¸”è®¢å•æ€»é‡‘é¢å­˜åœ¨ï¼Œç”¨æ€»é‡‘é¢é™¤ä»¥æ•°é‡\r\n                          if (order.items.length === 1 && order.amount > 0) {\r\n                              item.price = (order.amount / item.quantity).toFixed(2);\r\n                          }\r\n                          // ç­–ç•¥2ï¼šä»å•†å“åˆ—è¡¨æŸ¥æ‰¾å½“å‰ä»·æ ¼ä½œä¸ºå…œåº•\r\n                          else if (productMap[item.id]) {\r\n                              item.price = productMap[item.id].price;\r\n                          }\r\n                      }\r\n                      // é‡æ–°è®¡ç®—å°è®¡\r\n                      item.subtotal = (item.price * item.quantity).toFixed(2);\r\n                  });\r\n              }\r\n          });\r\n\r\n          // è¿‡æ»¤æ‰æ²¡æœ‰å±äºå½“å‰å•†å®¶å•†å“çš„è®¢å•\r\n          // æš‚æ—¶å–æ¶ˆè¿‡æ»¤ï¼Œé˜²æ­¢è¯¯æ€\r\n          // const validOrders = normalizedOrders.filter(order => order.items && order.items.length > 0);\r\n          const validOrders = normalizedOrders.filter(order => order);\r\n\r\n          console.log('è§„èŒƒåŒ–å¹¶è¿‡æ»¤åçš„è®¢å•æ•°æ®:', validOrders);\r\n          this.orders = validOrders;\r\n          this.calculateStats();\r\n        } else {\r\n          console.warn('è·å–è®¢å•å¤±è´¥:', response.data.message);\r\n          this.orders = [];\r\n        }\r\n      } catch (error) {\r\n        console.error('åŠ è½½è®¢å•æ•°æ®å¤±è´¥:', error);\r\n        // ... (ä¿æŒåŸæœ‰å¤‡ç”¨æ–¹æ¡ˆé€»è¾‘)\r\n        this.orders = [];\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    // è§„èŒƒåŒ–è®¢å•æ•°æ®ï¼Œå¤„ç†ä¸åŒå­—æ®µå\r\n    normalizeOrdersData(orders) {\r\n      console.log('æ‰€æœ‰è®¢å•åŸå§‹æ•°æ®:', orders);\r\n      return orders.map(order => {\r\n        console.log('å•ä¸ªè®¢å•åŸå§‹æ•°æ®:', order);\r\n        // é’ˆå¯¹è®¢å•#4æ·»åŠ ç‰¹åˆ«è°ƒè¯•\r\n        if (order.id === 4 || order.oid === 4 || order.oid === '#4') {\r\n          console.log('=== è®¢å•#4è¯¦ç»†æ•°æ®ç»“æ„ ===');\r\n          console.log('è®¢å•å®Œæ•´å¯¹è±¡:', JSON.stringify(order, null, 2));\r\n          console.log('è®¢å•æ‰€æœ‰é”®:', Object.keys(order));\r\n          // æ£€æŸ¥å„ç§å¯èƒ½çš„å•†å“æ•°æ®ä½ç½®\r\n          console.log('order.items:', order.items);\r\n          console.log('order.products:', order.products);\r\n          console.log('order.product:', order.product);\r\n          console.log('order.goods:', order.goods);\r\n          console.log('order.productId:', order.productId);\r\n          console.log('order.goodsId:', order.goodsId);\r\n        }\r\n        // è§„èŒƒåŒ–æ”¶è´§äººä¿¡æ¯\r\n        const receiverName = order.receiver_name || order.receiverName || order.receiver || '';\r\n        const receiverPhone = order.receiver_phone || order.receiverPhone || order.phone || '';\r\n        const receiverAddress = order.receiver_address || order.receiverAddress || order.address || '';\r\n        \r\n        // è§„èŒƒåŒ–è®¢å•å·\r\n        const orderId = order.oid || order.id || '';\r\n        \r\n        // è§„èŒƒåŒ–è®¢å•é‡‘é¢\r\n        const amount = order.amount || order.total || 0;\r\n        \r\n        // è§„èŒƒåŒ–ä¸‹å•æ—¶é—´ - æ›´å¥å£®çš„å¤„ç†\r\n        let orderTime = order.order_time || order.createdAt || order.createTime || order.orderTime || order.time || order.timestamp || '';\r\n        \r\n        // å¦‚æœæ—¶é—´æ˜¯æ•°å­—ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²\r\n        if (typeof orderTime === 'number') {\r\n          orderTime = new Date(orderTime).toISOString();\r\n        }\r\n        \r\n        // ç¡®ä¿æ—¶é—´å­—ç¬¦ä¸²æœ‰å€¼\r\n        if (!orderTime) {\r\n          // å¦‚æœæ²¡æœ‰æ—¶é—´ï¼Œä½¿ç”¨å½“å‰æ—¶é—´ï¼ˆä½œä¸ºé»˜è®¤å€¼ï¼‰\r\n          orderTime = new Date().toISOString();\r\n        }\r\n        \r\n        // è§„èŒƒåŒ–è®¢å•çŠ¶æ€\r\n        const status = order.status !== undefined ? order.status : 0;\r\n        \r\n        // è§„èŒƒåŒ–å•†å“é¡¹ - æ”¯æŒå¤šç§æ•°æ®æ¥æº\r\n        let items = [];\r\n        // æ£€æŸ¥å„ç§å¯èƒ½çš„å•†å“æ•°æ®ä½ç½®\r\n        if (Array.isArray(order.items)) {\r\n          items = order.items;\r\n        } else if (Array.isArray(order.products)) {\r\n          items = order.products;\r\n        } else if (Array.isArray(order.orderItems)) {\r\n          // æ”¯æŒorderItemså­—æ®µï¼ˆè®¢å•é¡¹ï¼‰\r\n          items = order.orderItems;\r\n        } else if (Array.isArray(order.order_items)) {\r\n          // æ”¯æŒorder_itemså­—æ®µ\r\n          items = order.order_items;\r\n        } else if (order.product && typeof order.product === 'object') {\r\n          // å¤„ç†å•ä¸ªå•†å“å¯¹è±¡çš„æƒ…å†µ\r\n          items = [order.product];\r\n        } else if (order.goods && Array.isArray(order.goods)) {\r\n          items = order.goods;\r\n        } else if (order.goods && typeof order.goods === 'object') {\r\n          // å¤„ç†å•ä¸ªgoodså¯¹è±¡çš„æƒ…å†µ\r\n          items = [order.goods];\r\n        } else if (order.orderItem && Array.isArray(order.orderItem)) {\r\n          // æ”¯æŒorderItemæ•°ç»„\r\n          items = order.orderItem;\r\n        } else if (order.orderItem && typeof order.orderItem === 'object') {\r\n          // æ”¯æŒå•ä¸ªorderItemå¯¹è±¡\r\n          items = [order.orderItem];\r\n        } else {\r\n          // å¤„ç†è®¢å•å¯¹è±¡ç›´æ¥åŒ…å«å•†å“å­—æ®µçš„æƒ…å†µï¼ˆå¸¸è§äºå•å•†å“è®¢å•ï¼‰\r\n          const hasProductFields = order.product_id || order.product_name || order.product_price || \r\n                                 order.goods_id || order.goods_name || order.goods_price ||\r\n                                 order.productId || order.productName || order.productPrice;\r\n          \r\n          if (hasProductFields) {\r\n            // ä»è®¢å•å¯¹è±¡ç›´æ¥æå–å•†å“ä¿¡æ¯\r\n            items = [{...order}];\r\n          }\r\n        }\r\n        \r\n        // å¤„ç†å•†å“é¡¹\r\n        const normalizedItems = items.map(item => {\r\n          if (!item || typeof item !== 'object') {\r\n            // å¦‚æœå•†å“é¡¹ä¸æ˜¯å¯¹è±¡ï¼Œè¿”å›é»˜è®¤å€¼\r\n            return {\r\n              id: '',\r\n              name: 'æœªçŸ¥å•†å“',\r\n              model: '',\r\n              price: 0,\r\n              quantity: 1,\r\n              subtotal: 0\r\n            };\r\n          }\r\n          \r\n          return {\r\n            id: item.id || item.product_id || item.goods_id || item.productId || item.goodsId || '',\r\n            bid: item.bid, // ç¡®ä¿ä¿ç•™ bid å­—æ®µç”¨äºè¿‡æ»¤\r\n            name: item.name || item.product_name || item.goods_name || item.productName || \r\n                  item.goodsName || item.product || item.product_title || 'æœªçŸ¥å•†å“',\r\n            model: item.model || item.specs || item.attributes || item.spec || \r\n                  item.product_model || item.goods_spec || '',\r\n            price: parseFloat(item.price || item.unit_price || item.amount || \r\n                           item.product_price || item.goods_price || item.productPrice || \r\n                           item.goodsPrice || (amount > 0 && items.length === 1 ? amount / (item.quantity || 1) : 0)),\r\n            quantity: parseInt(item.quantity || item.count || item.num || \r\n                              item.product_num || item.goods_num || 1),\r\n            subtotal: parseFloat(item.subtotal || (item.price * item.quantity) || \r\n                               (item.unit_price * item.quantity) || 0)\r\n          };\r\n        });\r\n        \r\n        // å¦‚æœæ²¡æœ‰å•†å“é¡¹ï¼Œåˆ›å»ºä¸€ä¸ªé»˜è®¤å•†å“é¡¹\r\n        if (normalizedItems.length === 0) {\r\n          normalizedItems.push({\r\n            id: '',\r\n            name: 'é»˜è®¤å•†å“',\r\n            model: '',\r\n            price: 0,\r\n            quantity: 1,\r\n            subtotal: 0\r\n          });\r\n        }\r\n        \r\n        return {\r\n          ...order,\r\n          oid: orderId,\r\n          receiver_name: receiverName,\r\n          receiver_phone: receiverPhone,\r\n          receiver_address: receiverAddress,\r\n          amount: amount,\r\n          order_time: orderTime,\r\n          status: status,\r\n          items: normalizedItems\r\n        };\r\n      });\r\n    },\r\n\r\n    calculateStats() {\r\n      const stats = {\r\n        pending: 0,\r\n        shipped: 0,\r\n        completed: 0,\r\n        total: 0\r\n      };\r\n\r\n      this.orders.forEach(order => {\r\n        if (order.status === 0) stats.pending++;\r\n        if (order.status === 1) stats.shipped++;\r\n        if (order.status === 2) stats.completed++;\r\n        stats.total++;\r\n      });\r\n\r\n      this.orderStats = stats;\r\n    },\r\n\r\n    shipOrder(order) {\r\n      this.shipmentOrder = order;\r\n      this.shipment = {\r\n        courier: '',\r\n        tracking_number: '',\r\n        note: ''\r\n      };\r\n      this.showShipModal = true;\r\n    },\r\n\r\n    async confirmShipment() {\r\n      if (!this.validateShipment()) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const oid = parseInt(this.shipmentOrder.oid, 10);\r\n        const url = apiConfig.order.shipOrderCommon(oid);\r\n        const payload = {\r\n          // å…¼å®¹åç«¯ RequestBody OrderLogistics\r\n          logisticsCompany: this.shipment.courier,\r\n          trackingNumber: this.shipment.tracking_number,\r\n          // å…¼å®¹ç›´æ¥å­—æ®µ\r\n          courier: this.shipment.courier\r\n        };\r\n\r\n        const response = await axios.put(url, payload, {\r\n          params: {\r\n            courier: this.shipment.courier,\r\n            trackingNumber: this.shipment.tracking_number,\r\n            tracking_number: this.shipment.tracking_number\r\n          }\r\n        });\r\n\r\n        if (response.data.code === 1) {\r\n          this.shipmentOrder.status = 1;\r\n          this.shipmentOrder.courier = this.shipment.courier;\r\n          this.shipmentOrder.tracking_number = this.shipment.tracking_number;\r\n          this.showShipModal = false;\r\n          this.calculateStats();\r\n          alert('å‘è´§æˆåŠŸï¼');\r\n        } else {\r\n          const finalErrorMsg = response.data.message || response.data.msg || 'å‘è´§å¤±è´¥';\r\n          alert(finalErrorMsg);\r\n        }\r\n      } catch (error) {\r\n        console.error('å‘è´§è¯·æ±‚å¼‚å¸¸:', error);\r\n        alert('å‘è´§è¯·æ±‚å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æ§åˆ¶å°æ—¥å¿—');\r\n      }\r\n    },\r\n\r\n    validateShipment() {\r\n      if (!this.shipment.courier.trim()) {\r\n        alert('è¯·é€‰æ‹©ç‰©æµå…¬å¸');\r\n        return false;\r\n      }\r\n\r\n      if (!this.shipment.tracking_number.trim()) {\r\n        alert('è¯·è¾“å…¥è¿å•å·');\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    },\r\n\r\n    viewTracking(order) {\r\n      const oid = order.oid || order.id;\r\n      if (!oid) {\r\n        alert('æœªæ‰¾åˆ°è®¢å•å·');\r\n        return;\r\n      }\r\n      axios.get(apiConfig.order.getOrderLogistics(oid))\r\n        .then(res => {\r\n          if (res.data && res.data.code === 1 && res.data.data) {\r\n            const logi = res.data.data;\r\n            const company = logi.logistics_company || logi.logisticsCompany || logi.courier || 'æœªè®¾ç½®';\r\n            const tracking = logi.tracking_number || logi.trackingNumber || 'æœªè®¾ç½®';\r\n            const created = logi.created_time || logi.createdTime || '';\r\n            const updated = logi.updated_time || logi.updatedTime || '';\r\n            alert(`è®¢å• #${oid}\\nç‰©æµå…¬å¸ï¼š${company}\\nè¿å•å·ï¼š${tracking}\\nåˆ›å»ºï¼š${this.formatDateTime(created)}\\næ›´æ–°ï¼š${this.formatDateTime(updated)}`);\r\n          } else {\r\n            alert(`è®¢å• #${oid} æš‚æ— ç‰©æµä¿¡æ¯`);\r\n          }\r\n        })\r\n        .catch(() => {\r\n          alert(`è®¢å• #${oid} æš‚æ— ç‰©æµä¿¡æ¯`);\r\n        });\r\n    },\r\n\r\n    async viewFeedback(order) {\r\n      if (!order.uid || !order.items) {\r\n        alert('æš‚æ— è¯„ä»·ä¿¡æ¯');\r\n        return;\r\n      }\r\n      const uid = order.uid;\r\n      const messages = [];\r\n      for (const item of order.items) {\r\n        const pid = item.id || item.pid;\r\n        if (!pid) continue;\r\n        try {\r\n          const res = await axios.get(apiConfig.feedback.getUserFeedback(uid, pid));\r\n          if (res.data && res.data.code === 1 && res.data.data) {\r\n            const fb = res.data.data;\r\n            messages.push(`${item.name || 'å•†å“'}ï¼š${fb.star || 0}æ˜Ÿï¼Œ${fb.comment || 'æ— è¯„è®º'}`);\r\n          }\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n      }\r\n      if (messages.length === 0) {\r\n        alert('ç”¨æˆ·å°šæœªè¯„ä»·æˆ–æœªæŸ¥è¯¢åˆ°è¯„ä»·');\r\n      } else {\r\n        alert(messages.join('\\n'));\r\n      }\r\n    },\r\n\r\n    cancelOrder(order) {\r\n      if (confirm(`ç¡®å®šè¦å–æ¶ˆè®¢å• #${order.oid} å—ï¼Ÿ`)) {\r\n        this.cancelOrderAsync(order);\r\n      }\r\n    },\r\n\r\n    async cancelOrderAsync(order) {\r\n      const bid = this.getBusinessId();\r\n\r\n      if (!bid) {\r\n        alert('å•†å®¶ä¿¡æ¯ä¸å®Œæ•´');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // æ³¨æ„ï¼šæ–‡æ¡£ä¸­åªæœ‰ç”¨æˆ·å–æ¶ˆè®¢å•çš„APIï¼Œæ²¡æœ‰å•†å®¶å–æ¶ˆè®¢å•çš„API\r\n        // è¿™é‡Œå¯èƒ½éœ€è¦è°ƒç”¨ç”¨æˆ·å–æ¶ˆè®¢å•çš„APIï¼Œæˆ–è€…åœ¨å‰ç«¯ç›´æ¥æ›´æ–°çŠ¶æ€\r\n        const response = await axios.put(\r\n            `/api/orders/${order.oid}/cancel?uid=${order.uid}`\r\n        );\r\n\r\n        if (response.data.code === 1) {\r\n          order.status = 4; // å•†å®¶å–æ¶ˆè®¾ç½®ä¸º4\r\n          this.calculateStats();\r\n          alert('è®¢å•å·²å–æ¶ˆ');\r\n        } else {\r\n          alert(`å–æ¶ˆå¤±è´¥ï¼š${response.data.message}`);\r\n        }\r\n      } catch (error) {\r\n        console.error('å–æ¶ˆè®¢å•å¤±è´¥:', error);\r\n        alert('å–æ¶ˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    },\r\n\r\n    // æå–ä»·æ ¼ä¿®å¤é€»è¾‘\r\n    fixOrderPrices(order) {\r\n      if (!order.items || order.items.length === 0) return;\r\n      \r\n      // å°è¯•è·å–æœ¬åœ°å•†å“æ˜ å°„è¡¨ï¼ˆå¦‚æœå·²ç»åŠ è½½ï¼‰\r\n      // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå› ä¸ºåœ¨ methods ä¸­å¾ˆéš¾ç›´æ¥è®¿é—® loadOrders å†…éƒ¨çš„ productMap\r\n      // ä½†æˆ‘ä»¬å¯ä»¥å°è¯•ä» localStorage æˆ– store è·å–ï¼Œæˆ–è€…ç®€å•åœ°åªç”¨ total amount å€’æ¨\r\n      \r\n      order.items.forEach(item => {\r\n          // è§„èŒƒåŒ–å­—æ®µ\r\n          if (!item.price) item.price = item.unit_price || item.productPrice || 0;\r\n          \r\n          // å¦‚æœå•ä»·ä¸º0ï¼Œå°è¯•ä¿®æ­£\r\n          if (parseFloat(item.price) === 0) {\r\n              // ç­–ç•¥1ï¼šå¦‚æœæ˜¯å•å•†å“è®¢å•ï¼Œä¸”è®¢å•æ€»é‡‘é¢å­˜åœ¨ï¼Œç”¨æ€»é‡‘é¢é™¤ä»¥æ•°é‡\r\n              if (order.items.length === 1 && order.amount > 0) {\r\n                  item.price = (order.amount / (item.quantity || 1)).toFixed(2);\r\n              }\r\n              // ç­–ç•¥2ï¼šå¦‚æœ item æœ‰ subtotal ä¸”ä¸ä¸º 0\r\n              else if (item.subtotal && parseFloat(item.subtotal) > 0) {\r\n                  item.price = (item.subtotal / (item.quantity || 1)).toFixed(2);\r\n              }\r\n          }\r\n          \r\n          // ç¡®ä¿ quantity å­˜åœ¨\r\n          item.quantity = item.quantity || 1;\r\n          \r\n          // é‡æ–°è®¡ç®—å°è®¡\r\n          item.subtotal = (item.price * item.quantity).toFixed(2);\r\n      });\r\n      \r\n      // å¦‚æœæ€»é‡‘é¢ä¸º0ï¼Œå°è¯•ç´¯åŠ å­é¡¹\r\n      if (parseFloat(order.amount) === 0) {\r\n          order.amount = order.items.reduce((sum, item) => sum + parseFloat(item.subtotal), 0).toFixed(2);\r\n      }\r\n    },\r\n\r\n    async viewOrderDetail(order) {\r\n      // 1. å…ˆç”¨åˆ—è¡¨ä¸­çš„æ•°æ®æ¸²æŸ“\r\n      this.selectedOrder = { ...order };\r\n      // ç«‹å³å°è¯•ä¿®å¤ä¸€æ¬¡ä»·æ ¼ï¼ˆä½¿ç”¨åˆ—è¡¨æ•°æ®ï¼‰\r\n      this.fixOrderPrices(this.selectedOrder);\r\n      \r\n      const oid = order.oid || order.id;\r\n      if (!oid) return;\r\n      \r\n      try {\r\n        console.log(`æ­£åœ¨è·å–è®¢å• #${oid} çš„è¯¦ç»†ä¿¡æ¯(å«ç‰©æµ)...`);\r\n        // 2. å°è¯•ä»åç«¯è·å–æœ€æ–°è¯¦æƒ…\r\n        const response = await axios.get(apiConfig.order.getOrderDetail(oid));\r\n        \r\n        if (response.data.code === 1 && response.data.data) {\r\n            const detail = response.data.data;\r\n            console.log('è®¢å•è¯¦æƒ…APIè¿”å›:', detail);\r\n            \r\n            // 3. æ™ºèƒ½åˆå¹¶ç‰©æµä¿¡æ¯\r\n            // åç«¯å¯èƒ½ç›´æ¥è¿”å›åœ¨å¯¹è±¡ä¸Šï¼Œæˆ–è€…åœ¨ logistics å­—æ®µä¸­ï¼Œæˆ–è€…åœ¨ orderLogistics å­—æ®µä¸­\r\n            const logisticsSource = detail.logistics || detail.orderLogistics || detail;\r\n            \r\n            if (logisticsSource) {\r\n                // æå–ç‰©æµå…¬å¸\r\n                const company = logisticsSource.logistics_company || logisticsSource.logisticsCompany || \r\n                              logisticsSource.courier || logisticsSource.company;\r\n                if (company) {\r\n                    this.selectedOrder.courier = company;\r\n                    this.selectedOrder.logistics_company = company;\r\n                }\r\n                \r\n                // æå–è¿å•å·\r\n                const tracking = logisticsSource.tracking_number || logisticsSource.trackingNumber || \r\n                               logisticsSource.number || logisticsSource.tracking;\r\n                if (tracking) {\r\n                    this.selectedOrder.tracking_number = tracking;\r\n                    this.selectedOrder.trackingNumber = tracking;\r\n                }\r\n                \r\n                // æå–å‘è´§æ—¶é—´\r\n                const shipTime = logisticsSource.ship_time || logisticsSource.shipTime || \r\n                               logisticsSource.create_time || logisticsSource.createTime;\r\n                if (shipTime) {\r\n                    this.selectedOrder.ship_time = shipTime;\r\n                }\r\n            }\r\n            \r\n            // 4. å¦‚æœè¯¦æƒ…é‡Œæœ‰ itemsï¼Œåˆå¹¶ items (å¯èƒ½åŒ…å«æ›´è¯¦ç»†çš„å•†å“ä¿¡æ¯)\r\n            if (detail.items && detail.items.length > 0) {\r\n                // ç®€å•çš„åˆå¹¶ç­–ç•¥ï¼šå¦‚æœæ•°é‡ä¸€è‡´ï¼Œå°è¯•ä¿ç•™è¯¦æƒ…é‡Œçš„é¢å¤–å­—æ®µ\r\n                // è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ name å’Œ price\r\n                // ä¸ºé˜²æ­¢è¯¦æƒ…é‡Œçš„ price ä¹Ÿæ˜¯ 0ï¼Œæˆ‘ä»¬å…ˆåˆå¹¶ï¼Œå†è¿è¡Œ fixOrderPrices\r\n                \r\n                // è§„èŒƒåŒ–è¯¦æƒ…é‡Œçš„ items\r\n                const detailItems = this.normalizeOrdersData([{...detail, items: detail.items}])[0].items;\r\n                \r\n                this.selectedOrder.items = detailItems;\r\n            }\r\n            \r\n            // 5. å†æ¬¡ä¿®å¤ä»·æ ¼\r\n            this.fixOrderPrices(this.selectedOrder);\r\n            \r\n            // å¼ºåˆ¶æ›´æ–°è§†å›¾\r\n            this.selectedOrder = { ...this.selectedOrder };\r\n        }\r\n      } catch (e) {\r\n        console.warn('è·å–è®¢å•è¯¦æƒ…å¤±è´¥ï¼Œå°†ä»…æ˜¾ç¤ºåˆ—è¡¨æ•°æ®:', e);\r\n      }\r\n    },\r\n\r\n    exportOrders() {\r\n      // è¿™é‡Œå¯ä»¥å®ç°å¯¼å‡ºåŠŸèƒ½\r\n      const data = this.filteredOrders.map(order => ({\r\n        è®¢å•å·: order.oid,\r\n        æ”¶è´§äºº: order.receiver_name,\r\n        ç”µè¯: order.receiver_phone,\r\n        åœ°å€: order.receiver_address,\r\n        é‡‘é¢: order.amount,\r\n        çŠ¶æ€: this.getStatusText(order.status),\r\n        ä¸‹å•æ—¶é—´: this.formatDateTime(order.order_time)\r\n      }));\r\n\r\n      // ç®€å•çš„å¯¼å‡ºå®ç°ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚xlsxï¼‰\r\n      const csvContent = \"data:text/csv;charset=utf-8,\"\r\n          + \"è®¢å•å·,æ”¶è´§äºº,ç”µè¯,åœ°å€,é‡‘é¢,çŠ¶æ€,ä¸‹å•æ—¶é—´\\n\"\r\n          + data.map(row => Object.values(row).join(\",\")).join(\"\\n\");\r\n\r\n      const encodedUri = encodeURI(csvContent);\r\n      const link = document.createElement(\"a\");\r\n      link.setAttribute(\"href\", encodedUri);\r\n      link.setAttribute(\"download\", `è®¢å•æ•°æ®_${new Date().toLocaleDateString()}.csv`);\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n    },\r\n\r\n    prevPage() {\r\n      if (this.currentPage > 1) {\r\n        this.currentPage--;\r\n      }\r\n    },\r\n\r\n    nextPage() {\r\n      if (this.currentPage < this.totalPages) {\r\n        this.currentPage++;\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    statusFilter() {\r\n      this.currentPage = 1;\r\n    },\r\n    dateRange() {\r\n      this.currentPage = 1;\r\n    },\r\n    searchKeyword() {\r\n      this.currentPage = 1;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.business-orders {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24px;\r\n}\r\n\r\n.page-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  flex-wrap: wrap;\r\n  gap: 20px;\r\n}\r\n\r\n.page-header h2 {\r\n  margin: 0;\r\n  font-size: 24px;\r\n  color: #2d3748;\r\n  font-weight: 700;\r\n}\r\n\r\n.order-stats {\r\n  display: flex;\r\n  gap: 16px;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.stat-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 12px 20px;\r\n  background: white;\r\n  border-radius: 0;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n  min-width: 100px;\r\n}\r\n\r\n.stat-label {\r\n  font-size: 14px;\r\n  color: #718096;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.stat-value {\r\n  font-size: 24px;\r\n  font-weight: 700;\r\n  color: #667eea;\r\n}\r\n\r\n.filters {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 16px;\r\n  align-items: center;\r\n  background: white;\r\n  padding: 16px;\r\n  border-radius: 0;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.search-box {\r\n  position: relative;\r\n  flex: 1;\r\n  min-width: 200px;\r\n}\r\n\r\n.search-input {\r\n  width: 100%;\r\n  padding: 10px 40px 10px 16px;\r\n  border: 1px solid #e2e8f0;\r\n  border-radius: 0;\r\n  font-size: 14px;\r\n  transition: border-color 0.3s;\r\n}\r\n\r\n.search-input:focus {\r\n  outline: none;\r\n  border-color: #667eea;\r\n  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\r\n}\r\n\r\n.search-icon {\r\n  position: absolute;\r\n  right: 16px;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  color: #718096;\r\n  font-size: 16px;\r\n}\r\n\r\n.filter-group {\r\n  display: flex;\r\n  gap: 12px;\r\n  align-items: center;\r\n}\r\n\r\n.filter-select {\r\n  padding: 10px 16px;\r\n  border: 1px solid #e2e8f0;\r\n  border-radius: 0;\r\n  background: white;\r\n  color: #4a5568;\r\n  font-size: 14px;\r\n  min-width: 120px;\r\n}\r\n\r\n.btn-export {\r\n  padding: 10px 20px;\r\n  background: #48bb78;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  font-weight: 500;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.btn-export:hover {\r\n  background: #38a169;\r\n}\r\n\r\n.export-icon {\r\n  font-size: 16px;\r\n}\r\n\r\n.orders-table {\r\n  background: white;\r\n  border-radius: 0;\r\n  overflow: hidden;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.orders-table table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n}\r\n\r\n.orders-table th {\r\n  background: #f8fafc;\r\n  padding: 16px;\r\n  text-align: left;\r\n  font-weight: 600;\r\n  color: #4a5568;\r\n  border-bottom: 1px solid #e2e8f0;\r\n  white-space: nowrap;\r\n}\r\n\r\n.orders-table td {\r\n  padding: 16px;\r\n  border-bottom: 1px solid #f7fafc;\r\n  vertical-align: middle;\r\n}\r\n\r\n.orders-table tbody tr:hover {\r\n  background: #f8fafc;\r\n}\r\n\r\n.order-id {\r\n  font-weight: 600;\r\n  color: #2d3748;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.order-products {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n  max-width: 250px;\r\n}\r\n\r\n.order-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.item-main-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  flex: 1;\r\n}\r\n\r\n.item-name {\r\n  font-weight: 500;\r\n  color: #4a5568;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.item-model {\r\n  font-size: 12px;\r\n  color: #718096;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.item-quantity {\r\n  color: #718096;\r\n  font-size: 13px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.receiver-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n}\r\n\r\n.receiver-name {\r\n  font-weight: 500;\r\n  color: #2d3748;\r\n}\r\n\r\n.receiver-phone {\r\n  font-size: 13px;\r\n  color: #718096;\r\n}\r\n\r\n.order-amount {\r\n  font-weight: 700;\r\n  color: #667eea;\r\n  font-size: 16px;\r\n}\r\n\r\n.status-badge {\r\n  padding: 6px 12px;\r\n  border-radius: 0;\r\n  font-size: 13px;\r\n  font-weight: 500;\r\n  display: inline-block;\r\n}\r\n\r\n.status-badge.pending {\r\n  background: #fffaf0;\r\n  color: #c05621;\r\n}\r\n\r\n.status-badge.shipped {\r\n  background: #ebf8ff;\r\n  color: #2b6cb0;\r\n}\r\n\r\n.status-badge.completed {\r\n  background: #f0fff4;\r\n  color: #276749;\r\n}\r\n\r\n.status-badge.cancelled {\r\n  background: #fff5f5;\r\n  color: #c53030;\r\n}\r\n\r\n.order-time {\r\n  color: #718096;\r\n  font-size: 13px;\r\n  white-space: nowrap;\r\n}\r\n\r\n.order-actions {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 6px;\r\n  min-width: 100px;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.btn-ship, .btn-track, .btn-cancel, .btn-detail {\r\n  padding: 6px 12px;\r\n  border: none;\r\n  border-radius: 0;\r\n  font-size: 13px;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.btn-ship {\r\n  background: #bee3f8;\r\n  color: #2c5282;\r\n}\r\n\r\n.btn-ship:hover {\r\n  background: #90cdf4;\r\n}\r\n\r\n.btn-track {\r\n  background: #c6f6d5;\r\n  color: #22543d;\r\n}\r\n\r\n.btn-track:hover {\r\n  background: #9ae6b4;\r\n}\r\n\r\n.btn-cancel {\r\n  background: #fed7d7;\r\n  color: #c53030;\r\n}\r\n\r\n.btn-cancel:hover {\r\n  background: #feb2b2;\r\n}\r\n\r\n.btn-detail {\r\n  background: #e2e8f0;\r\n  color: #4a5568;\r\n}\r\n\r\n.btn-detail:hover {\r\n  background: #cbd5e0;\r\n}\r\n\r\n.no-orders {\r\n  text-align: center;\r\n  color: #a0aec0;\r\n  padding: 40px 0;\r\n}\r\n\r\n.pagination {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 16px;\r\n  padding: 20px;\r\n  background: white;\r\n  border-radius: 0;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.pagination-btn {\r\n  padding: 8px 16px;\r\n  border: 1px solid #e2e8f0;\r\n  background: white;\r\n  color: #4a5568;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.pagination-btn:hover:not(:disabled) {\r\n  border-color: #667eea;\r\n  color: #667eea;\r\n}\r\n\r\n.pagination-btn:disabled {\r\n  opacity: 0.5;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.pagination-info {\r\n  color: #718096;\r\n  font-size: 14px;\r\n}\r\n\r\n.modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n  padding: 20px;\r\n}\r\n\r\n.modal {\r\n  background: white;\r\n  width: 100%;\r\n  max-width: 500px;\r\n  max-height: 90vh;\r\n  overflow-y: auto;\r\n  border-radius: 0;\r\n}\r\n\r\n.modal-lg {\r\n  max-width: 800px;\r\n}\r\n\r\n.modal-header {\r\n  padding: 20px;\r\n  border-bottom: 1px solid #e2e8f0;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.modal-header h3 {\r\n  margin: 0;\r\n  font-size: 18px;\r\n  color: #2d3748;\r\n  font-weight: 600;\r\n}\r\n\r\n.modal-close {\r\n  background: none;\r\n  border: none;\r\n  font-size: 24px;\r\n  color: #718096;\r\n  cursor: pointer;\r\n  width: 32px;\r\n  height: 32px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 0;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.modal-close:hover {\r\n  background: #f7fafc;\r\n}\r\n\r\n.modal-body {\r\n  padding: 20px;\r\n}\r\n\r\n.order-detail {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24px;\r\n}\r\n\r\n.detail-section {\r\n  padding-top: 20px;\r\n  border-top: 1px solid #e2e8f0;\r\n}\r\n\r\n.detail-section:first-child {\r\n  padding-top: 0;\r\n  border-top: none;\r\n}\r\n\r\n.detail-section h4 {\r\n  margin: 0 0 16px 0;\r\n  font-size: 16px;\r\n  color: #2d3748;\r\n  font-weight: 600;\r\n}\r\n\r\n.detail-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\r\n  gap: 12px;\r\n}\r\n\r\n.detail-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.detail-item label {\r\n  font-size: 14px;\r\n  color: #718096;\r\n  min-width: 80px;\r\n}\r\n\r\n.detail-item span {\r\n  font-size: 14px;\r\n  color: #2d3748;\r\n}\r\n\r\n.detail-item.full-width {\r\n  grid-column: 1 / -1;\r\n}\r\n\r\n.detail-item .amount {\r\n  font-weight: 700;\r\n  color: #667eea;\r\n  font-size: 18px;\r\n}\r\n\r\n.products-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\r\n}\r\n\r\n.product-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16px;\r\n  padding: 12px;\r\n  background: #f8fafc;\r\n  border-radius: 0;\r\n}\r\n\r\n.product-image {\r\n  width: 60px;\r\n  height: 60px;\r\n  background: white;\r\n  border-radius: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.image-placeholder {\r\n  font-size: 24px;\r\n}\r\n\r\n.product-info {\r\n  flex: 1;\r\n}\r\n\r\n.product-name {\r\n  font-weight: 500;\r\n  color: #2d3748;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.product-price {\r\n  font-size: 13px;\r\n  color: #718096;\r\n}\r\n\r\n.product-quantity {\r\n  font-weight: 600;\r\n  color: #4a5568;\r\n  min-width: 40px;\r\n  text-align: center;\r\n}\r\n\r\n.product-total {\r\n  font-weight: 700;\r\n  color: #667eea;\r\n  min-width: 80px;\r\n  text-align: right;\r\n}\r\n\r\n.remark-content {\r\n  padding: 12px;\r\n  background: #f8fafc;\r\n  border-radius: 0;\r\n  color: #718096;\r\n  line-height: 1.5;\r\n}\r\n\r\n.detail-actions {\r\n  display: flex;\r\n  justify-content: center;\r\n  padding-top: 20px;\r\n  border-top: 1px solid #e2e8f0;\r\n}\r\n\r\n.btn-ship-large {\r\n  padding: 12px 32px;\r\n  background: #667eea;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 0;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.btn-ship-large:hover {\r\n  background: #5a67d8;\r\n}\r\n\r\n.icon {\r\n  font-size: 20px;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  margin-bottom: 6px;\r\n  color: #4a5568;\r\n  font-weight: 500;\r\n  font-size: 14px;\r\n}\r\n\r\n.form-group input,\r\n.form-group select,\r\n.form-group textarea {\r\n  width: 100%;\r\n  padding: 10px;\r\n  border: 1px solid #e2e8f0;\r\n  border-radius: 0;\r\n  font-size: 14px;\r\n  transition: border-color 0.3s;\r\n}\r\n\r\n.form-group input:focus,\r\n.form-group select:focus,\r\n.form-group textarea:focus {\r\n  outline: none;\r\n  border-color: #667eea;\r\n}\r\n\r\n.form-group textarea {\r\n  resize: vertical;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 12px;\r\n  margin-top: 30px;\r\n  padding-top: 20px;\r\n  border-top: 1px solid #e2e8f0;\r\n}\r\n\r\n.btn-cancel {\r\n  padding: 10px 20px;\r\n  border: 1px solid #e2e8f0;\r\n  background: white;\r\n  color: #4a5568;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n}\r\n\r\n.btn-cancel:hover {\r\n  background: #f7fafc;\r\n}\r\n\r\n.btn-submit {\r\n  padding: 10px 20px;\r\n  background: #667eea;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 0;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n}\r\n\r\n.btn-submit:hover {\r\n  background: #5a67d8;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .page-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n  }\r\n\r\n  .order-stats {\r\n    width: 100%;\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .stat-item {\r\n    flex: 1;\r\n    min-width: auto;\r\n  }\r\n\r\n  .filters {\r\n    flex-direction: column;\r\n    align-items: stretch;\r\n  }\r\n\r\n  .search-box {\r\n    min-width: 100%;\r\n  }\r\n\r\n  .filter-group {\r\n    flex-direction: column;\r\n    width: 100%;\r\n  }\r\n\r\n  .filter-select, .btn-export {\r\n    width: 100%;\r\n  }\r\n\r\n  .detail-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .order-actions {\r\n    flex-direction: row;\r\n    flex-wrap: wrap;\r\n  }\r\n}\r\n</style>"],"mappings":";;;;;;;;;AA+WA,OAAOA,KAAI,MAAO,OAAO;AACzB,OAAOC,SAAQ,MAAO,qBAAqB;AAE3C,eAAe;EACbC,IAAI,EAAE,gBAAgB;EACtBC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,OAAO,EAAE,KAAK;MACdC,aAAa,EAAE,EAAE;MACjBC,YAAY,EAAE,KAAK;MACnBC,SAAS,EAAE,KAAK;MAChBC,WAAW,EAAE,CAAC;MACdC,QAAQ,EAAE,EAAE;MAEZC,MAAM,EAAE,EAAE;MACVC,UAAU,EAAE;QACVC,OAAO,EAAE,CAAC;QACVC,OAAO,EAAE,CAAC;QACVC,SAAS,EAAE,CAAC;QACZC,KAAK,EAAE;MACT,CAAC;MAEDC,aAAa,EAAE,IAAI;MACnBC,aAAa,EAAE,KAAK;MACpBC,aAAa,EAAE,IAAI;MAEnBC,QAAQ,EAAE;QACRC,OAAO,EAAE,EAAE;QACXC,eAAe,EAAE;MACnB;IACF;EACF,CAAC;EACDC,QAAQ,EAAE;IACRC,cAAcA,CAAA,EAAG;MACf,IAAIC,QAAO,GAAI,CAAC,GAAG,IAAI,CAACd,MAAM,CAAC;MAE/B,IAAI,IAAI,CAACL,aAAa,EAAE;QACtB,MAAMoB,OAAM,GAAI,IAAI,CAACpB,aAAa,CAACqB,WAAW,CAAC,CAAC;QAChDF,QAAO,GAAIA,QAAQ,CAACG,MAAM,CAACC,KAAI,IAC1BA,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACC,GAAG,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAACN,OAAO,CAAC,IACnDG,KAAK,CAACI,aAAY,IAAKJ,KAAK,CAACI,aAAa,CAACN,WAAW,CAAC,CAAC,CAACK,QAAQ,CAACN,OAAO,CAAC,IAC1EG,KAAK,CAACK,cAAa,IAAKL,KAAK,CAACK,cAAc,CAACF,QAAQ,CAACN,OAAO,CAAC,IAC9DG,KAAK,CAACM,KAAI,IAAKN,KAAK,CAACM,KAAK,CAACC,IAAI,CAACC,IAAG,IAChCA,IAAI,CAAClC,IAAG,IAAKkC,IAAI,CAAClC,IAAI,CAACwB,WAAW,CAAC,CAAC,CAACK,QAAQ,CAACN,OAAO,CAAC,CAC9D,CAAC;MACH;MAEA,IAAI,IAAI,CAACnB,YAAW,KAAM,KAAK,EAAE;QAC/BkB,QAAO,GAAIA,QAAQ,CAACG,MAAM,CAACC,KAAI,IAAKA,KAAK,CAACS,MAAM,CAACP,QAAQ,CAAC,MAAM,IAAI,CAACxB,YAAY,CAAC;MACpF;MAEA,IAAI,IAAI,CAACC,SAAQ,KAAM,KAAK,EAAE;QAC5B,MAAM+B,GAAE,GAAI,IAAIC,IAAI,CAAC,CAAC;QACtB,IAAIC,SAAS;QAEb,QAAQ,IAAI,CAACjC,SAAS;UACpB,KAAK,OAAO;YACViC,SAAQ,GAAI,IAAID,IAAI,CAACD,GAAG,CAACG,WAAW,CAAC,CAAC,EAAEH,GAAG,CAACI,QAAQ,CAAC,CAAC,EAAEJ,GAAG,CAACK,OAAO,CAAC,CAAC,CAAC;YACtE;UACF,KAAK,MAAM;YACTH,SAAQ,GAAI,IAAID,IAAI,CAACD,GAAG,CAACG,WAAW,CAAC,CAAC,EAAEH,GAAG,CAACI,QAAQ,CAAC,CAAC,EAAEJ,GAAG,CAACK,OAAO,CAAC,IAAI,CAAC,CAAC;YAC1E;UACF,KAAK,OAAO;YACVH,SAAQ,GAAI,IAAID,IAAI,CAACD,GAAG,CAACG,WAAW,CAAC,CAAC,EAAEH,GAAG,CAACI,QAAQ,CAAC,IAAI,CAAC,EAAEJ,GAAG,CAACK,OAAO,CAAC,CAAC,CAAC;YAC1E;QACJ;QAEAnB,QAAO,GAAIA,QAAQ,CAACG,MAAM,CAACC,KAAI,IAAK;UAClC,MAAMgB,SAAQ,GAAI,IAAIL,IAAI,CAACX,KAAK,CAACiB,UAAU,CAAC;UAC5C,OAAOD,SAAQ,IAAKJ,SAAS;QAC/B,CAAC,CAAC;MACJ;MAEAhB,QAAQ,CAACsB,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK,IAAIT,IAAI,CAACS,CAAC,CAACH,UAAU,IAAI,IAAIN,IAAI,CAACQ,CAAC,CAACF,UAAU,CAAC,CAAC;MAExE,OAAOrB,QAAQ;IACjB,CAAC;IAEDyB,eAAeA,CAAA,EAAG;MAChB,MAAMC,KAAI,GAAI,CAAC,IAAI,CAAC1C,WAAU,GAAI,CAAC,IAAI,IAAI,CAACC,QAAQ;MACpD,MAAM0C,GAAE,GAAID,KAAI,GAAI,IAAI,CAACzC,QAAQ;MACjC,OAAO,IAAI,CAACc,cAAc,CAAC6B,KAAK,CAACF,KAAK,EAAEC,GAAG,CAAC;IAC9C,CAAC;IAEDE,UAAUA,CAAA,EAAG;MACX,OAAOC,IAAI,CAACC,IAAI,CAAC,IAAI,CAAChC,cAAc,CAACiC,MAAK,GAAI,IAAI,CAAC/C,QAAQ,CAAC;IAC9D;EACF,CAAC;EACDgD,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,UAAU,CAAC,CAAC;EACnB,CAAC;EACDC,OAAO,EAAE;IACPC,UAAUA,CAACC,UAAU,EAAE;MACrB,IAAI,CAACA,UAAU,EAAE,OAAO,EAAE;MAC1B,IAAI;QACF,MAAMC,IAAG,GAAI,IAAIvB,IAAI,CAACsB,UAAU,CAAC;QACjC,OAAOC,IAAI,CAACC,kBAAkB,CAAC,OAAO,CAAC;MACzC,EAAE,OAAOC,CAAC,EAAE;QACV,OAAOH,UAAU;MACnB;IACF,CAAC;IAEDI,cAAcA,CAACJ,UAAU,EAAE;MACzB,IAAI,CAACA,UAAU,EAAE,OAAO,EAAE;MAC1B,IAAI;QACF,MAAMC,IAAG,GAAI,IAAIvB,IAAI,CAACsB,UAAU,CAAC;QACjC,OAAOC,IAAI,CAACI,cAAc,CAAC,OAAO,EAAE;UAClCC,IAAI,EAAE,SAAS;UACfC,KAAK,EAAE,SAAS;UAChBC,GAAG,EAAE,SAAS;UACdC,IAAI,EAAE,SAAS;UACfC,MAAM,EAAE;QACV,CAAC,CAAC;MACJ,EAAE,OAAOP,CAAC,EAAE;QACV,OAAOH,UAAU;MACnB;IACF,CAAC;IAEDW,cAAcA,CAACnC,MAAM,EAAE;MACrB,MAAMoC,SAAQ,GAAI;QAChB,CAAC,EAAE,SAAS;QACZ,CAAC,EAAE,SAAS;QACZ,CAAC,EAAE,WAAW;QACd,CAAC,EAAE,WAAW;QACd,CAAC,EAAE;MACL,CAAC;MACD,OAAOA,SAAS,CAACpC,MAAM,KAAK,SAAS;IACvC,CAAC;IAEDqC,aAAaA,CAACrC,MAAM,EAAE;MACpB,MAAMoC,SAAQ,GAAI;QAChB,CAAC,EAAE,KAAK;QACR,CAAC,EAAE,KAAK;QACR,CAAC,EAAE,KAAK;QACR,CAAC,EAAE,KAAK;QACR,CAAC,EAAE;MACL,CAAC;MACD,OAAOA,SAAS,CAACpC,MAAM,KAAK,MAAM;IACpC,CAAC;IAED;IACAsC,aAAaA,CAAA,EAAG;MACd,MAAMC,YAAW,GAAIC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAAC;MACrE,IAAI,CAACJ,YAAY,EAAE,OAAO,IAAI;MAC9B,OAAOA,YAAY,CAACK,GAAE,IAAKL,YAAY,CAACM,EAAE;IAC5C,CAAC;IAED,MAAMxB,UAAUA,CAAA,EAAG;MACjB,IAAI,CAACtD,OAAM,GAAI,IAAI;MACnB,MAAM6E,GAAE,GAAI,IAAI,CAACN,aAAa,CAAC,CAAC;MAEhC,IAAI,CAACM,GAAG,EAAE;QACRE,OAAO,CAACC,KAAK,CAAC,SAAS,CAAC;QACxB,IAAI,CAAC1E,MAAK,GAAI,EAAE;QAChB;MACF;MAEA,IAAI;QACF;QACA,MAAM2E,gBAAe,GAAI,MAAMrF,KAAK,CAACsF,GAAG,CAACrF,SAAS,CAACsF,QAAQ,CAACC,WAAW,CAACP,GAAG,CAAC,CAAC;QAC7E,MAAMQ,UAAS,GAAI,CAAC,CAAC;QACrB,IAAIJ,gBAAgB,CAAClF,IAAI,CAACuF,IAAG,KAAM,CAAC,EAAE;UAClC,MAAMC,QAAO,GAAIN,gBAAgB,CAAClF,IAAI,CAACA,IAAG,IAAK,EAAE;UACjDwF,QAAQ,CAACC,OAAO,CAACC,CAAA,IAAK;YAClB,IAAIA,CAAC,CAACC,GAAG,EAAEL,UAAU,CAACI,CAAC,CAACC,GAAG,IAAID,CAAC;UACpC,CAAC,CAAC;QACN;;QAEA;QACA,MAAME,QAAO,GAAI,MAAM/F,KAAK,CAACsF,GAAG,CAACrF,SAAS,CAACsF,QAAQ,CAACS,SAAS,CAACf,GAAG,CAAC,CAAC;QACnEE,OAAO,CAACc,GAAG,CAAC,aAAa,EAAEF,QAAQ,CAAC5F,IAAI,CAACA,IAAI,CAAC;QAE9C,IAAI4F,QAAQ,CAAC5F,IAAI,CAACuF,IAAG,KAAM,CAAC,EAAE;UAC5B,MAAMhF,MAAK,GAAIqF,QAAQ,CAAC5F,IAAI,CAACA,IAAG,IAAK,EAAE;;UAEvC;UACA,MAAM+F,cAAa,GAAI,EAAE;UAEzBf,OAAO,CAACc,GAAG,CAAC,mBAAmB,EAAEE,MAAM,CAACC,IAAI,CAACX,UAAU,CAAC,CAAC;;UAEzD;UACA,MAAMY,gBAAe,GAAI,IAAI,CAACC,mBAAmB,CAAC5F,MAAM,CAAC,CAAC6F,GAAG,CAAC3E,KAAI,IAAK;YACpE;YACA;YACA,IAAIA,KAAK,CAACM,KAAI,IAAKN,KAAK,CAACM,KAAK,CAACsB,MAAK,GAAI,CAAC,EAAE;cACvC,MAAMgD,aAAY,GAAI5E,KAAK,CAACM,KAAK,CAACsB,MAAM;cACxC5B,KAAK,CAACM,KAAI,GAAIN,KAAK,CAACM,KAAK,CAACP,MAAM,CAACS,IAAG,IAAK;gBACrC;gBACA,MAAMqE,MAAK,GAAIrE,IAAI,CAAC8C,EAAC,IAAK9C,IAAI,CAAC0D,GAAG;gBAClC,MAAMY,KAAI,GAAIjB,UAAU,CAACgB,MAAM,KAAKhB,UAAU,CAACkB,MAAM,CAACF,MAAM,CAAC,KAAKhB,UAAU,CAACmB,MAAM,CAACH,MAAM,CAAC,CAAC;gBAC5F;;gBAEA;gBACA;gBACA,OAAOC,KAAI,IAAKP,MAAM,CAACC,IAAI,CAACX,UAAU,CAAC,CAACjC,MAAK,KAAM,CAAC;cACxD,CAAC,CAAC;cAEF,IAAI5B,KAAK,CAACM,KAAK,CAACsB,MAAK,GAAIgD,aAAa,EAAE;gBACpCrB,OAAO,CAACc,GAAG,CAAC,MAAMrE,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACsD,EAAE,QAAQsB,aAAY,GAAI5E,KAAK,CAACM,KAAK,CAACsB,MAAM,UAAU,CAAC;cAChG;YACJ;;YAEA;YACA;YACA;;YAEA;YACA,IAAI5B,KAAK,CAACM,KAAI,IAAKN,KAAK,CAACM,KAAK,CAACsB,MAAK,GAAI,CAAC,EAAE;cACvC5B,KAAK,CAACM,KAAK,CAAC0D,OAAO,CAACxD,IAAG,IAAK;gBACxB;gBACA,IAAI,CAAC,CAACA,IAAI,CAAClC,IAAG,IAAKkC,IAAI,CAAClC,IAAG,KAAM,MAAK,IAAKkC,IAAI,CAAClC,IAAG,KAAM,IAAI,KAAKuF,UAAU,CAACrD,IAAI,CAAC8C,EAAE,CAAC,EAAE;kBACnF9C,IAAI,CAAClC,IAAG,GAAIuF,UAAU,CAACrD,IAAI,CAAC8C,EAAE,CAAC,CAAChF,IAAI;gBACxC;cACJ,CAAC,CAAC;YACN;;YAEA;YACA,MAAM2G,YAAW,GAAIjF,KAAK,CAACM,KAAI,IAAKN,KAAK,CAACM,KAAK,CAACC,IAAI,CAAC2E,CAAA,IAAKA,CAAC,CAAC5G,IAAG,IAAK4G,CAAC,CAAC5G,IAAG,KAAM,MAAK,IAAK4G,CAAC,CAAC5G,IAAG,KAAM,IAAI,CAAC;YACzG,IAAI,CAAC2G,YAAW,KAAMjF,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACsD,EAAE,CAAC,EAAE;cAC1C,MAAMrD,GAAE,GAAID,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACsD,EAAE;cACjCgB,cAAc,CAACa,IAAI,CACf/G,KAAK,CAACsF,GAAG,CAACrF,SAAS,CAAC2B,KAAK,CAACoF,cAAc,CAACnF,GAAG,CAAC,EACxCoF,IAAI,CAACC,GAAE,IAAK;gBACT,IAAIA,GAAG,CAAC/G,IAAI,CAACuF,IAAG,KAAM,KAAKwB,GAAG,CAAC/G,IAAI,CAACA,IAAI,EAAE;kBACtC,MAAMgH,MAAK,GAAID,GAAG,CAAC/G,IAAI,CAACA,IAAI;kBAC5B,IAAID,IAAG,GAAI,EAAE;kBACb,IAAIiH,MAAM,CAACjF,KAAI,IAAKiF,MAAM,CAACjF,KAAK,CAACsB,MAAM,EAAEtD,IAAG,GAAIiH,MAAM,CAACjF,KAAK,CAAC,CAAC,CAAC,CAAChC,IAAI,MAC/D,IAAIiH,MAAM,CAACC,YAAY,EAAElH,IAAG,GAAIiH,MAAM,CAACC,YAAY;kBAExD,IAAIlH,IAAI,EAAE;oBACN;oBACA,IAAI,CAAC0B,KAAK,CAACM,KAAI,IAAK,CAACN,KAAK,CAACM,KAAK,CAACsB,MAAM,EAAE;sBACrC5B,KAAK,CAACM,KAAI,GAAI,CAAC;wBAAEhC,IAAI,EAAEA,IAAI;wBAAEmH,QAAQ,EAAE;sBAAE,CAAC,CAAC;oBAC/C,OAAO;sBACHzF,KAAK,CAACM,KAAK,CAAC,CAAC,CAAC,CAAChC,IAAG,GAAIA,IAAI;oBAC9B;kBACJ;gBACJ;cACJ,CAAC,EACAoH,KAAK,CAACtD,CAAA,IAAKmB,OAAO,CAACoC,IAAI,CAAC,QAAQ1F,GAAG,OAAO,EAAEmC,CAAC,CAAC,CACvD,CAAC;YACL;YACA,OAAOpC,KAAK;UACf,CAAC,CAAC;;UAEF;UACA;UACA,IAAIsE,cAAc,CAAC1C,MAAK,GAAI,CAAC,EAAE;YAC3B2B,OAAO,CAACc,GAAG,CAAC,QAAQC,cAAc,CAAC1C,MAAM,cAAc,CAAC;YACxDgE,OAAO,CAACC,UAAU,CAACvB,cAAc,CAAC,CAACe,IAAI,CAAC,MAAM;cAC1C9B,OAAO,CAACc,GAAG,CAAC,UAAU,CAAC;cACvB;cACA,IAAI,CAACvF,MAAK,GAAI,CAAC,GAAG,IAAI,CAACA,MAAM,CAAC;YAClC,CAAC,CAAC;UACN;;UAEA;UACA,IAAI,CAACA,MAAM,CAACkF,OAAO,CAAChE,KAAI,IAAK;YACzB,IAAIA,KAAK,CAACM,KAAI,IAAKN,KAAK,CAACM,KAAK,CAACsB,MAAK,GAAI,CAAC,EAAE;cACvC5B,KAAK,CAACM,KAAK,CAAC0D,OAAO,CAACxD,IAAG,IAAK;gBACxB;gBACA,IAAI,CAACA,IAAI,CAACsF,KAAI,IAAKC,UAAU,CAACvF,IAAI,CAACsF,KAAK,MAAM,CAAC,EAAE;kBAC7C;kBACA,IAAI9F,KAAK,CAACM,KAAK,CAACsB,MAAK,KAAM,KAAK5B,KAAK,CAACgG,MAAK,GAAI,CAAC,EAAE;oBAC9CxF,IAAI,CAACsF,KAAI,GAAI,CAAC9F,KAAK,CAACgG,MAAK,GAAIxF,IAAI,CAACiF,QAAQ,EAAEQ,OAAO,CAAC,CAAC,CAAC;kBAC1D;kBACA;kBAAA,KACK,IAAIpC,UAAU,CAACrD,IAAI,CAAC8C,EAAE,CAAC,EAAE;oBAC1B9C,IAAI,CAACsF,KAAI,GAAIjC,UAAU,CAACrD,IAAI,CAAC8C,EAAE,CAAC,CAACwC,KAAK;kBAC1C;gBACJ;gBACA;gBACAtF,IAAI,CAAC0F,QAAO,GAAI,CAAC1F,IAAI,CAACsF,KAAI,GAAItF,IAAI,CAACiF,QAAQ,EAAEQ,OAAO,CAAC,CAAC,CAAC;cAC3D,CAAC,CAAC;YACN;UACJ,CAAC,CAAC;;UAEF;UACA;UACA;UACA,MAAME,WAAU,GAAI1B,gBAAgB,CAAC1E,MAAM,CAACC,KAAI,IAAKA,KAAK,CAAC;UAE3DuD,OAAO,CAACc,GAAG,CAAC,eAAe,EAAE8B,WAAW,CAAC;UACzC,IAAI,CAACrH,MAAK,GAAIqH,WAAW;UACzB,IAAI,CAACC,cAAc,CAAC,CAAC;QACvB,OAAO;UACL7C,OAAO,CAACoC,IAAI,CAAC,SAAS,EAAExB,QAAQ,CAAC5F,IAAI,CAAC8H,OAAO,CAAC;UAC9C,IAAI,CAACvH,MAAK,GAAI,EAAE;QAClB;MACF,EAAE,OAAO0E,KAAK,EAAE;QACdD,OAAO,CAACC,KAAK,CAAC,WAAW,EAAEA,KAAK,CAAC;QACjC;QACA,IAAI,CAAC1E,MAAK,GAAI,EAAE;MAClB,UAAU;QACR,IAAI,CAACN,OAAM,GAAI,KAAK;MACtB;IACF,CAAC;IAED;IACAkG,mBAAmBA,CAAC5F,MAAM,EAAE;MAC1ByE,OAAO,CAACc,GAAG,CAAC,WAAW,EAAEvF,MAAM,CAAC;MAChC,OAAOA,MAAM,CAAC6F,GAAG,CAAC3E,KAAI,IAAK;QACzBuD,OAAO,CAACc,GAAG,CAAC,WAAW,EAAErE,KAAK,CAAC;QAC/B;QACA,IAAIA,KAAK,CAACsD,EAAC,KAAM,KAAKtD,KAAK,CAACC,GAAE,KAAM,KAAKD,KAAK,CAACC,GAAE,KAAM,IAAI,EAAE;UAC3DsD,OAAO,CAACc,GAAG,CAAC,oBAAoB,CAAC;UACjCd,OAAO,CAACc,GAAG,CAAC,SAAS,EAAEpB,IAAI,CAACqD,SAAS,CAACtG,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;UACtDuD,OAAO,CAACc,GAAG,CAAC,QAAQ,EAAEE,MAAM,CAACC,IAAI,CAACxE,KAAK,CAAC,CAAC;UACzC;UACAuD,OAAO,CAACc,GAAG,CAAC,cAAc,EAAErE,KAAK,CAACM,KAAK,CAAC;UACxCiD,OAAO,CAACc,GAAG,CAAC,iBAAiB,EAAErE,KAAK,CAAC+D,QAAQ,CAAC;UAC9CR,OAAO,CAACc,GAAG,CAAC,gBAAgB,EAAErE,KAAK,CAACuG,OAAO,CAAC;UAC5ChD,OAAO,CAACc,GAAG,CAAC,cAAc,EAAErE,KAAK,CAACwG,KAAK,CAAC;UACxCjD,OAAO,CAACc,GAAG,CAAC,kBAAkB,EAAErE,KAAK,CAACyG,SAAS,CAAC;UAChDlD,OAAO,CAACc,GAAG,CAAC,gBAAgB,EAAErE,KAAK,CAAC0G,OAAO,CAAC;QAC9C;QACA;QACA,MAAMC,YAAW,GAAI3G,KAAK,CAACI,aAAY,IAAKJ,KAAK,CAAC2G,YAAW,IAAK3G,KAAK,CAAC4G,QAAO,IAAK,EAAE;QACtF,MAAMC,aAAY,GAAI7G,KAAK,CAACK,cAAa,IAAKL,KAAK,CAAC6G,aAAY,IAAK7G,KAAK,CAAC8G,KAAI,IAAK,EAAE;QACtF,MAAMC,eAAc,GAAI/G,KAAK,CAACgH,gBAAe,IAAKhH,KAAK,CAAC+G,eAAc,IAAK/G,KAAK,CAACiH,OAAM,IAAK,EAAE;;QAE9F;QACA,MAAMC,OAAM,GAAIlH,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACsD,EAAC,IAAK,EAAE;;QAE3C;QACA,MAAM0C,MAAK,GAAIhG,KAAK,CAACgG,MAAK,IAAKhG,KAAK,CAACb,KAAI,IAAK,CAAC;;QAE/C;QACA,IAAIgI,SAAQ,GAAInH,KAAK,CAACiB,UAAS,IAAKjB,KAAK,CAACoH,SAAQ,IAAKpH,KAAK,CAACqH,UAAS,IAAKrH,KAAK,CAACmH,SAAQ,IAAKnH,KAAK,CAACsH,IAAG,IAAKtH,KAAK,CAACuH,SAAQ,IAAK,EAAE;;QAEjI;QACA,IAAI,OAAOJ,SAAQ,KAAM,QAAQ,EAAE;UACjCA,SAAQ,GAAI,IAAIxG,IAAI,CAACwG,SAAS,CAAC,CAACK,WAAW,CAAC,CAAC;QAC/C;;QAEA;QACA,IAAI,CAACL,SAAS,EAAE;UACd;UACAA,SAAQ,GAAI,IAAIxG,IAAI,CAAC,CAAC,CAAC6G,WAAW,CAAC,CAAC;QACtC;;QAEA;QACA,MAAM/G,MAAK,GAAIT,KAAK,CAACS,MAAK,KAAMgH,SAAQ,GAAIzH,KAAK,CAACS,MAAK,GAAI,CAAC;;QAE5D;QACA,IAAIH,KAAI,GAAI,EAAE;QACd;QACA,IAAIoH,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAACM,KAAK,CAAC,EAAE;UAC9BA,KAAI,GAAIN,KAAK,CAACM,KAAK;QACrB,OAAO,IAAIoH,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAAC+D,QAAQ,CAAC,EAAE;UACxCzD,KAAI,GAAIN,KAAK,CAAC+D,QAAQ;QACxB,OAAO,IAAI2D,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAAC4H,UAAU,CAAC,EAAE;UAC1C;UACAtH,KAAI,GAAIN,KAAK,CAAC4H,UAAU;QAC1B,OAAO,IAAIF,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAAC6H,WAAW,CAAC,EAAE;UAC3C;UACAvH,KAAI,GAAIN,KAAK,CAAC6H,WAAW;QAC3B,OAAO,IAAI7H,KAAK,CAACuG,OAAM,IAAK,OAAOvG,KAAK,CAACuG,OAAM,KAAM,QAAQ,EAAE;UAC7D;UACAjG,KAAI,GAAI,CAACN,KAAK,CAACuG,OAAO,CAAC;QACzB,OAAO,IAAIvG,KAAK,CAACwG,KAAI,IAAKkB,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAACwG,KAAK,CAAC,EAAE;UACpDlG,KAAI,GAAIN,KAAK,CAACwG,KAAK;QACrB,OAAO,IAAIxG,KAAK,CAACwG,KAAI,IAAK,OAAOxG,KAAK,CAACwG,KAAI,KAAM,QAAQ,EAAE;UACzD;UACAlG,KAAI,GAAI,CAACN,KAAK,CAACwG,KAAK,CAAC;QACvB,OAAO,IAAIxG,KAAK,CAAC8H,SAAQ,IAAKJ,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAAC8H,SAAS,CAAC,EAAE;UAC5D;UACAxH,KAAI,GAAIN,KAAK,CAAC8H,SAAS;QACzB,OAAO,IAAI9H,KAAK,CAAC8H,SAAQ,IAAK,OAAO9H,KAAK,CAAC8H,SAAQ,KAAM,QAAQ,EAAE;UACjE;UACAxH,KAAI,GAAI,CAACN,KAAK,CAAC8H,SAAS,CAAC;QAC3B,OAAO;UACL;UACA,MAAMC,gBAAe,GAAI/H,KAAK,CAACgI,UAAS,IAAKhI,KAAK,CAACwF,YAAW,IAAKxF,KAAK,CAACiI,aAAY,IAC9DjI,KAAK,CAACkI,QAAO,IAAKlI,KAAK,CAACmI,UAAS,IAAKnI,KAAK,CAACoI,WAAU,IACtDpI,KAAK,CAACyG,SAAQ,IAAKzG,KAAK,CAACqI,WAAU,IAAKrI,KAAK,CAACsI,YAAY;UAEjF,IAAIP,gBAAgB,EAAE;YACpB;YACAzH,KAAI,GAAI,CAAC;cAAC,GAAGN;YAAK,CAAC,CAAC;UACtB;QACF;;QAEA;QACA,MAAMuI,eAAc,GAAIjI,KAAK,CAACqE,GAAG,CAACnE,IAAG,IAAK;UACxC,IAAI,CAACA,IAAG,IAAK,OAAOA,IAAG,KAAM,QAAQ,EAAE;YACrC;YACA,OAAO;cACL8C,EAAE,EAAE,EAAE;cACNhF,IAAI,EAAE,MAAM;cACZkK,KAAK,EAAE,EAAE;cACT1C,KAAK,EAAE,CAAC;cACRL,QAAQ,EAAE,CAAC;cACXS,QAAQ,EAAE;YACZ,CAAC;UACH;UAEA,OAAO;YACL5C,EAAE,EAAE9C,IAAI,CAAC8C,EAAC,IAAK9C,IAAI,CAACwH,UAAS,IAAKxH,IAAI,CAAC0H,QAAO,IAAK1H,IAAI,CAACiG,SAAQ,IAAKjG,IAAI,CAACkG,OAAM,IAAK,EAAE;YACvFrD,GAAG,EAAE7C,IAAI,CAAC6C,GAAG;YAAE;YACf/E,IAAI,EAAEkC,IAAI,CAAClC,IAAG,IAAKkC,IAAI,CAACgF,YAAW,IAAKhF,IAAI,CAAC2H,UAAS,IAAK3H,IAAI,CAAC6H,WAAU,IACpE7H,IAAI,CAACiI,SAAQ,IAAKjI,IAAI,CAAC+F,OAAM,IAAK/F,IAAI,CAACkI,aAAY,IAAK,MAAM;YACpEF,KAAK,EAAEhI,IAAI,CAACgI,KAAI,IAAKhI,IAAI,CAACmI,KAAI,IAAKnI,IAAI,CAACoI,UAAS,IAAKpI,IAAI,CAACqI,IAAG,IACxDrI,IAAI,CAACsI,aAAY,IAAKtI,IAAI,CAACuI,UAAS,IAAK,EAAE;YACjDjD,KAAK,EAAEC,UAAU,CAACvF,IAAI,CAACsF,KAAI,IAAKtF,IAAI,CAACwI,UAAS,IAAKxI,IAAI,CAACwF,MAAK,IAC9CxF,IAAI,CAACyH,aAAY,IAAKzH,IAAI,CAAC4H,WAAU,IAAK5H,IAAI,CAAC8H,YAAW,IAC1D9H,IAAI,CAACyI,UAAS,KAAMjD,MAAK,GAAI,KAAK1F,KAAK,CAACsB,MAAK,KAAM,IAAIoE,MAAK,IAAKxF,IAAI,CAACiF,QAAO,IAAK,CAAC,IAAI,CAAC,CAAC,CAAC;YACzGA,QAAQ,EAAEyD,QAAQ,CAAC1I,IAAI,CAACiF,QAAO,IAAKjF,IAAI,CAAC2I,KAAI,IAAK3I,IAAI,CAAC4I,GAAE,IACvC5I,IAAI,CAAC6I,WAAU,IAAK7I,IAAI,CAAC8I,SAAQ,IAAK,CAAC,CAAC;YAC1DpD,QAAQ,EAAEH,UAAU,CAACvF,IAAI,CAAC0F,QAAO,IAAM1F,IAAI,CAACsF,KAAI,GAAItF,IAAI,CAACiF,QAAQ,IAC7CjF,IAAI,CAACwI,UAAS,GAAIxI,IAAI,CAACiF,QAAQ,IAAK,CAAC;UAC3D,CAAC;QACH,CAAC,CAAC;;QAEF;QACA,IAAI8C,eAAe,CAAC3G,MAAK,KAAM,CAAC,EAAE;UAChC2G,eAAe,CAACpD,IAAI,CAAC;YACnB7B,EAAE,EAAE,EAAE;YACNhF,IAAI,EAAE,MAAM;YACZkK,KAAK,EAAE,EAAE;YACT1C,KAAK,EAAE,CAAC;YACRL,QAAQ,EAAE,CAAC;YACXS,QAAQ,EAAE;UACZ,CAAC,CAAC;QACJ;QAEA,OAAO;UACL,GAAGlG,KAAK;UACRC,GAAG,EAAEiH,OAAO;UACZ9G,aAAa,EAAEuG,YAAY;UAC3BtG,cAAc,EAAEwG,aAAa;UAC7BG,gBAAgB,EAAED,eAAe;UACjCf,MAAM,EAAEA,MAAM;UACd/E,UAAU,EAAEkG,SAAS;UACrB1G,MAAM,EAAEA,MAAM;UACdH,KAAK,EAAEiI;QACT,CAAC;MACH,CAAC,CAAC;IACJ,CAAC;IAEDnC,cAAcA,CAAA,EAAG;MACf,MAAMmD,KAAI,GAAI;QACZvK,OAAO,EAAE,CAAC;QACVC,OAAO,EAAE,CAAC;QACVC,SAAS,EAAE,CAAC;QACZC,KAAK,EAAE;MACT,CAAC;MAED,IAAI,CAACL,MAAM,CAACkF,OAAO,CAAChE,KAAI,IAAK;QAC3B,IAAIA,KAAK,CAACS,MAAK,KAAM,CAAC,EAAE8I,KAAK,CAACvK,OAAO,EAAE;QACvC,IAAIgB,KAAK,CAACS,MAAK,KAAM,CAAC,EAAE8I,KAAK,CAACtK,OAAO,EAAE;QACvC,IAAIe,KAAK,CAACS,MAAK,KAAM,CAAC,EAAE8I,KAAK,CAACrK,SAAS,EAAE;QACzCqK,KAAK,CAACpK,KAAK,EAAE;MACf,CAAC,CAAC;MAEF,IAAI,CAACJ,UAAS,GAAIwK,KAAK;IACzB,CAAC;IAEDC,SAASA,CAACxJ,KAAK,EAAE;MACf,IAAI,CAACV,aAAY,GAAIU,KAAK;MAC1B,IAAI,CAACT,QAAO,GAAI;QACdC,OAAO,EAAE,EAAE;QACXC,eAAe,EAAE,EAAE;QACnBgK,IAAI,EAAE;MACR,CAAC;MACD,IAAI,CAACpK,aAAY,GAAI,IAAI;IAC3B,CAAC;IAED,MAAMqK,eAAeA,CAAA,EAAG;MACtB,IAAI,CAAC,IAAI,CAACC,gBAAgB,CAAC,CAAC,EAAE;QAC5B;MACF;MAEA,IAAI;QACF,MAAM1J,GAAE,GAAIiJ,QAAQ,CAAC,IAAI,CAAC5J,aAAa,CAACW,GAAG,EAAE,EAAE,CAAC;QAChD,MAAM2J,GAAE,GAAIvL,SAAS,CAAC2B,KAAK,CAAC6J,eAAe,CAAC5J,GAAG,CAAC;QAChD,MAAM6J,OAAM,GAAI;UACd;UACAC,gBAAgB,EAAE,IAAI,CAACxK,QAAQ,CAACC,OAAO;UACvCwK,cAAc,EAAE,IAAI,CAACzK,QAAQ,CAACE,eAAe;UAC7C;UACAD,OAAO,EAAE,IAAI,CAACD,QAAQ,CAACC;QACzB,CAAC;QAED,MAAM2E,QAAO,GAAI,MAAM/F,KAAK,CAAC6L,GAAG,CAACL,GAAG,EAAEE,OAAO,EAAE;UAC7CI,MAAM,EAAE;YACN1K,OAAO,EAAE,IAAI,CAACD,QAAQ,CAACC,OAAO;YAC9BwK,cAAc,EAAE,IAAI,CAACzK,QAAQ,CAACE,eAAe;YAC7CA,eAAe,EAAE,IAAI,CAACF,QAAQ,CAACE;UACjC;QACF,CAAC,CAAC;QAEF,IAAI0E,QAAQ,CAAC5F,IAAI,CAACuF,IAAG,KAAM,CAAC,EAAE;UAC5B,IAAI,CAACxE,aAAa,CAACmB,MAAK,GAAI,CAAC;UAC7B,IAAI,CAACnB,aAAa,CAACE,OAAM,GAAI,IAAI,CAACD,QAAQ,CAACC,OAAO;UAClD,IAAI,CAACF,aAAa,CAACG,eAAc,GAAI,IAAI,CAACF,QAAQ,CAACE,eAAe;UAClE,IAAI,CAACJ,aAAY,GAAI,KAAK;UAC1B,IAAI,CAAC+G,cAAc,CAAC,CAAC;UACrB+D,KAAK,CAAC,OAAO,CAAC;QAChB,OAAO;UACL,MAAMC,aAAY,GAAIjG,QAAQ,CAAC5F,IAAI,CAAC8H,OAAM,IAAKlC,QAAQ,CAAC5F,IAAI,CAAC8L,GAAE,IAAK,MAAM;UAC1EF,KAAK,CAACC,aAAa,CAAC;QACtB;MACF,EAAE,OAAO5G,KAAK,EAAE;QACdD,OAAO,CAACC,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/B2G,KAAK,CAAC,oBAAoB,CAAC;MAC7B;IACF,CAAC;IAEDR,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAAC,IAAI,CAACpK,QAAQ,CAACC,OAAO,CAAC8K,IAAI,CAAC,CAAC,EAAE;QACjCH,KAAK,CAAC,SAAS,CAAC;QAChB,OAAO,KAAK;MACd;MAEA,IAAI,CAAC,IAAI,CAAC5K,QAAQ,CAACE,eAAe,CAAC6K,IAAI,CAAC,CAAC,EAAE;QACzCH,KAAK,CAAC,QAAQ,CAAC;QACf,OAAO,KAAK;MACd;MAEA,OAAO,IAAI;IACb,CAAC;IAEDI,YAAYA,CAACvK,KAAK,EAAE;MAClB,MAAMC,GAAE,GAAID,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACsD,EAAE;MACjC,IAAI,CAACrD,GAAG,EAAE;QACRkK,KAAK,CAAC,QAAQ,CAAC;QACf;MACF;MACA/L,KAAK,CAACsF,GAAG,CAACrF,SAAS,CAAC2B,KAAK,CAACwK,iBAAiB,CAACvK,GAAG,CAAC,EAC7CoF,IAAI,CAACC,GAAE,IAAK;QACX,IAAIA,GAAG,CAAC/G,IAAG,IAAK+G,GAAG,CAAC/G,IAAI,CAACuF,IAAG,KAAM,KAAKwB,GAAG,CAAC/G,IAAI,CAACA,IAAI,EAAE;UACpD,MAAMkM,IAAG,GAAInF,GAAG,CAAC/G,IAAI,CAACA,IAAI;UAC1B,MAAMmM,OAAM,GAAID,IAAI,CAACE,iBAAgB,IAAKF,IAAI,CAACV,gBAAe,IAAKU,IAAI,CAACjL,OAAM,IAAK,KAAK;UACxF,MAAMoL,QAAO,GAAIH,IAAI,CAAChL,eAAc,IAAKgL,IAAI,CAACT,cAAa,IAAK,KAAK;UACrE,MAAMa,OAAM,GAAIJ,IAAI,CAACK,YAAW,IAAKL,IAAI,CAACM,WAAU,IAAK,EAAE;UAC3D,MAAMC,OAAM,GAAIP,IAAI,CAACQ,YAAW,IAAKR,IAAI,CAACS,WAAU,IAAK,EAAE;UAC3Df,KAAK,CAAC,OAAOlK,GAAG,UAAUyK,OAAO,SAASE,QAAQ,QAAQ,IAAI,CAACvI,cAAc,CAACwI,OAAO,CAAC,QAAQ,IAAI,CAACxI,cAAc,CAAC2I,OAAO,CAAC,EAAE,CAAC;QAC/H,OAAO;UACLb,KAAK,CAAC,OAAOlK,GAAG,SAAS,CAAC;QAC5B;MACF,CAAC,EACAyF,KAAK,CAAC,MAAM;QACXyE,KAAK,CAAC,OAAOlK,GAAG,SAAS,CAAC;MAC5B,CAAC,CAAC;IACN,CAAC;IAED,MAAMkL,YAAYA,CAACnL,KAAK,EAAE;MACxB,IAAI,CAACA,KAAK,CAACoL,GAAE,IAAK,CAACpL,KAAK,CAACM,KAAK,EAAE;QAC9B6J,KAAK,CAAC,QAAQ,CAAC;QACf;MACF;MACA,MAAMiB,GAAE,GAAIpL,KAAK,CAACoL,GAAG;MACrB,MAAMC,QAAO,GAAI,EAAE;MACnB,KAAK,MAAM7K,IAAG,IAAKR,KAAK,CAACM,KAAK,EAAE;QAC9B,MAAM4D,GAAE,GAAI1D,IAAI,CAAC8C,EAAC,IAAK9C,IAAI,CAAC0D,GAAG;QAC/B,IAAI,CAACA,GAAG,EAAE;QACV,IAAI;UACF,MAAMoB,GAAE,GAAI,MAAMlH,KAAK,CAACsF,GAAG,CAACrF,SAAS,CAACiN,QAAQ,CAACC,eAAe,CAACH,GAAG,EAAElH,GAAG,CAAC,CAAC;UACzE,IAAIoB,GAAG,CAAC/G,IAAG,IAAK+G,GAAG,CAAC/G,IAAI,CAACuF,IAAG,KAAM,KAAKwB,GAAG,CAAC/G,IAAI,CAACA,IAAI,EAAE;YACpD,MAAMiN,EAAC,GAAIlG,GAAG,CAAC/G,IAAI,CAACA,IAAI;YACxB8M,QAAQ,CAAClG,IAAI,CAAC,GAAG3E,IAAI,CAAClC,IAAG,IAAK,IAAI,IAAIkN,EAAE,CAACC,IAAG,IAAK,CAAC,KAAKD,EAAE,CAACE,OAAM,IAAK,KAAK,EAAE,CAAC;UAC/E;QACF,EAAE,OAAOtJ,CAAC,EAAE;UACV;QAAA;MAEJ;MACA,IAAIiJ,QAAQ,CAACzJ,MAAK,KAAM,CAAC,EAAE;QACzBuI,KAAK,CAAC,eAAe,CAAC;MACxB,OAAO;QACLA,KAAK,CAACkB,QAAQ,CAACM,IAAI,CAAC,IAAI,CAAC,CAAC;MAC5B;IACF,CAAC;IAEDC,WAAWA,CAAC5L,KAAK,EAAE;MACjB,IAAI6L,OAAO,CAAC,YAAY7L,KAAK,CAACC,GAAG,KAAK,CAAC,EAAE;QACvC,IAAI,CAAC6L,gBAAgB,CAAC9L,KAAK,CAAC;MAC9B;IACF,CAAC;IAED,MAAM8L,gBAAgBA,CAAC9L,KAAK,EAAE;MAC5B,MAAMqD,GAAE,GAAI,IAAI,CAACN,aAAa,CAAC,CAAC;MAEhC,IAAI,CAACM,GAAG,EAAE;QACR8G,KAAK,CAAC,SAAS,CAAC;QAChB;MACF;MAEA,IAAI;QACF;QACA;QACA,MAAMhG,QAAO,GAAI,MAAM/F,KAAK,CAAC6L,GAAG,CAC5B,eAAejK,KAAK,CAACC,GAAG,eAAeD,KAAK,CAACoL,GAAG,EACpD,CAAC;QAED,IAAIjH,QAAQ,CAAC5F,IAAI,CAACuF,IAAG,KAAM,CAAC,EAAE;UAC5B9D,KAAK,CAACS,MAAK,GAAI,CAAC,EAAE;UAClB,IAAI,CAAC2F,cAAc,CAAC,CAAC;UACrB+D,KAAK,CAAC,OAAO,CAAC;QAChB,OAAO;UACLA,KAAK,CAAC,QAAQhG,QAAQ,CAAC5F,IAAI,CAAC8H,OAAO,EAAE,CAAC;QACxC;MACF,EAAE,OAAO7C,KAAK,EAAE;QACdD,OAAO,CAACC,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/B2G,KAAK,CAAC,YAAY,CAAC;MACrB;IACF,CAAC;IAED;IACA4B,cAAcA,CAAC/L,KAAK,EAAE;MACpB,IAAI,CAACA,KAAK,CAACM,KAAI,IAAKN,KAAK,CAACM,KAAK,CAACsB,MAAK,KAAM,CAAC,EAAE;;MAE9C;MACA;MACA;;MAEA5B,KAAK,CAACM,KAAK,CAAC0D,OAAO,CAACxD,IAAG,IAAK;QACxB;QACA,IAAI,CAACA,IAAI,CAACsF,KAAK,EAAEtF,IAAI,CAACsF,KAAI,GAAItF,IAAI,CAACwI,UAAS,IAAKxI,IAAI,CAAC8H,YAAW,IAAK,CAAC;;QAEvE;QACA,IAAIvC,UAAU,CAACvF,IAAI,CAACsF,KAAK,MAAM,CAAC,EAAE;UAC9B;UACA,IAAI9F,KAAK,CAACM,KAAK,CAACsB,MAAK,KAAM,KAAK5B,KAAK,CAACgG,MAAK,GAAI,CAAC,EAAE;YAC9CxF,IAAI,CAACsF,KAAI,GAAI,CAAC9F,KAAK,CAACgG,MAAK,IAAKxF,IAAI,CAACiF,QAAO,IAAK,CAAC,CAAC,EAAEQ,OAAO,CAAC,CAAC,CAAC;UACjE;UACA;UAAA,KACK,IAAIzF,IAAI,CAAC0F,QAAO,IAAKH,UAAU,CAACvF,IAAI,CAAC0F,QAAQ,IAAI,CAAC,EAAE;YACrD1F,IAAI,CAACsF,KAAI,GAAI,CAACtF,IAAI,CAAC0F,QAAO,IAAK1F,IAAI,CAACiF,QAAO,IAAK,CAAC,CAAC,EAAEQ,OAAO,CAAC,CAAC,CAAC;UAClE;QACJ;;QAEA;QACAzF,IAAI,CAACiF,QAAO,GAAIjF,IAAI,CAACiF,QAAO,IAAK,CAAC;;QAElC;QACAjF,IAAI,CAAC0F,QAAO,GAAI,CAAC1F,IAAI,CAACsF,KAAI,GAAItF,IAAI,CAACiF,QAAQ,EAAEQ,OAAO,CAAC,CAAC,CAAC;MAC3D,CAAC,CAAC;;MAEF;MACA,IAAIF,UAAU,CAAC/F,KAAK,CAACgG,MAAM,MAAM,CAAC,EAAE;QAChChG,KAAK,CAACgG,MAAK,GAAIhG,KAAK,CAACM,KAAK,CAAC0L,MAAM,CAAC,CAACC,GAAG,EAAEzL,IAAI,KAAKyL,GAAE,GAAIlG,UAAU,CAACvF,IAAI,CAAC0F,QAAQ,CAAC,EAAE,CAAC,CAAC,CAACD,OAAO,CAAC,CAAC,CAAC;MACnG;IACF,CAAC;IAED,MAAMiG,eAAeA,CAAClM,KAAK,EAAE;MAC3B;MACA,IAAI,CAACZ,aAAY,GAAI;QAAE,GAAGY;MAAM,CAAC;MACjC;MACA,IAAI,CAAC+L,cAAc,CAAC,IAAI,CAAC3M,aAAa,CAAC;MAEvC,MAAMa,GAAE,GAAID,KAAK,CAACC,GAAE,IAAKD,KAAK,CAACsD,EAAE;MACjC,IAAI,CAACrD,GAAG,EAAE;MAEV,IAAI;QACFsD,OAAO,CAACc,GAAG,CAAC,WAAWpE,GAAG,gBAAgB,CAAC;QAC3C;QACA,MAAMkE,QAAO,GAAI,MAAM/F,KAAK,CAACsF,GAAG,CAACrF,SAAS,CAAC2B,KAAK,CAACoF,cAAc,CAACnF,GAAG,CAAC,CAAC;QAErE,IAAIkE,QAAQ,CAAC5F,IAAI,CAACuF,IAAG,KAAM,KAAKK,QAAQ,CAAC5F,IAAI,CAACA,IAAI,EAAE;UAChD,MAAMgH,MAAK,GAAIpB,QAAQ,CAAC5F,IAAI,CAACA,IAAI;UACjCgF,OAAO,CAACc,GAAG,CAAC,YAAY,EAAEkB,MAAM,CAAC;;UAEjC;UACA;UACA,MAAM4G,eAAc,GAAI5G,MAAM,CAAC6G,SAAQ,IAAK7G,MAAM,CAAC8G,cAAa,IAAK9G,MAAM;UAE3E,IAAI4G,eAAe,EAAE;YACjB;YACA,MAAMzB,OAAM,GAAIyB,eAAe,CAACxB,iBAAgB,IAAKwB,eAAe,CAACpC,gBAAe,IACtEoC,eAAe,CAAC3M,OAAM,IAAK2M,eAAe,CAACzB,OAAO;YAChE,IAAIA,OAAO,EAAE;cACT,IAAI,CAACtL,aAAa,CAACI,OAAM,GAAIkL,OAAO;cACpC,IAAI,CAACtL,aAAa,CAACuL,iBAAgB,GAAID,OAAO;YAClD;;YAEA;YACA,MAAME,QAAO,GAAIuB,eAAe,CAAC1M,eAAc,IAAK0M,eAAe,CAACnC,cAAa,IAClEmC,eAAe,CAACG,MAAK,IAAKH,eAAe,CAACvB,QAAQ;YACjE,IAAIA,QAAQ,EAAE;cACV,IAAI,CAACxL,aAAa,CAACK,eAAc,GAAImL,QAAQ;cAC7C,IAAI,CAACxL,aAAa,CAAC4K,cAAa,GAAIY,QAAQ;YAChD;;YAEA;YACA,MAAM2B,QAAO,GAAIJ,eAAe,CAACK,SAAQ,IAAKL,eAAe,CAACI,QAAO,IACtDJ,eAAe,CAACM,WAAU,IAAKN,eAAe,CAAC9E,UAAU;YACxE,IAAIkF,QAAQ,EAAE;cACV,IAAI,CAACnN,aAAa,CAACoN,SAAQ,GAAID,QAAQ;YAC3C;UACJ;;UAEA;UACA,IAAIhH,MAAM,CAACjF,KAAI,IAAKiF,MAAM,CAACjF,KAAK,CAACsB,MAAK,GAAI,CAAC,EAAE;YACzC;YACA;YACA;;YAEA;YACA,MAAM8K,WAAU,GAAI,IAAI,CAAChI,mBAAmB,CAAC,CAAC;cAAC,GAAGa,MAAM;cAAEjF,KAAK,EAAEiF,MAAM,CAACjF;YAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAACA,KAAK;YAEzF,IAAI,CAAClB,aAAa,CAACkB,KAAI,GAAIoM,WAAW;UAC1C;;UAEA;UACA,IAAI,CAACX,cAAc,CAAC,IAAI,CAAC3M,aAAa,CAAC;;UAEvC;UACA,IAAI,CAACA,aAAY,GAAI;YAAE,GAAG,IAAI,CAACA;UAAc,CAAC;QAClD;MACF,EAAE,OAAOgD,CAAC,EAAE;QACVmB,OAAO,CAACoC,IAAI,CAAC,oBAAoB,EAAEvD,CAAC,CAAC;MACvC;IACF,CAAC;IAEDuK,YAAYA,CAAA,EAAG;MACb;MACA,MAAMpO,IAAG,GAAI,IAAI,CAACoB,cAAc,CAACgF,GAAG,CAAC3E,KAAI,KAAM;QAC7C4M,GAAG,EAAE5M,KAAK,CAACC,GAAG;QACd4M,GAAG,EAAE7M,KAAK,CAACI,aAAa;QACxB0M,EAAE,EAAE9M,KAAK,CAACK,cAAc;QACxB0M,EAAE,EAAE/M,KAAK,CAACgH,gBAAgB;QAC1BgG,EAAE,EAAEhN,KAAK,CAACgG,MAAM;QAChBiH,EAAE,EAAE,IAAI,CAACnK,aAAa,CAAC9C,KAAK,CAACS,MAAM,CAAC;QACpCyM,IAAI,EAAE,IAAI,CAAC7K,cAAc,CAACrC,KAAK,CAACiB,UAAU;MAC5C,CAAC,CAAC,CAAC;;MAEH;MACA,MAAMkM,UAAS,GAAI,8BAA6B,GAC1C,4BAA2B,GAC3B5O,IAAI,CAACoG,GAAG,CAACyI,GAAE,IAAK7I,MAAM,CAAC8I,MAAM,CAACD,GAAG,CAAC,CAACzB,IAAI,CAAC,GAAG,CAAC,CAAC,CAACA,IAAI,CAAC,IAAI,CAAC;MAE9D,MAAM2B,UAAS,GAAIC,SAAS,CAACJ,UAAU,CAAC;MACxC,MAAMK,IAAG,GAAIC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;MACxCF,IAAI,CAACG,YAAY,CAAC,MAAM,EAAEL,UAAU,CAAC;MACrCE,IAAI,CAACG,YAAY,CAAC,UAAU,EAAE,QAAQ,IAAIhN,IAAI,CAAC,CAAC,CAACwB,kBAAkB,CAAC,CAAC,MAAM,CAAC;MAC5EsL,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,IAAI,CAAC;MAC/BA,IAAI,CAACM,KAAK,CAAC,CAAC;MACZL,QAAQ,CAACG,IAAI,CAACG,WAAW,CAACP,IAAI,CAAC;IACjC,CAAC;IAEDQ,QAAQA,CAAA,EAAG;MACT,IAAI,IAAI,CAACpP,WAAU,GAAI,CAAC,EAAE;QACxB,IAAI,CAACA,WAAW,EAAE;MACpB;IACF,CAAC;IAEDqP,QAAQA,CAAA,EAAG;MACT,IAAI,IAAI,CAACrP,WAAU,GAAI,IAAI,CAAC6C,UAAU,EAAE;QACtC,IAAI,CAAC7C,WAAW,EAAE;MACpB;IACF;EACF,CAAC;EACDsP,KAAK,EAAE;IACLxP,YAAYA,CAAA,EAAG;MACb,IAAI,CAACE,WAAU,GAAI,CAAC;IACtB,CAAC;IACDD,SAASA,CAAA,EAAG;MACV,IAAI,CAACC,WAAU,GAAI,CAAC;IACtB,CAAC;IACDH,aAAaA,CAAA,EAAG;MACd,IAAI,CAACG,WAAU,GAAI,CAAC;IACtB;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}